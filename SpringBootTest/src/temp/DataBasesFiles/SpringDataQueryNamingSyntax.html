<p>Для более детальной информации пиздуй в Appendix</p>
Видео для ДЕБИЛОВ: <a href="https://www.youtube.com/watch?v=SrZKku0g-so">JavaDay Lviv 2015: Spring Data, Evgeny Borisov</a>

<table class="tableblock frame-all grid-all">
    <caption class="title"><b>Supported keywords inside method names</b></caption>
    <colgroup>
        <col>
        <col>
        <col>
    </colgroup>
    <thead>
    <tr>
        <th class="tableblock halign-left valign-top">Keyword</th>
        <th class="tableblock halign-left valign-top">Sample</th>
        <th class="tableblock halign-left valign-top">JPQL snippet</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameAndFirstname</code></p>
        </td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname = ?1 and
            x.firstname = ?2</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameOrFirstname</code></p>
        </td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname = ?1 or x.firstname
            = ?2</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is,Equals</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstname</code>,<code>findByFirstnameIs</code>,<code>findByFirstnameEquals</code>
        </p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname = ?1</code></p>
        </td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateBetween</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate between ?1 and
            ?2</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThan</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &lt; ?1</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThanEqual</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &lt;= ?1</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThan</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &gt; ?1</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThanEqual</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThanEqual</code></p>
        </td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &gt;= ?1</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateAfter</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate &gt; ?1</code></p>
        </td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateBefore</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.startDate &lt; ?1</code></p>
        </td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNull</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeIsNull</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age is null</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotNull,NotNull</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAge(Is)NotNull</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age not null</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameLike</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code></p>
        </td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNotLike</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname not like ?1</code>
        </p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameStartingWith</code></p>
        </td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code>
            (parameter bound with appended <code>%</code>)</p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameEndingWith</code></p>
        </td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code>
            (parameter bound with prepended <code>%</code>)</p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameContaining</code></p>
        </td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.firstname like ?1</code>
            (parameter bound wrapped in <code>%</code>)</p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrderBy</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeOrderByLastnameDesc</code>
        </p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age = ?1 order by x.lastname
            desc</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameNot</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname &lt;&gt; ?1</code>
        </p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeIn(Collection&lt;Age&gt;
            ages)</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age in ?1</code></p></td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeNotIn(Collection&lt;Age&gt;
            age)</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age not in ?1</code></p>
        </td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveTrue()</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.active = true</code></p>
        </td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveFalse()</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.active = false</code></p>
        </td>
    </tr>
    <tr>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IgnoreCase</code></p></td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameIgnoreCase</code></p>
        </td>
        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where UPPER(x.firstame) =
            UPPER(?1)</code></p></td>
    </tr>
    </tbody>
</table>


<div id="content">
    <div id="preamble">
        <div class="sectionbody">
            <div class="paragraph">
                <p>© 2008-2016 The original authors.</p>
            </div>
            <div class="admonitionblock note">
                <table>
                    <tbody>
                    <tr>
                        <td class="icon">
                            <i class="fa icon-note" title="Note"></i>
                        </td>
                        <td class="content">
                            Copies of this document may be made for your own use and for distribution to others,
                            provided that you do not charge any fee for such copies and further provided that each copy
                            contains this Copyright Notice, whether distributed in print or electronically.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id="toc" class="toc">
                <div id="toctitle" class="title">Table of Contents</div>
                <ul class="sectlevel0">
                    <li><a href="#preface">Preface</a>
                        <ul class="sectlevel1">
                            <li><a href="#project">1. Project metadata</a></li>
                            <li><a href="#new-features">2. New &amp; Noteworthy</a>
                                <ul class="sectlevel2">
                                    <li><a href="#new-features.1-10-0">2.1. What’s new in Spring Data JPA 1.10</a></li>
                                </ul>
                            </li>
                            <li><a href="#dependencies">3. Dependencies</a>
                                <ul class="sectlevel2">
                                    <li><a href="#dependencies.spring-boot">3.1. Dependency management with Spring
                                        Boot</a></li>
                                    <li><a href="#dependencies.spring-framework">3.2. Spring Framework</a></li>
                                </ul>
                            </li>
                            <li><a href="#repositories">4. Working with Spring Data Repositories</a>
                                <ul class="sectlevel2">
                                    <li><a href="#repositories.core-concepts">4.1. Core concepts</a></li>
                                    <li><a href="#repositories.query-methods">4.2. Query methods</a></li>
                                    <li><a href="#repositories.definition">4.3. Defining repository interfaces</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#repositories.definition-tuning">4.3.1. Fine-tuning repository
                                                definition</a></li>
                                            <li><a href="#repositories.multiple-modules">4.3.2. Using Repositories with
                                                multiple Spring Data modules</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#repositories.query-methods.details">4.4. Defining query methods</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#repositories.query-methods.query-lookup-strategies">4.4.1.
                                                Query lookup strategies</a></li>
                                            <li><a href="#repositories.query-methods.query-creation">4.4.2. Query
                                                creation</a></li>
                                            <li><a href="#repositories.query-methods.query-property-expressions">4.4.3.
                                                Property expressions</a></li>
                                            <li><a href="#repositories.special-parameters">4.4.4. Special parameter
                                                handling</a></li>
                                            <li><a href="#repositories.limit-query-result">4.4.5. Limiting query
                                                results</a></li>
                                            <li><a href="#repositories.query-streaming">4.4.6. Streaming query
                                                results</a></li>
                                            <li><a href="#repositories.query-async">4.4.7. Async query results</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#repositories.create-instances">4.5. Creating repository instances</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#repositories.create-instances.spring">4.5.1. XML
                                                configuration</a></li>
                                            <li><a href="#repositories.create-instances.java-config">4.5.2.
                                                JavaConfig</a></li>
                                            <li><a href="#repositories.create-instances.standalone">4.5.3. Standalone
                                                usage</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#repositories.custom-implementations">4.6. Custom implementations for
                                        Spring Data repositories</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#repositories.single-repository-behaviour">4.6.1. Adding custom
                                                behavior to single repositories</a></li>
                                            <li><a href="#repositories.custom-behaviour-for-all-repositories">4.6.2.
                                                Adding custom behavior to all repositories</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#core.extensions">4.7. Spring Data extensions</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#core.extensions.querydsl">4.7.1. Querydsl Extension</a></li>
                                            <li><a href="#core.web">4.7.2. Web support</a></li>
                                            <li><a href="#core.repository-populators">4.7.3. Repository populators</a>
                                            </li>
                                            <li><a href="#web.legacy">4.7.4. Legacy web support</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="#reference">Reference Documentation</a>
                        <ul class="sectlevel1">
                            <li><a href="#jpa.repositories">5. JPA Repositories</a>
                                <ul class="sectlevel2">
                                    <li><a href="#jpa.introduction">5.1. Introduction</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#jpa.namespace">5.1.1. Spring namespace</a></li>
                                            <li><a href="#jpa.java-config">5.1.2. Annotation based configuration</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li><a href="#jpa.entity-persistence">5.2. Persisting entities</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#jpa.entity-persistence.saving-entites">5.2.1. Saving
                                                entities</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#jpa.query-methods">5.3. Query methods</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#jpa.sample-app.finders.strategies">5.3.1. Query lookup
                                                strategies</a></li>
                                            <li><a href="#jpa.query-methods.query-creation">5.3.2. Query creation</a>
                                            </li>
                                            <li><a href="#jpa.query-methods.named-queries">5.3.3. Using JPA
                                                NamedQueries</a></li>
                                            <li><a href="#jpa.query-methods.at-query">5.3.4. Using @Query</a></li>
                                            <li><a href="#jpa.query-methods.sorting">5.3.5. Using Sort</a></li>
                                            <li><a href="#jpa.named-parameters">5.3.6. Using named parameters</a></li>
                                            <li><a href="#jpa.query.spel-expressions">5.3.7. Using SpEL expressions</a>
                                            </li>
                                            <li><a href="#jpa.modifying-queries">5.3.8. Modifying queries</a></li>
                                            <li><a href="#jpa.query-hints">5.3.9. Applying query hints</a></li>
                                            <li><a href="#jpa.entity-graph">5.3.10. Configuring Fetch- and
                                                LoadGraphs</a></li>
                                            <li><a href="#projections">5.3.11. Projections</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#jpa.stored-procedures">5.4. Stored procedures</a></li>
                                    <li><a href="#specifications">5.5. Specifications</a></li>
                                    <li><a href="#query-by-example">5.6. Query by Example</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#query-by-example.introduction">5.6.1. Introduction</a></li>
                                            <li><a href="#query-by-example.usage">5.6.2. Usage</a></li>
                                            <li><a href="#query-by-example.matchers">5.6.3. Example matchers</a></li>
                                            <li><a href="#query-by-example.execution">5.6.4. Executing an example</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li><a href="#transactions">5.7. Transactionality</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#transactional-query-methods">5.7.1. Transactional query
                                                methods</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#locking">5.8. Locking</a></li>
                                    <li><a href="#auditing">5.9. Auditing</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#auditing.basics">5.9.1. Basics</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#jpa.auditing">5.10. JPA Auditing</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#jpa.auditing.configuration">5.10.1. General auditing
                                                configuration</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li><a href="#jpa.misc">6. Miscellaneous</a>
                                <ul class="sectlevel2">
                                    <li><a href="#jpa.misc.jpa-context">6.1. Using JpaContext in custom
                                        implementations</a></li>
                                    <li><a href="#jpa.misc.merging-persistence-units">6.2. Merging persistence units</a>
                                        <ul class="sectlevel3">
                                            <li><a href="#jpa.misc.entity-scanning">6.2.1. Classpath scanning for
                                                @Entity classes and JPA mapping files</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#jpd.misc.cdi-integration">6.3. CDI integration</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="#appendix">Appendix</a>
                        <ul class="sectlevel1">
                            <li><a href="#repositories.namespace-reference">Appendix A: Namespace reference</a>
                                <ul class="sectlevel2">
                                    <li><a href="#populator.namespace-dao-config">The &lt;repositories /&gt; element</a>
                                    </li>
                                </ul>
                            </li>
                            <li><a href="#populator.namespace-reference">Appendix B: Populators namespace reference</a>
                                <ul class="sectlevel2">
                                    <li><a href="#namespace-dao-config">The &lt;populator /&gt; element</a></li>
                                </ul>
                            </li>
                            <li><a href="#repository-query-keywords">Appendix C: Repository query keywords</a>
                                <ul class="sectlevel2">
                                    <li><a href="#_supported_query_keywords">Supported query keywords</a></li>
                                </ul>
                            </li>
                            <li><a href="#repository-query-return-types">Appendix D: Repository query return types</a>
                                <ul class="sectlevel2">
                                    <li><a href="#_supported_query_return_types">Supported query return types</a></li>
                                </ul>
                            </li>
                            <li><a href="#faq">Appendix E: Frequently asked questions</a>
                                <ul class="sectlevel2">
                                    <li><a href="#_common">Common</a></li>
                                    <li><a href="#_infrastructure">Infrastructure</a></li>
                                    <li><a href="#_auditing">Auditing</a></li>
                                </ul>
                            </li>
                            <li><a href="#glossary">Appendix F: Glossary</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <h1 id="preface" class="sect0"><a class="anchor" href="#preface"></a>Preface</h1>
    <div class="sect1">
        <h2 id="project"><a class="anchor" href="#project"></a>1. Project metadata</h2>
        <div class="sectionbody">
            <div class="ulist">
                <ul>
                    <li>
                        <p>Version control - <a href="https://github.com/spring-projects/spring-data-jpa" class="bare">http://github.com/spring-projects/spring-data-jpa</a>
                        </p>
                    </li>
                    <li>
                        <p>Bugtracker - <a href="https://jira.spring.io/browse/DATAJPA" class="bare">https://jira.spring.io/browse/DATAJPA</a>
                        </p>
                    </li>
                    <li>
                        <p>Release repository - <a href="https://repo.spring.io/libs-release" class="bare">https://repo.spring.io/libs-release</a>
                        </p>
                    </li>
                    <li>
                        <p>Milestone repository - <a href="https://repo.spring.io/libs-milestone" class="bare">https://repo.spring.io/libs-milestone</a>
                        </p>
                    </li>
                    <li>
                        <p>Snapshot repository - <a href="https://repo.spring.io/libs-snapshot" class="bare">https://repo.spring.io/libs-snapshot</a>
                        </p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="new-features"><a class="anchor" href="#new-features"></a>2. New &amp; Noteworthy</h2>
        <div class="sectionbody">
            <div class="sect2">
                <h3 id="new-features.1-10-0"><a class="anchor" href="#new-features.1-10-0"></a>2.1. What’s new in Spring
                    Data JPA 1.10</h3>
                <div class="ulist">
                    <ul>
                        <li>
                            <p>Support for <a href="#projections">Projections</a> in repository query methods.</p>
                        </li>
                        <li>
                            <p>Support for <a href="#query-by-example">Query by Example</a>.</p>
                        </li>
                        <li>
                            <p>The following annotations have been enabled to build own, composed annotations: <code>@EntityGraph</code>,
                                <code>@Lock</code>, <code>@Modifying</code>, <code>@Query</code>,
                                <code>@QueryHints</code> and <code>@Procedure</code>.</p>
                        </li>
                        <li>
                            <p>Support for <code>Contains</code> keyword on collection expressions.</p>
                        </li>
                        <li>
                            <p>AttributeConverters for <code>ZoneId</code> of JSR-310 and ThreeTenBP.</p>
                        </li>
                        <li>
                            <p>Upgrade to Querydsl 4, Hibernate 5, OpenJPA 2.4 and EclipseLink 2.6.1.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="dependencies"><a class="anchor" href="#dependencies"></a>3. Dependencies</h2>
        <div class="sectionbody">
            <div class="paragraph">
                <p>Due to different inception dates of individual Spring Data modules, most of them carry different
                    major and minor version numbers. The easiest way to find compatible ones is by relying on the Spring
                    Data Release Train BOM we ship with the compatible versions defined. In a Maven project you’d
                    declare this dependency in the <code>&lt;dependencyManagement /&gt;</code> section of your POM:</p>
            </div>
            <div class="exampleblock">
                <div class="title">Example 1. Using the Spring Data release train BOM</div>
                <div class="content">
                    <div class="listingblock">
                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span><span
        class="pln">
  </span><span class="tag">&lt;dependencies&gt;</span><span class="pln">
    </span><span class="tag">&lt;dependency&gt;</span><span class="pln">
      </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.springframework.data</span><span class="tag">&lt;/groupId&gt;</span><span
        class="pln">
      </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">spring-data-releasetrain</span><span
        class="tag">&lt;/artifactId&gt;</span><span class="pln">
      </span><span class="tag">&lt;version&gt;</span><span class="pln">${release-train}</span><span class="tag">&lt;/version&gt;</span><span
        class="pln">
      </span><span class="tag">&lt;scope&gt;</span><span class="pln">import</span><span
        class="tag">&lt;/scope&gt;</span><span class="pln">
      </span><span class="tag">&lt;type&gt;</span><span class="pln">pom</span><span
        class="tag">&lt;/type&gt;</span><span class="pln">
    </span><span class="tag">&lt;/dependency&gt;</span><span class="pln">
  </span><span class="tag">&lt;/dependencies&gt;</span><span class="pln">
</span><span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
                        </div>
                    </div>
                </div>
            </div>
            <div id="dependencies.train-names" class="paragraph">
                <p>The current release train version is <code>Hopper-SR6</code>. The train names are ascending
                    alphabetically and currently available ones are listed <a
                            href="https://github.com/spring-projects/spring-data-commons/wiki/Release-planning">here</a>.
                    The version name follows the following pattern: <code>${name}-${release}</code> where release can be
                    one of the following:</p>
            </div>
            <div class="ulist">
                <ul>
                    <li>
                        <p><code>BUILD-SNAPSHOT</code> - current snapshots</p>
                    </li>
                    <li>
                        <p><code>M1</code>, <code>M2</code> etc. - milestones</p>
                    </li>
                    <li>
                        <p><code>RC1</code>, <code>RC2</code> etc. - release candidates</p>
                    </li>
                    <li>
                        <p><code>RELEASE</code> - GA release</p>
                    </li>
                    <li>
                        <p><code>SR1</code>, <code>SR2</code> etc. - service releases</p>
                    </li>
                </ul>
            </div>
            <div class="paragraph">
                <p>A working example of using the BOMs can be found in our <a
                        href="https://github.com/spring-projects/spring-data-examples/tree/master/bom">Spring Data
                    examples repository</a>. If that’s in place declare the Spring Data modules you’d like to use
                    without a version in the <code>&lt;dependencies /&gt;</code> block.</p>
            </div>
            <div class="exampleblock">
                <div class="title">Example 2. Declaring a dependency to a Spring Data module</div>
                <div class="content">
                    <div class="listingblock">
                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;dependencies&gt;</span><span
        class="pln">
  </span><span class="tag">&lt;dependency&gt;</span><span class="pln">
    </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.springframework.data</span><span class="tag">&lt;/groupId&gt;</span><span
        class="pln">
    </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">spring-data-jpa</span><span class="tag">&lt;/artifactId&gt;</span><span
        class="pln">
  </span><span class="tag">&lt;/dependency&gt;</span><span class="pln">
</span><span class="tag">&lt;dependencies&gt;</span></code></pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="dependencies.spring-boot"><a class="anchor" href="#dependencies.spring-boot"></a>3.1. Dependency
                    management with Spring Boot</h3>
                <div class="paragraph">
                    <p>Spring Boot already selects a very recent version of Spring Data modules for you. In case you
                        want to upgrade to a newer version nonetheless, simply configure the property <code>spring-data-releasetrain.version</code>
                        to the <a href="#dependencies.train-names">train name and iteration</a> you’d like to use.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="dependencies.spring-framework"><a class="anchor" href="#dependencies.spring-framework"></a>3.2.
                    Spring Framework</h3>
                <div class="paragraph">
                    <p>The current version of Spring Data modules require Spring Framework in version 4.2.9.RELEASE or
                        better. The modules might also work with an older bugfix version of that minor version. However,
                        using the most recent version within that generation is highly recommended.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="repositories"><a class="anchor" href="#repositories"></a>4. Working with Spring Data Repositories</h2>
        <div class="sectionbody">
            <div class="paragraph">
                <p>The goal of Spring Data repository abstraction is to significantly reduce the amount of boilerplate
                    code required to implement data access layers for various persistence stores.</p>
            </div>
            <div class="admonitionblock important">
                <table>
                    <tbody>
                    <tr>
                        <td class="icon">
                            <i class="fa icon-important" title="Important"></i>
                        </td>
                        <td class="content">
                            <div class="paragraph">
                                <p><em>Spring Data repository documentation and your module</em></p>
                            </div>
                            <div class="paragraph">
                                <p>This chapter explains the core concepts and interfaces of Spring Data repositories.
                                    The information in this chapter is pulled from the Spring Data Commons module. It
                                    uses the configuration and code samples for the Java Persistence API (JPA) module.
                                    Adapt the XML namespace declaration and the types to be extended to the equivalents
                                    of the particular module that you are using. <a
                                            href="#repositories.namespace-reference">Namespace reference</a> covers XML
                                    configuration which is supported across all Spring Data modules supporting the
                                    repository API, <a href="#repository-query-keywords">Repository query keywords</a>
                                    covers the query method keywords supported by the repository abstraction in general.
                                    For detailed information on the specific features of your module, consult the
                                    chapter on that module of this document.</p>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="sect2">
                <h3 id="repositories.core-concepts"><a class="anchor" href="#repositories.core-concepts"></a>4.1. Core
                    concepts</h3>
                <div class="paragraph">
                    <p>The central interface in Spring Data repository abstraction is <code>Repository</code> (probably
                        not that much of a surprise). It takes the domain class to manage as well as the id type of the
                        domain class as type arguments. This interface acts primarily as a marker interface to capture
                        the types to work with and to help you to discover interfaces that extend this one. The <code>CrudRepository</code>
                        provides sophisticated CRUD functionality for the entity class that is being managed.</p>
                </div>
                <div id="repositories.repository" class="exampleblock">
                    <div class="title">Example 3. CrudRepository interface</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">CrudRepository</span><span class="pun">&lt;</span><span
        class="pln">T</span><span class="pun">,</span><span class="pln"> ID </span><span class="kwd">extends</span><span
        class="pln"> </span><span class="typ">Serializable</span><span class="pun">&gt;</span><span class="pln">
    </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Repository</span><span
        class="pun">&lt;</span><span class="pln">T</span><span class="pun">,</span><span class="pln"> ID</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="pun">&lt;</span><span class="pln">S </span><span class="kwd">extends</span><span
        class="pln"> T</span><span class="pun">&gt;</span><span class="pln"> S save</span><span
        class="pun">(</span><span class="pln">S entity</span><span class="pun">);</span><span class="pln"> </span><i
        class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span
        class="pun">)</span></b><span class="pln">

    T findOne</span><span class="pun">(</span><span class="pln">ID primaryKey</span><span class="pun">);</span><span
        class="pln">       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span
        class="lit">2</span><span class="pun">)</span></b><span class="pln">

    </span><span class="typ">Iterable</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span
        class="pln"> findAll</span><span class="pun">();</span><span class="pln">          </span><i class="conum"
                                                                                                     data-value="3"></i><b><span
        class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

    </span><span class="typ">Long</span><span class="pln"> count</span><span class="pun">();</span><span
        class="pln">                   </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span
        class="lit">4</span><span class="pun">)</span></b><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> </span><span class="kwd">delete</span><span
        class="pun">(</span><span class="pln">T entity</span><span class="pun">);</span><span
        class="pln">          </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span
        class="pun">)</span></b><span class="pln">

    </span><span class="kwd">boolean</span><span class="pln"> exists</span><span class="pun">(</span><span class="pln">ID primaryKey</span><span
        class="pun">);</span><span class="pln">  </span><i class="conum" data-value="6"></i><b><span
        class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">

    </span><span class="com">// … more functionality omitted.</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                        <div class="colist arabic">
                            <table>
                                <tbody>
                                <tr>
                                    <td><i class="conum" data-value="1"></i><b>1</b></td>
                                    <td>Saves the given entity.</td>
                                </tr>
                                <tr>
                                    <td><i class="conum" data-value="2"></i><b>2</b></td>
                                    <td>Returns the entity identified by the given id.</td>
                                </tr>
                                <tr>
                                    <td><i class="conum" data-value="3"></i><b>3</b></td>
                                    <td>Returns all entities.</td>
                                </tr>
                                <tr>
                                    <td><i class="conum" data-value="4"></i><b>4</b></td>
                                    <td>Returns the number of entities.</td>
                                </tr>
                                <tr>
                                    <td><i class="conum" data-value="5"></i><b>5</b></td>
                                    <td>Deletes the given entity.</td>
                                </tr>
                                <tr>
                                    <td><i class="conum" data-value="6"></i><b>6</b></td>
                                    <td>Indicates whether an entity with the given id exists.</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="admonitionblock note">
                    <table>
                        <tbody>
                        <tr>
                            <td class="icon">
                                <i class="fa icon-note" title="Note"></i>
                            </td>
                            <td class="content">
                                We also provide persistence technology-specific abstractions like e.g. <code>JpaRepository</code>
                                or <code>MongoRepository</code>. Those interfaces extend <code>CrudRepository</code> and
                                expose the capabilities of the underlying persistence technology in addition to the
                                rather generic persistence technology-agnostic interfaces like e.g. CrudRepository.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="paragraph">
                    <p>On top of the <code>CrudRepository</code> there is a <code>PagingAndSortingRepository</code>
                        abstraction that adds additional methods to ease paginated access to entities:</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 4. PagingAndSortingRepository</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">PagingAndSortingRepository</span><span class="pun">&lt;</span><span
        class="pln">T</span><span class="pun">,</span><span class="pln"> ID </span><span class="kwd">extends</span><span
        class="pln"> </span><span class="typ">Serializable</span><span class="pun">&gt;</span><span class="pln">
  </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">CrudRepository</span><span
        class="pun">&lt;</span><span class="pln">T</span><span class="pun">,</span><span class="pln"> ID</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="typ">Iterable</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">&gt;</span><span class="pln"> findAll</span><span class="pun">(</span><span
        class="typ">Sort</span><span class="pln"> sort</span><span class="pun">);</span><span class="pln">

  </span><span class="typ">Page</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">&gt;</span><span class="pln"> findAll</span><span class="pun">(</span><span
        class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Accessing the second page of <code>User</code> by a page size of 20 you could simply do something
                        like this:</p>
                </div>
                <div class="listingblock">
                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">PagingAndSortingRepository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> repository </span><span class="pun">=</span><span class="pln"> </span><span class="com">// … get access to a bean</span><span
        class="pln">
</span><span class="typ">Page</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> users </span><span class="pun">=</span><span
        class="pln"> repository</span><span class="pun">.</span><span class="pln">findAll</span><span
        class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">PageRequest</span><span class="pun">(</span><span class="lit">1</span><span
        class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span
        class="pun">));</span></code></pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>In addition to query methods, query derivation for both count and delete queries, is
                        available.</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 5. Derived Count Query</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">CrudRepository</span><span class="pun">&lt;</span><span
        class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="typ">Long</span><span class="pln"> countByLastname</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> lastname</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 6. Derived Delete Query</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">CrudRepository</span><span class="pun">&lt;</span><span
        class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="typ">Long</span><span class="pln"> deleteByLastname</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> lastname</span><span class="pun">);</span><span class="pln">

  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> removeByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="repositories.query-methods"><a class="anchor" href="#repositories.query-methods"></a>4.2. Query
                    methods</h3>
                <div class="paragraph">
                    <p>Standard CRUD functionality repositories usually have queries on the underlying datastore. With
                        Spring Data, declaring those queries becomes a four-step process:</p>
                </div>
                <div class="olist arabic">
                    <ol class="arabic">
                        <li>
                            <p>Declare an interface extending Repository or one of its subinterfaces and type it to the
                                domain class and ID type that it will handle.</p>
                            <div class="listingblock">
                                <div class="content">
                                    <pre class="prettyprint highlight prettyprinted" style=""><code
                                            class="language-java" data-lang="java"><span
                                            class="kwd">interface</span><span class="pln"> </span><span class="typ">PersonRepository</span><span
                                            class="pln"> </span><span class="kwd">extends</span><span
                                            class="pln"> </span><span class="typ">Repository</span><span class="pun">&lt;</span><span
                                            class="typ">Person</span><span class="pun">,</span><span
                                            class="pln"> </span><span class="typ">Long</span><span
                                            class="pun">&gt;</span><span class="pln"> </span><span
                                            class="pun">{</span><span class="pln"> </span><span
                                            class="pun">…</span><span class="pln"> </span><span
                                            class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p>Declare query methods on the interface.</p>
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">PersonRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </li>
                        <li>
                            <p>Set up Spring to create proxy instances for those interfaces. Either via <a
                                    href="#repositories.create-instances.java-config">JavaConfig</a>:</p>
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">springframework</span><span
        class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">jpa</span><span
        class="pun">.</span><span class="pln">repository</span><span class="pun">.</span><span class="pln">config</span><span
        class="pun">.</span><span class="typ">EnableJpaRepositories</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@EnableJpaRepositories</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Config</span><span class="pln"> </span><span
        class="pun">{}</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>or via <a href="#repositories.create-instances">XML configuration</a>:</p>
                            </div>
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span
        class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span
        class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;beans</span><span class="pln"> </span><span class="atn">xmlns</span><span
        class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans"</span><span class="pln">
   </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span
        class="pln">
   </span><span class="atn">xmlns:jpa</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/data/jpa"</span><span
        class="pln">
   </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans.xsd
     http://www.springframework.org/schema/data/jpa
     http://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span><span class="tag">&gt;</span><span
        class="pln">

   </span><span class="tag">&lt;jpa:repositories</span><span class="pln"> </span><span
        class="atn">base-package</span><span class="pun">=</span><span class="atv">"com.acme.repositories"</span><span
        class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;/beans&gt;</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>The JPA namespace is used in this example. If you are using the repository
                                    abstraction for any other store, you need to change this to the appropriate
                                    namespace declaration of your store module which should be exchanging
                                    <code>jpa</code> in favor of, for example, <code>mongodb</code>.</p>
                            </div>
                            <div class="paragraph">
                                <p>Also, note that the JavaConfig variant doesn’t configure a package explictly as the
                                    package of the annotated class is used by default. To customize the package to scan
                                    use one of the <code>basePackage…</code> attribute of the data-store specific
                                    repository <code>@Enable…</code>-annotation.</p>
                            </div>
                        </li>
                        <li>
                            <p>Get the repository instance injected and use it.</p>
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">SomeClient</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Autowired</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PersonRepository</span><span
        class="pln"> repository</span><span class="pun">;</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doSomething</span><span
        class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span
        class="pln"> persons </span><span class="pun">=</span><span class="pln"> repository</span><span
        class="pun">.</span><span class="pln">findByLastname</span><span class="pun">(</span><span class="str">"Matthews"</span><span
        class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </li>
                    </ol>
                </div>
                <div class="paragraph">
                    <p>The sections that follow explain each step in detail.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="repositories.definition"><a class="anchor" href="#repositories.definition"></a>4.3. Defining
                    repository interfaces</h3>
                <div class="paragraph">
                    <p>As a first step you define a domain class-specific repository interface. The interface must
                        extend Repository and be typed to the domain class and an ID type. If you want to expose CRUD
                        methods for that domain type, extend <code>CrudRepository</code> instead of
                        <code>Repository</code>.</p>
                </div>
                <div class="sect3">
                    <h4 id="repositories.definition-tuning"><a class="anchor"
                                                               href="#repositories.definition-tuning"></a>4.3.1.
                        Fine-tuning repository definition</h4>
                    <div class="paragraph">
                        <p>Typically, your repository interface will extend <code>Repository</code>, <code>CrudRepository</code>
                            or <code>PagingAndSortingRepository</code>. Alternatively, if you do not want to extend
                            Spring Data interfaces, you can also annotate your repository interface with <code>@RepositoryDefinition</code>.
                            Extending <code>CrudRepository</code> exposes a complete set of methods to manipulate your
                            entities. If you prefer to be selective about the methods being exposed, simply copy the
                            ones you want to expose from <code>CrudRepository</code> into your domain repository.</p>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    This allows you to define your own abstractions on top of the provided Spring Data
                                    Repositories functionality.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 7. Selectively exposing CRUD methods</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@NoRepositoryBean</span><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">MyBaseRepository</span><span
        class="pun">&lt;</span><span class="pln">T</span><span class="pun">,</span><span class="pln"> ID </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">Serializable</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">,</span><span class="pln"> ID</span><span class="pun">&gt;</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">

  T findOne</span><span class="pun">(</span><span class="pln">ID id</span><span class="pun">);</span><span class="pln">

  T save</span><span class="pun">(</span><span class="pln">T entity</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">MyBaseRepository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">User</span><span class="pln"> findByEmailAddress</span><span class="pun">(</span><span
        class="typ">EmailAddress</span><span class="pln"> emailAddress</span><span class="pun">);</span><span
        class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>In this first step you defined a common base interface for all your domain repositories and
                            exposed <code>findOne(…)</code> as well as <code>save(…)</code>.These methods will be routed
                            into the base repository implementation of the store of your choice provided by Spring Data
                            ,e.g. in the case if JPA <code>SimpleJpaRepository</code>, because they are matching the
                            method signatures in <code>CrudRepository</code>. So the <code>UserRepository</code> will
                            now be able to save users, and find single ones by id, as well as triggering a query to find
                            <code>Users</code> by their email address.</p>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    Note, that the intermediate repository interface is annotated with <code>@NoRepositoryBean</code>.
                                    Make sure you add that annotation to all repository interfaces that Spring Data
                                    should not create instances for at runtime.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.multiple-modules"><a class="anchor" href="#repositories.multiple-modules"></a>4.3.2.
                        Using Repositories with multiple Spring Data modules</h4>
                    <div class="paragraph">
                        <p>Using a unique Spring Data module in your application makes things simple hence, all
                            repository interfaces in the defined scope are bound to the Spring Data module. Sometimes
                            applications require using more than one Spring Data module. In such case, it’s required for
                            a repository definition to distinguish between persistence technologies. Spring Data enters
                            strict repository configuration mode because it detects multiple repository factories on the
                            class path. Strict configuration requires details on the repository or the domain class to
                            decide about Spring Data module binding for a repository definition:</p>
                    </div>
                    <div class="olist arabic">
                        <ol class="arabic">
                            <li>
                                <p>If the repository definition <a href="#repositories.multiple-modules.types">extends
                                    the module-specific repository</a>, then it’s a valid candidate for the particular
                                    Spring Data module.</p>
                            </li>
                            <li>
                                <p>If the domain class is <a href="#repositories.multiple-modules.annotations">annotated
                                    with the module-specific type annotation</a>, then it’s a valid candidate for the
                                    particular Spring Data module. Spring Data modules accept either 3rd party
                                    annotations (such as JPA’s <code>@Entity</code>) or provide own annotations such as
                                    <code>@Document</code> for Spring Data MongoDB/Spring Data Elasticsearch.</p>
                            </li>
                        </ol>
                    </div>
                    <div id="repositories.multiple-modules.types" class="exampleblock">
                        <div class="title">Example 8. Repository definitions using Module-specific Interfaces</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">MyRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">JpaRepository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span
        class="pln">

</span><span class="lit">@NoRepositoryBean</span><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">MyBaseRepository</span><span
        class="pun">&lt;</span><span class="pln">T</span><span class="pun">,</span><span class="pln"> ID </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">Serializable</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">JpaRepository</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">,</span><span class="pln"> ID</span><span class="pun">&gt;</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">MyBaseRepository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p><code>MyRepository</code> and <code>UserRepository</code> extend
                                    <code>JpaRepository</code> in their type hierarchy. They are valid candidates for
                                    the Spring Data JPA module.</p>
                            </div>
                        </div>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 9. Repository definitions using generic Interfaces</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">AmbiguousRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
 </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@NoRepositoryBean</span><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">MyBaseRepository</span><span
        class="pun">&lt;</span><span class="pln">T</span><span class="pun">,</span><span class="pln"> ID </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">Serializable</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">CrudRepository</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">,</span><span class="pln"> ID</span><span class="pun">&gt;</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">AmbiguousUserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">MyBaseRepository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p><code>AmbiguousRepository</code> and <code>AmbiguousUserRepository</code> extend only
                                    <code>Repository</code> and <code>CrudRepository</code> in their type hierarchy.
                                    While this is perfectly fine using a unique Spring Data module, multiple modules
                                    cannot distinguish to which particular Spring Data these repositories should be
                                    bound.</p>
                            </div>
                        </div>
                    </div>
                    <div id="repositories.multiple-modules.annotations" class="exampleblock">
                        <div class="title">Example 10. Repository definitions using Domain Classes with Annotations
                        </div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">PersonRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
 </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
 </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Document</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p><code>PersonRepository</code> references <code>Person</code> which is annotated with
                                    the JPA annotation <code>@Entity</code> so this repository clearly belongs to Spring
                                    Data JPA. <code>UserRepository</code> uses <code>User</code> annotated with Spring
                                    Data MongoDB’s <code>@Document</code> annotation.</p>
                            </div>
                        </div>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 11. Repository definitions using Domain Classes with mixed
                            Annotations
                        </div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">JpaPersonRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
 </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">MongoDBPersonRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
 </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="lit">@Document</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>This example shows a domain class using both JPA and Spring Data MongoDB annotations.
                                    It defines two repositories, <code>JpaPersonRepository</code> and <code>MongoDBPersonRepository</code>.
                                    One is intended for JPA and the other for MongoDB usage. Spring Data is no longer
                                    able to tell the repositories apart which leads to undefined behavior.</p>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p><a href="#repositories.multiple-modules.types">Repository type details</a> and <a
                                href="#repositories.multiple-modules.annotations">identifying domain class
                            annotations</a> are used for strict repository configuration identify repository candidates
                            for a particular Spring Data module. Using multiple persistence technology-specific
                            annotations on the same domain type is possible to reuse domain types across multiple
                            persistence technologies, but then Spring Data is no longer able to determine a unique
                            module to bind the repository.</p>
                    </div>
                    <div class="paragraph">
                        <p>The last way to distinguish repositories is scoping repository base packages. Base packages
                            define the starting points for scanning for repository interface definitions which implies
                            to have repository definitions located in the appropriate packages. By default,
                            annotation-driven configuration uses the package of the configuration class. The <a
                                    href="#repositories.create-instances.spring">base package in XML-based
                                configuration</a> is mandatory.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 12. Annotation-driven configuration of base packages</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@EnableJpaRepositories</span><span class="pun">(</span><span class="pln">basePackages </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"com.acme.repositories.jpa"</span><span
        class="pun">)</span><span class="pln">
</span><span class="lit">@EnableMongoRepositories</span><span class="pun">(</span><span class="pln">basePackages </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"com.acme.repositories.mongo"</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Configuration</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="repositories.query-methods.details"><a class="anchor"
                                                               href="#repositories.query-methods.details"></a>4.4.
                    Defining query methods</h3>
                <div class="paragraph">
                    <p>The repository proxy has two ways to derive a store-specific query from the method name. It can
                        derive the query from the method name directly, or by using a manually defined query. Available
                        options depend on the actual store. However, there’s got to be a strategy that decides what
                        actual query is created. Let’s have a look at the available options.</p>
                </div>
                <div class="sect3">
                    <h4 id="repositories.query-methods.query-lookup-strategies"><a class="anchor"
                                                                                   href="#repositories.query-methods.query-lookup-strategies"></a>4.4.1.
                        Query lookup strategies</h4>
                    <div class="paragraph">
                        <p>The following strategies are available for the repository infrastructure to resolve the
                            query. You can configure the strategy at the namespace through the <code>query-lookup-strategy</code>
                            attribute in case of XML configuration or via the <code>queryLookupStrategy</code> attribute
                            of the Enable${store}Repositories annotation in case of Java config. Some strategies may not
                            be supported for particular datastores.</p>
                    </div>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p><code>CREATE</code> attempts to construct a store-specific query from the query
                                    method name. The general approach is to remove a given set of well-known prefixes
                                    from the method name and parse the rest of the method. Read more about query
                                    construction in <a href="#repositories.query-methods.query-creation">Query
                                        creation</a>.</p>
                            </li>
                            <li>
                                <p><code>USE_DECLARED_QUERY</code> tries to find a declared query and will throw an
                                    exception in case it can’t find one. The query can be defined by an annotation
                                    somewhere or declared by other means. Consult the documentation of the specific
                                    store to find available options for that store. If the repository infrastructure
                                    does not find a declared query for the method at bootstrap time, it fails.</p>
                            </li>
                            <li>
                                <p><code>CREATE_IF_NOT_FOUND</code> (default) combines <code>CREATE</code> and <code>USE_DECLARED_QUERY</code>.
                                    It looks up a declared query first, and if no declared query is found, it creates a
                                    custom method name-based query. This is the default lookup strategy and thus will be
                                    used if you do not configure anything explicitly. It allows quick query definition
                                    by method names but also custom-tuning of these queries by introducing declared
                                    queries as needed.</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.query-methods.query-creation"><a class="anchor"
                                                                          href="#repositories.query-methods.query-creation"></a>4.4.2.
                        Query creation</h4>
                    <div class="paragraph">
                        <p>The query builder mechanism built into Spring Data repository infrastructure is useful for
                            building constraining queries over entities of the repository. The mechanism strips the
                            prefixes <code>find…By</code>, <code>read…By</code>, <code>query…By</code>,
                            <code>count…By</code>, and <code>get…By</code> from the method and starts parsing the rest
                            of it. The introducing clause can contain further expressions such as a
                            <code>Distinct</code> to set a distinct flag on the query to be created. However, the first
                            <code>By</code> acts as delimiter to indicate the start of the actual criteria. At a very
                            basic level you can define conditions on entity properties and concatenate them with <code>And</code>
                            and <code>Or</code>.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 13. Query creation from method names</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">PersonRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">Repository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">&gt;</span><span class="pln"> findByEmailAddressAndLastname</span><span class="pun">(</span><span
        class="typ">EmailAddress</span><span class="pln"> emailAddress</span><span class="pun">,</span><span
        class="pln"> </span><span class="typ">String</span><span class="pln"> lastname</span><span class="pun">);</span><span
        class="pln">

  </span><span class="com">// Enables the distinct flag for the query</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">&gt;</span><span class="pln"> findDistinctPeopleByLastnameOrFirstname</span><span
        class="pun">(</span><span class="typ">String</span><span class="pln"> lastname</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstname</span><span
        class="pun">);</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">&gt;</span><span class="pln"> findPeopleDistinctByLastnameOrFirstname</span><span
        class="pun">(</span><span class="typ">String</span><span class="pln"> lastname</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstname</span><span
        class="pun">);</span><span class="pln">

  </span><span class="com">// Enabling ignoring case for an individual property</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">&gt;</span><span class="pln"> findByLastnameIgnoreCase</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> lastname</span><span class="pun">);</span><span class="pln">
  </span><span class="com">// Enabling ignoring case for all suitable properties</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">&gt;</span><span class="pln"> findByLastnameAndFirstnameAllIgnoreCase</span><span
        class="pun">(</span><span class="typ">String</span><span class="pln"> lastname</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstname</span><span
        class="pun">);</span><span class="pln">

  </span><span class="com">// Enabling static ORDER BY for a query</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">&gt;</span><span class="pln"> findByLastnameOrderByFirstnameAsc</span><span
        class="pun">(</span><span class="typ">String</span><span class="pln"> lastname</span><span class="pun">);</span><span
        class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">&gt;</span><span class="pln"> findByLastnameOrderByFirstnameDesc</span><span
        class="pun">(</span><span class="typ">String</span><span class="pln"> lastname</span><span class="pun">);</span><span
        class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>The actual result of parsing the method depends on the persistence store for which you create
                            the query. However, there are some general things to notice.</p>
                    </div>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p>The expressions are usually property traversals combined with operators that can be
                                    concatenated. You can combine property expressions with <code>AND</code> and <code>OR</code>.
                                    You also get support for operators such as <code>Between</code>,
                                    <code>LessThan</code>, <code>GreaterThan</code>, <code>Like</code> for the property
                                    expressions. The supported operators can vary by datastore, so consult the
                                    appropriate part of your reference documentation.</p>
                            </li>
                            <li>
                                <p>The method parser supports setting an <code>IgnoreCase</code> flag for individual
                                    properties (for example, <code>findByLastnameIgnoreCase(…)</code>) or for all
                                    properties of a type that support ignoring case (usually <code>String</code>
                                    instances, for example, <code>findByLastnameAndFirstnameAllIgnoreCase(…)</code>).
                                    Whether ignoring cases is supported may vary by store, so consult the relevant
                                    sections in the reference documentation for the store-specific query method.</p>
                            </li>
                            <li>
                                <p>You can apply static ordering by appending an <code>OrderBy</code> clause to the
                                    query method that references a property and by providing a sorting direction (<code>Asc</code>
                                    or <code>Desc</code>). To create a query method that supports dynamic sorting, see
                                    <a href="#repositories.special-parameters">Special parameter handling</a>.</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.query-methods.query-property-expressions"><a class="anchor"
                                                                                      href="#repositories.query-methods.query-property-expressions"></a>4.4.3.
                        Property expressions</h4>
                    <div class="paragraph">
                        <p>Property expressions can refer only to a direct property of the managed entity, as shown in
                            the preceding example. At query creation time you already make sure that the parsed property
                            is a property of the managed domain class. However, you can also define constraints by
                            traversing nested properties. Assume a <code>Person</code> has an <code>Address</code> with
                            a <code>ZipCode</code>. In that case a method name of</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
                            <pre class="prettyprint highlight prettyprinted" style=""><code class="language-java"
                                                                                            data-lang="java"><span
                                    class="typ">List</span><span class="pun">&lt;</span><span
                                    class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> findByAddressZipCode</span><span
                                    class="pun">(</span><span class="typ">ZipCode</span><span
                                    class="pln"> zipCode</span><span class="pun">);</span></code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>creates the property traversal <code>x.address.zipCode</code>. The resolution algorithm
                            starts with interpreting the entire part (<code>AddressZipCode</code>) as the property and
                            checks the domain class for a property with that name (uncapitalized). If the algorithm
                            succeeds it uses that property. If not, the algorithm splits up the source at the camel case
                            parts from the right side into a head and a tail and tries to find the corresponding
                            property, in our example, <code>AddressZip</code> and <code>Code</code>. If the algorithm
                            finds a property with that head it takes the tail and continue building the tree down from
                            there, splitting the tail up in the way just described. If the first split does not match,
                            the algorithm move the split point to the left (<code>Address</code>, <code>ZipCode</code>)
                            and continues.</p>
                    </div>
                    <div class="paragraph">
                        <p>Although this should work for most cases, it is possible for the algorithm to select the
                            wrong property. Suppose the <code>Person</code> class has an <code>addressZip</code>
                            property as well. The algorithm would match in the first split round already and essentially
                            choose the wrong property and finally fail (as the type of <code>addressZip</code> probably
                            has no <code>code</code> property).</p>
                    </div>
                    <div class="paragraph">
                        <p>To resolve this ambiguity you can use <code>_</code> inside your method name to manually
                            define traversal points. So our method name would end up like so:</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
                            <pre class="prettyprint highlight prettyprinted" style=""><code class="language-java"
                                                                                            data-lang="java"><span
                                    class="typ">List</span><span class="pun">&lt;</span><span
                                    class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> findByAddress_ZipCode</span><span
                                    class="pun">(</span><span class="typ">ZipCode</span><span
                                    class="pln"> zipCode</span><span class="pun">);</span></code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>As we treat underscore as a reserved character we strongly advise to follow standard Java
                            naming conventions (i.e. <strong>not</strong> using underscores in property names but camel
                            case instead).</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.special-parameters"><a class="anchor"
                                                                href="#repositories.special-parameters"></a>4.4.4.
                        Special parameter handling</h4>
                    <div class="paragraph">
                        <p>To handle parameters in your query you simply define method parameters as already seen in the
                            examples above. Besides that the infrastructure will recognize certain specific types like
                            <code>Pageable</code> and <code>Sort</code> to apply pagination and sorting to your queries
                            dynamically.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 14. Using Pageable, Slice and Sort in query methods</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">Page</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Slice</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Sort</span><span class="pln"> sort</span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">);</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>The first method allows you to pass an <code>org.springframework.data.domain.Pageable</code>
                            instance to the query method to dynamically add paging to your statically defined query. A
                            <code>Page</code> knows about the total number of elements and pages available. It does so
                            by the infrastructure triggering a count query to calculate the overall number. As this
                            might be expensive depending on the store used, <code>Slice</code> can be used as return
                            instead. A <code>Slice</code> only knows about whether there’s a next <code>Slice</code>
                            available which might be just sufficient when walking through a larger result set.</p>
                    </div>
                    <div class="paragraph">
                        <p>Sorting options are handled through the <code>Pageable</code> instance too. If you only need
                            sorting, simply add an <code>org.springframework.data.domain.Sort</code> parameter to your
                            method. As you also can see, simply returning a <code>List</code> is possible as well. In
                            this case the additional metadata required to build the actual <code>Page</code> instance
                            will not be created (which in turn means that the additional count query that would have
                            been necessary not being issued) but rather simply restricts the query to look up only the
                            given range of entities.</p>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    To find out how many pages you get for a query entirely you have to trigger an
                                    additional count query. By default this query will be derived from the query you
                                    actually trigger.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.limit-query-result"><a class="anchor"
                                                                href="#repositories.limit-query-result"></a>4.4.5.
                        Limiting query results</h4>
                    <div class="paragraph">
                        <p>The results of query methods can be limited via the keywords <code>first</code> or
                            <code>top</code>, which can be used interchangeably. An optional numeric value can be
                            appended to top/first to specify the maximum result size to be returned.
                            If the number is left out, a result size of 1 is assumed.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 15. Limiting the result size of a query with <code>Top</code> and
                            <code>First</code></div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">User</span><span class="pln"> findFirstByOrderByLastnameAsc</span><span class="pun">();</span><span
        class="pln">

</span><span class="typ">User</span><span class="pln"> findTopByOrderByAgeDesc</span><span class="pun">();</span><span
        class="pln">

</span><span class="typ">Page</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> queryFirst10ByLastname</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> lastname</span><span class="pun">,</span><span
        class="pln"> </span><span class="typ">Pageable</span><span class="pln"> pageable</span><span
        class="pun">);</span><span class="pln">

</span><span class="typ">Slice</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findTop3ByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">);</span><span class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findFirst10ByLastname</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> lastname</span><span class="pun">,</span><span
        class="pln"> </span><span class="typ">Sort</span><span class="pln"> sort</span><span class="pun">);</span><span
        class="pln">

</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findTop10ByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">);</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>The limiting expressions also support the <code>Distinct</code> keyword. Also, for the
                            queries limiting the result set to one instance, wrapping the result into an
                            <code>Optional</code> is supported.</p>
                    </div>
                    <div class="paragraph">
                        <p>If pagination or slicing is applied to a limiting query pagination (and the calculation of
                            the number of pages available) then it is applied within the limited result.</p>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    Note that limiting the results in combination with dynamic sorting via a
                                    <code>Sort</code> parameter allows to express query methods for the 'K' smallest as
                                    well as for the 'K' biggest elements.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.query-streaming"><a class="anchor" href="#repositories.query-streaming"></a>4.4.6.
                        Streaming query results</h4>
                    <div class="paragraph">
                        <p>The results of query methods can be processed incrementally by using a Java 8 <code>Stream&lt;T&gt;</code>
                            as return type. Instead of simply wrapping the query results in a <code>Stream</code> data
                            store specific methods are used to perform the streaming.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 16. Stream the result of a query with Java 8
                            <code>Stream&lt;T&gt;</code></div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Query</span><span class="pun">(</span><span class="str">"select u from User u"</span><span
        class="pun">)</span><span class="pln">
</span><span class="typ">Stream</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findAllByCustomQueryAndStream</span><span class="pun">();</span><span
        class="pln">

</span><span class="typ">Stream</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> readAllByFirstnameNotNull</span><span class="pun">();</span><span
        class="pln">

</span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"select u from User u"</span><span
        class="pun">)</span><span class="pln">
</span><span class="typ">Stream</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> streamAllPaged</span><span class="pun">(</span><span class="typ">Pageable</span><span
        class="pln"> pageable</span><span class="pun">);</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    A <code>Stream</code> potentially wraps underlying data store specific resources and
                                    must therefore be closed after usage. You can either manually close the
                                    <code>Stream</code> using the <code>close()</code> method or by using a Java 7
                                    try-with-resources block.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 17. Working with a <code>Stream&lt;T&gt;</code> result in a
                            try-with-resources block
                        </div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Stream</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">&gt;</span><span
        class="pln"> stream </span><span class="pun">=</span><span class="pln"> repository</span><span
        class="pun">.</span><span class="pln">findAllByCustomQueryAndStream</span><span class="pun">())</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
  stream</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(…);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    Not all Spring Data modules currently support <code>Stream&lt;T&gt;</code> as a
                                    return type.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.query-async"><a class="anchor" href="#repositories.query-async"></a>4.4.7.
                        Async query results</h4>
                    <div class="paragraph">
                        <p>Repository queries can be executed asynchronously using <a
                                href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html#scheduling">Spring’s
                            asynchronous method execution capability</a>. This means the method will return immediately
                            upon invocation and the actual query execution will occur in a task that has been submitted
                            to a Spring TaskExecutor.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Async</span><span class="pln">
</span><span class="typ">Future</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByFirstname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> firstname</span><span class="pun">);</span><span class="pln">               </span><i class="conum"
                                                                                                           data-value="1"></i><b><span
        class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="lit">@Async</span><span class="pln">
</span><span class="typ">CompletableFuture</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findOneByFirstname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> firstname</span><span class="pun">);</span><span class="pln"> </span><i class="conum"
                                                                                             data-value="2"></i><b><span
        class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="lit">@Async</span><span class="pln">
</span><span class="typ">ListenableFuture</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findOneByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">);</span><span class="pln">    </span><i class="conum"
                                                                                               data-value="3"></i><b><span
        class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
                                </div>
                            </div>
                            <div class="colist arabic">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td><i class="conum" data-value="1"></i><b>1</b></td>
                                        <td>Use <code>java.util.concurrent.Future</code> as return type.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="2"></i><b>2</b></td>
                                        <td>Use a Java 8 <code>java.util.concurrent.CompletableFuture</code> as return
                                            type.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="3"></i><b>3</b></td>
                                        <td>Use a <code>org.springframework.util.concurrent.ListenableFuture</code> as
                                            return type.
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="repositories.create-instances"><a class="anchor" href="#repositories.create-instances"></a>4.5.
                    Creating repository instances</h3>
                <div class="paragraph">
                    <p>In this section you create instances and bean definitions for the repository interfaces defined.
                        One way to do so is using the Spring namespace that is shipped with each Spring Data module that
                        supports the repository mechanism although we generally recommend to use the Java-Config style
                        configuration.</p>
                </div>
                <div class="sect3">
                    <h4 id="repositories.create-instances.spring"><a class="anchor"
                                                                     href="#repositories.create-instances.spring"></a>4.5.1.
                        XML configuration</h4>
                    <div class="paragraph">
                        <p>Each Spring Data module includes a repositories element that allows you to simply define a
                            base package that Spring scans for you.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 18. Enabling Spring Data repositories via XML</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span
        class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span
        class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;beans:beans</span><span class="pln"> </span><span class="atn">xmlns:beans</span><span
        class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans"</span><span class="pln">
  </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span
        class="pln">
  </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/data/jpa"</span><span
        class="pln">
  </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa
    http://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span><span class="tag">&gt;</span><span class="pln">

  </span><span class="tag">&lt;repositories</span><span class="pln"> </span><span class="atn">base-package</span><span
        class="pun">=</span><span class="atv">"com.acme.repositories"</span><span class="pln"> </span><span class="tag">/&gt;</span><span
        class="pln">

</span><span class="tag">&lt;/beans:beans&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>In the preceding example, Spring is instructed to scan <code>com.acme.repositories</code> and
                            all its sub-packages for interfaces extending <code>Repository</code> or one of its
                            sub-interfaces. For each interface found, the infrastructure registers the persistence
                            technology-specific <code>FactoryBean</code> to create the appropriate proxies that handle
                            invocations of the query methods. Each bean is registered under a bean name that is derived
                            from the interface name, so an interface of <code>UserRepository</code> would be registered
                            under <code>userRepository</code>. The <code>base-package</code> attribute allows wildcards,
                            so that you can define a pattern of scanned packages.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="_using_filters"><a class="anchor" href="#_using_filters"></a>Using filters</h5>
                        <div class="paragraph">
                            <p>By default the infrastructure picks up every interface extending the persistence
                                technology-specific <code>Repository</code> sub-interface located under the configured
                                base package and creates a bean instance for it. However, you might want more
                                fine-grained control over which interfaces bean instances get created for. To do this
                                you use <code>&lt;include-filter /&gt;</code> and <code>&lt;exclude-filter /&gt;</code>
                                elements inside <code>&lt;repositories /&gt;</code>. The semantics are exactly
                                equivalent to the elements in Spring’s context namespace. For details, see <a
                                        href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/beans.html#beans-scanning-filters">Spring
                                    reference documentation</a> on these elements.</p>
                        </div>
                        <div class="paragraph">
                            <p>For example, to exclude certain interfaces from instantiation as repository, you could
                                use the following configuration:</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 19. Using exclude-filter element</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;repositories</span><span
        class="pln"> </span><span class="atn">base-package</span><span class="pun">=</span><span class="atv">"com.acme.repositories"</span><span
        class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;context:exclude-filter</span><span class="pln"> </span><span class="atn">type</span><span
        class="pun">=</span><span class="atv">"regex"</span><span class="pln"> </span><span
        class="atn">expression</span><span class="pun">=</span><span class="atv">".*SomeRepository"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/repositories&gt;</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>This example excludes all interfaces ending in <code>SomeRepository</code> from being
                                instantiated.</p>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.create-instances.java-config"><a class="anchor"
                                                                          href="#repositories.create-instances.java-config"></a>4.5.2.
                        JavaConfig</h4>
                    <div class="paragraph">
                        <p>The repository infrastructure can also be triggered using a store-specific <code>@Enable${store}Repositories</code>
                            annotation on a JavaConfig class. For an introduction into Java-based configuration of the
                            Spring container, see the reference documentation.<sup class="footnote">[<a
                                    id="_footnoteref_1" class="footnote" href="#_footnote_1"
                                    title="View footnote.">1</a>]</sup></p>
                    </div>
                    <div class="paragraph">
                        <p>A sample configuration to enable Spring Data repositories looks something like this.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 20. Sample annotation based repository configuration</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Configuration</span><span class="pln">
</span><span class="lit">@EnableJpaRepositories</span><span class="pun">(</span><span class="str">"com.acme.repositories"</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ApplicationConfiguration</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Bean</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">EntityManagerFactory</span><span
        class="pln"> entityManagerFactory</span><span class="pun">()</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">
    </span><span class="com">// …</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    The sample uses the JPA-specific annotation, which you would change according to the
                                    store module you actually use. The same applies to the definition of the <code>EntityManagerFactory</code>
                                    bean. Consult the sections covering the store-specific configuration.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.create-instances.standalone"><a class="anchor"
                                                                         href="#repositories.create-instances.standalone"></a>4.5.3.
                        Standalone usage</h4>
                    <div class="paragraph">
                        <p>You can also use the repository infrastructure outside of a Spring container, e.g. in CDI
                            environments. You still need some Spring libraries in your classpath, but generally you can
                            set up repositories programmatically as well. The Spring Data modules that provide
                            repository support ship a persistence technology-specific RepositoryFactory that you can use
                            as follows.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 21. Standalone usage of repository factory</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">RepositoryFactorySupport</span><span class="pln"> factory </span><span class="pun">=</span><span
        class="pln"> </span><span class="pun">…</span><span class="pln"> </span><span class="com">// Instantiate factory here</span><span
        class="pln">
</span><span class="typ">UserRepository</span><span class="pln"> repository </span><span class="pun">=</span><span
        class="pln"> factory</span><span class="pun">.</span><span class="pln">getRepository</span><span
        class="pun">(</span><span class="typ">UserRepository</span><span class="pun">.</span><span
        class="kwd">class</span><span class="pun">);</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="repositories.custom-implementations"><a class="anchor"
                                                                href="#repositories.custom-implementations"></a>4.6.
                    Custom implementations for Spring Data repositories</h3>
                <div class="paragraph">
                    <p>Often it is necessary to provide a custom implementation for a few repository methods. Spring
                        Data repositories easily allow you to provide custom repository code and integrate it with
                        generic CRUD abstraction and query method functionality.</p>
                </div>
                <div class="sect3">
                    <h4 id="repositories.single-repository-behaviour"><a class="anchor"
                                                                         href="#repositories.single-repository-behaviour"></a>4.6.1.
                        Adding custom behavior to single repositories</h4>
                    <div class="paragraph">
                        <p>To enrich a repository with custom functionality you first define an interface and an
                            implementation for the custom functionality. Use the repository interface you provided to
                            extend the custom interface.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 22. Interface for custom repository functionality</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepositoryCustom</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> someCustomMethod</span><span
        class="pun">(</span><span class="typ">User</span><span class="pln"> user</span><span class="pun">);</span><span
        class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 23. Implementation of custom repository functionality</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">class</span><span class="pln"> </span><span class="typ">UserRepositoryImpl</span><span
        class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">UserRepositoryCustom</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> someCustomMethod</span><span
        class="pun">(</span><span class="typ">User</span><span class="pln"> user</span><span class="pun">)</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// Your custom implementation</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    The most important bit for the class to be found is the <code>Impl</code> postfix of
                                    the name on it compared to the core repository interface (see below).
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="paragraph">
                        <p>The implementation itself does not depend on Spring Data and can be a regular Spring bean. So
                            you can use standard dependency injection behavior to inject references to other beans like
                            a <code>JdbcTemplate</code>, take part in aspects, and so on.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 24. Changes to the your basic repository interface</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">CrudRepository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;,</span><span
        class="pln"> </span><span class="typ">UserRepositoryCustom</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">

  </span><span class="com">// Declare query methods here</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Let your standard repository interface extend the custom one. Doing so combines the CRUD and
                            custom functionality and makes it available to clients.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h5>
                        <div class="paragraph">
                            <p>If you use namespace configuration, the repository infrastructure tries to autodetect
                                custom implementations by scanning for classes below the package we found a repository
                                in. These classes need to follow the naming convention of appending the namespace
                                element’s attribute <code>repository-impl-postfix</code> to the found repository
                                interface name. This postfix defaults to <code>Impl</code>.</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 25. Configuration example</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;repositories</span><span
        class="pln"> </span><span class="atn">base-package</span><span class="pun">=</span><span class="atv">"com.acme.repository"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;repositories</span><span class="pln"> </span><span class="atn">base-package</span><span
        class="pun">=</span><span class="atv">"com.acme.repository"</span><span class="pln"> </span><span class="atn">repository-impl-postfix</span><span
        class="pun">=</span><span class="atv">"FooBar"</span><span class="pln"> </span><span
        class="tag">/&gt;</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>The first configuration example will try to look up a class <code>com.acme.repository.UserRepositoryImpl</code>
                                to act as custom repository implementation, whereas the second example will try to
                                lookup <code>com.acme.repository.UserRepositoryFooBar</code>.</p>
                        </div>
                        <div class="sect5">
                            <h6 id="_manual_wiring"><a class="anchor" href="#_manual_wiring"></a>Manual wiring</h6>
                            <div class="paragraph">
                                <p>The approach just shown works well if your custom implementation uses
                                    annotation-based configuration and autowiring only, as it will be treated as any
                                    other Spring bean. If your custom implementation bean needs special wiring, you
                                    simply declare the bean and name it after the conventions just described. The
                                    infrastructure will then refer to the manually defined bean definition by name
                                    instead of creating one itself.</p>
                            </div>
                            <div class="exampleblock">
                                <div class="title">Example 26. Manual wiring of custom implementations</div>
                                <div class="content">
                                    <div class="listingblock">
                                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;repositories</span><span
        class="pln"> </span><span class="atn">base-package</span><span class="pun">=</span><span class="atv">"com.acme.repository"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;beans:bean</span><span class="pln"> </span><span class="atn">id</span><span
        class="pun">=</span><span class="atv">"userRepositoryImpl"</span><span class="pln"> </span><span class="atn">class</span><span
        class="pun">=</span><span class="atv">"…"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="com">&lt;!-- further configuration --&gt;</span><span class="pln">
</span><span class="tag">&lt;/beans:bean&gt;</span></code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="repositories.custom-behaviour-for-all-repositories"><a class="anchor"
                                                                                   href="#repositories.custom-behaviour-for-all-repositories"></a>4.6.2.
                        Adding custom behavior to all repositories</h4>
                    <div class="paragraph">
                        <p>The preceding approach is not feasible when you want to add a single method to all your
                            repository interfaces. To add custom behavior to all repositories, you first add an
                            intermediate interface to declare the shared behavior.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 27. An interface declaring custom shared behavior</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@NoRepositoryBean</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">MyRepository</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">,</span><span class="pln"> ID </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Serializable</span><span class="pun">&gt;</span><span class="pln">
  </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">PagingAndSortingRepository</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">,</span><span class="pln"> ID</span><span class="pun">&gt;</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">

  </span><span class="kwd">void</span><span class="pln"> sharedCustomMethod</span><span class="pun">(</span><span
        class="pln">ID id</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Now your individual repository interfaces will extend this intermediate interface instead of
                            the <code>Repository</code> interface to include the functionality declared. Next, create an
                            implementation of the intermediate interface that extends the persistence
                            technology-specific repository base class. This class will then act as a custom base class
                            for the repository proxies.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 28. Custom repository base class</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">MyRepositoryImpl</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">,</span><span class="pln"> ID </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Serializable</span><span class="pun">&gt;</span><span class="pln">
  </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">SimpleJpaRepository</span><span
        class="pun">&lt;</span><span class="pln">T</span><span class="pun">,</span><span class="pln"> ID</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="kwd">implements</span><span
        class="pln"> </span><span class="typ">MyRepository</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">,</span><span class="pln"> ID</span><span class="pun">&gt;</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">

  </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span
        class="pln"> </span><span class="typ">EntityManager</span><span class="pln"> entityManager</span><span
        class="pun">;</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">MyRepositoryImpl</span><span
        class="pun">(</span><span class="typ">JpaEntityInformation</span><span
        class="pln"> entityInformation</span><span class="pun">,</span><span class="pln">
                          </span><span class="typ">EntityManager</span><span class="pln"> entityManager</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">entityInformation</span><span
        class="pun">,</span><span class="pln"> entityManager</span><span class="pun">);</span><span class="pln">

    </span><span class="com">// Keep the EntityManager around to used from the newly introduced methods.</span><span
        class="pln">
    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">entityManager </span><span
        class="pun">=</span><span class="pln"> entityManager</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sharedCustomMethod</span><span
        class="pun">(</span><span class="pln">ID id</span><span class="pun">)</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">
    </span><span class="com">// implementation goes here</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock warning">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-warning" title="Warning"></i>
                                </td>
                                <td class="content">
                                    The class needs to have a constructor of the super class which the store-specific
                                    repository factory implementation is using. In case the repository base class has
                                    multiple constructors, override the one taking an <code>EntityInformation</code>
                                    plus a store specific infrastructure object (e.g. an <code>EntityManager</code> or a
                                    template class).
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="paragraph">
                        <p>The default behavior of the Spring <code>&lt;repositories /&gt;</code> namespace is to
                            provide an implementation for all interfaces that fall under the <code>base-package</code>.
                            This means that if left in its current state, an implementation instance of <code>MyRepository</code>
                            will be created by Spring. This is of course not desired as it is just supposed to act as an
                            intermediary between <code>Repository</code> and the actual repository interfaces you want
                            to define for each entity. To exclude an interface that extends <code>Repository</code> from
                            being instantiated as a repository instance, you can either annotate it with <code>@NoRepositoryBean</code>
                            (as seen above) or move it outside of the configured <code>base-package</code>.</p>
                    </div>
                    <div class="paragraph">
                        <p>The final step is to make the Spring Data infrastructure aware of the customized repository
                            base class. In JavaConfig this is achieved by using the <code>repositoryBaseClass</code>
                            attribute of the <code>@Enable…Repositories</code> annotation:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 29. Configuring a custom repository base class using JavaConfig</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Configuration</span><span class="pln">
</span><span class="lit">@EnableJpaRepositories</span><span class="pun">(</span><span
        class="pln">repositoryBaseClass </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MyRepositoryImpl</span><span
        class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ApplicationConfiguration</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">…</span><span
        class="pln"> </span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>A corresponding attribute is available in the XML namespace.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 30. Configuring a custom repository base class using XML</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;repositories</span><span
        class="pln"> </span><span class="atn">base-package</span><span class="pun">=</span><span class="atv">"com.acme.repository"</span><span
        class="pln">
     </span><span class="atn">base-class</span><span class="pun">=</span><span
        class="atv">"….MyRepositoryImpl"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="core.extensions"><a class="anchor" href="#core.extensions"></a>4.7. Spring Data extensions</h3>
                <div class="paragraph">
                    <p>This section documents a set of Spring Data extensions that enable Spring Data usage in a variety
                        of contexts. Currently most of the integration is targeted towards Spring MVC.</p>
                </div>
                <div class="sect3">
                    <h4 id="core.extensions.querydsl"><a class="anchor" href="#core.extensions.querydsl"></a>4.7.1.
                        Querydsl Extension</h4>
                    <div class="paragraph">
                        <p><a href="http://www.querydsl.com/">Querydsl</a> is a framework which enables the construction
                            of statically typed SQL-like queries via its fluent API.</p>
                    </div>
                    <div class="paragraph">
                        <p>Several Spring Data modules offer integration with Querydsl via <code>QueryDslPredicateExecutor</code>.
                        </p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 31. QueryDslPredicateExecutor interface</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">QueryDslPredicateExecutor</span><span class="pun">&lt;</span><span
        class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

    T findOne</span><span class="pun">(</span><span class="typ">Predicate</span><span class="pln"> predicate</span><span
        class="pun">);</span><span class="pln">             </span><i class="conum" data-value="1"></i><b><span
        class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

    </span><span class="typ">Iterable</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span
        class="pln"> findAll</span><span class="pun">(</span><span class="typ">Predicate</span><span class="pln"> predicate</span><span
        class="pun">);</span><span class="pln">   </span><i class="conum" data-value="2"></i><b><span
        class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

    </span><span class="kwd">long</span><span class="pln"> count</span><span class="pun">(</span><span class="typ">Predicate</span><span
        class="pln"> predicate</span><span class="pun">);</span><span class="pln">            </span><i class="conum"
                                                                                                        data-value="3"></i><b><span
        class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

    </span><span class="kwd">boolean</span><span class="pln"> exists</span><span class="pun">(</span><span class="typ">Predicate</span><span
        class="pln"> predicate</span><span class="pun">);</span><span class="pln">        </span><i class="conum"
                                                                                                    data-value="4"></i><b><span
        class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

    </span><span class="com">// … more functionality omitted.</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                            <div class="colist arabic">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td><i class="conum" data-value="1"></i><b>1</b></td>
                                        <td>Finds and returns a single entity matching the <code>Predicate</code>.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="2"></i><b>2</b></td>
                                        <td>Finds and returns all entities matching the <code>Predicate</code>.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="3"></i><b>3</b></td>
                                        <td>Returns the number of entities matching the <code>Predicate</code>.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="4"></i><b>4</b></td>
                                        <td>Returns if an entity that matches the <code>Predicate</code> exists.</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>To make use of Querydsl support simply extend <code>QueryDslPredicateExecutor</code> on your
                            repository interface.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 32. Querydsl integration on repositories</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">CrudRepository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;,</span><span
        class="pln"> </span><span class="typ">QueryDslPredicateExecutor</span><span class="pun">&lt;</span><span
        class="typ">User</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>The above enables to write typesafe queries using Querydsl <code>Predicate</code> s.</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">Predicate</span><span class="pln"> predicate </span><span class="pun">=</span><span class="pln"> user</span><span
        class="pun">.</span><span class="pln">firstname</span><span class="pun">.</span><span class="pln">equalsIgnoreCase</span><span
        class="pun">(</span><span class="str">"dave"</span><span class="pun">)</span><span class="pln">
	</span><span class="pun">.</span><span class="pln">and</span><span class="pun">(</span><span class="pln">user</span><span
        class="pun">.</span><span class="pln">lastname</span><span class="pun">.</span><span class="pln">startsWithIgnoreCase</span><span
        class="pun">(</span><span class="str">"mathews"</span><span class="pun">));</span><span class="pln">

userRepository</span><span class="pun">.</span><span class="pln">findAll</span><span class="pun">(</span><span
        class="pln">predicate</span><span class="pun">);</span></code></pre>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="core.web"><a class="anchor" href="#core.web"></a>4.7.2. Web support</h4>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    This section contains the documentation for the Spring Data web support as it is
                                    implemented as of Spring Data Commons in the 1.6 range. As it the newly introduced
                                    support changes quite a lot of things we kept the documentation of the former
                                    behavior in <a href="#web.legacy">Legacy web support</a>.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="paragraph">
                        <p>Spring Data modules ships with a variety of web support if the module supports the repository
                            programming model. The web related stuff requires Spring MVC JARs on the classpath, some of
                            them even provide integration with Spring HATEOAS <sup class="footnote">[<a
                                    id="_footnoteref_2" class="footnote" href="#_footnote_2"
                                    title="View footnote.">2</a>]</sup>. In general, the integration support is enabled
                            by using the <code>@EnableSpringDataWebSupport</code> annotation in your JavaConfig
                            configuration class.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 33. Enabling Spring Data web support</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Configuration</span><span class="pln">
</span><span class="lit">@EnableWebMvc</span><span class="pln">
</span><span class="lit">@EnableSpringDataWebSupport</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">WebConfiguration</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>The <code>@EnableSpringDataWebSupport</code> annotation registers a few components we will
                            discuss in a bit. It will also detect Spring HATEOAS on the classpath and register
                            integration components for it as well if present.</p>
                    </div>
                    <div class="paragraph">
                        <p>Alternatively, if you are using XML configuration, register either
                            <code>SpringDataWebSupport</code> or <code>HateoasAwareSpringDataWebSupport</code> as Spring
                            beans:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 34. Enabling Spring Data web support in XML</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;bean</span><span
        class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.springframework.data.web.config.SpringDataWebConfiguration"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

</span><span
        class="com">&lt;!-- If you're using Spring HATEOAS as well register this one *instead* of the former --&gt;</span><span
        class="pln">
</span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span
        class="pun">=</span><span class="atv">"org.springframework.data.web.config.HateoasAwareSpringDataWebConfiguration"</span><span
        class="pln"> </span><span class="tag">/&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="core.web.basic"><a class="anchor" href="#core.web.basic"></a>Basic web support</h5>
                        <div class="paragraph">
                            <p>The configuration setup shown above will register a few basic components:</p>
                        </div>
                        <div class="ulist">
                            <ul>
                                <li>
                                    <p>A <code>DomainClassConverter</code> to enable Spring MVC to resolve instances of
                                        repository managed domain classes from request parameters or path variables.</p>
                                </li>
                                <li>
                                    <p><code>HandlerMethodArgumentResolver</code> implementations to let Spring MVC
                                        resolve Pageable and Sort instances from request parameters.</p>
                                </li>
                            </ul>
                        </div>
                        <div class="sect5">
                            <h6 id="core.web.basic.domain-class-converter"><a class="anchor"
                                                                              href="#core.web.basic.domain-class-converter"></a>DomainClassConverter
                            </h6>
                            <div class="paragraph">
                                <p>The <code>DomainClassConverter</code> allows you to use domain types in your Spring
                                    MVC controller method signatures directly, so that you don’t have to manually lookup
                                    the instances via the repository:</p>
                            </div>
                            <div class="exampleblock">
                                <div class="title">Example 35. A Spring MVC controller using domain types in method
                                    signatures
                                </div>
                                <div class="content">
                                    <div class="listingblock">
                                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Controller</span><span class="pln">
</span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="str">"/users"</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">UserController</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="str">"/{id}"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> showUserForm</span><span
        class="pun">(</span><span class="lit">@PathVariable</span><span class="pun">(</span><span
        class="str">"id"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">User</span><span
        class="pln"> user</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Model</span><span
        class="pln"> model</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

    model</span><span class="pun">.</span><span class="pln">addAttribute</span><span class="pun">(</span><span
        class="str">"user"</span><span class="pun">,</span><span class="pln"> user</span><span
        class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"userForm"</span><span
        class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>As you can see the method receives a User instance directly and no further lookup is
                                    necessary. The instance can be resolved by letting Spring MVC convert the path
                                    variable into the id type of the domain class first and eventually access the
                                    instance through calling <code>findOne(…)</code> on the repository instance
                                    registered for the domain type.</p>
                            </div>
                            <div class="admonitionblock note">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td class="icon">
                                            <i class="fa icon-note" title="Note"></i>
                                        </td>
                                        <td class="content">
                                            Currently the repository has to implement <code>CrudRepository</code> to be
                                            eligible to be discovered for conversion.
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="sect5">
                            <h6 id="core.web.basic.paging-and-sorting"><a class="anchor"
                                                                          href="#core.web.basic.paging-and-sorting"></a>HandlerMethodArgumentResolvers
                                for Pageable and Sort</h6>
                            <div class="paragraph">
                                <p>The configuration snippet above also registers a <code>PageableHandlerMethodArgumentResolver</code>
                                    as well as an instance of <code>SortHandlerMethodArgumentResolver</code>. The
                                    registration enables <code>Pageable</code> and <code>Sort</code> being valid
                                    controller method arguments</p>
                            </div>
                            <div class="exampleblock">
                                <div class="title">Example 36. Using Pageable as controller method argument</div>
                                <div class="content">
                                    <div class="listingblock">
                                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Controller</span><span class="pln">
</span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="str">"/users"</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">UserController</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Autowired</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> repository</span><span class="pun">;</span><span class="pln">

  </span><span class="lit">@RequestMapping</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> showUsers</span><span
        class="pun">(</span><span class="typ">Model</span><span class="pln"> model</span><span class="pun">,</span><span
        class="pln"> </span><span class="typ">Pageable</span><span class="pln"> pageable</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    model</span><span class="pun">.</span><span class="pln">addAttribute</span><span class="pun">(</span><span
        class="str">"users"</span><span class="pun">,</span><span class="pln"> repository</span><span
        class="pun">.</span><span class="pln">findAll</span><span class="pun">(</span><span
        class="pln">pageable</span><span class="pun">));</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"users"</span><span
        class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>This method signature will cause Spring MVC try to derive a Pageable instance from
                                    the request parameters using the following default configuration:</p>
                            </div>
                            <table class="tableblock frame-all grid-all">
                                <caption class="title">Table 1. Request parameters evaluated for Pageable instances
                                </caption>
                                <colgroup>
                                    <col>
                                    <col>
                                </colgroup>
                                <tbody>
                                <tr>
                                    <td class="tableblock halign-left valign-top"><p class="tableblock">
                                        <code>page</code></p></td>
                                    <td class="tableblock halign-left valign-top"><p class="tableblock">Page you want to
                                        retrieve, 0 indexed and defaults to 0.</p></td>
                                </tr>
                                <tr>
                                    <td class="tableblock halign-left valign-top"><p class="tableblock">
                                        <code>size</code></p></td>
                                    <td class="tableblock halign-left valign-top"><p class="tableblock">Size of the page
                                        you want to retrieve, defaults to 20.</p></td>
                                </tr>
                                <tr>
                                    <td class="tableblock halign-left valign-top"><p class="tableblock">
                                        <code>sort</code></p></td>
                                    <td class="tableblock halign-left valign-top"><p class="tableblock">Properties that
                                        should be sorted by in the format <code>property,property(,ASC|DESC)</code>.
                                        Default sort direction is ascending. Use multiple <code>sort</code> parameters
                                        if you want to switch directions, e.g. <code>?sort=firstname&amp;sort=lastname,asc</code>.
                                    </p></td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="paragraph">
                                <p>To customize this behavior extend either <code>SpringDataWebConfiguration</code> or
                                    the HATEOAS-enabled equivalent and override the <code>pageableResolver()</code> or
                                    <code>sortResolver()</code> methods and import your customized configuration file
                                    instead of using the <code>@Enable</code>-annotation.</p>
                            </div>
                            <div class="paragraph">
                                <p>In case you need multiple <code>Pageable</code> or <code>Sort</code> instances to be
                                    resolved from the request (for multiple tables, for example) you can use Spring’s
                                    <code>@Qualifier</code> annotation to distinguish one from another. The request
                                    parameters then have to be prefixed with <code>${qualifier}_</code>. So for a method
                                    signature like this:</p>
                            </div>
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span
        class="pln"> showUsers</span><span class="pun">(</span><span class="typ">Model</span><span
        class="pln"> model</span><span class="pun">,</span><span class="pln">
      </span><span class="lit">@Qualifier</span><span class="pun">(</span><span class="str">"foo"</span><span
        class="pun">)</span><span class="pln"> </span><span class="typ">Pageable</span><span
        class="pln"> first</span><span class="pun">,</span><span class="pln">
      </span><span class="lit">@Qualifier</span><span class="pun">(</span><span class="str">"bar"</span><span
        class="pun">)</span><span class="pln"> </span><span class="typ">Pageable</span><span
        class="pln"> second</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln"> </span><span class="pun">…</span><span class="pln"> </span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>you have to populate <code>foo_page</code> and <code>bar_page</code> etc.</p>
                            </div>
                            <div class="paragraph">
                                <p>The default <code>Pageable</code> handed into the method is equivalent to a <code>new
                                    PageRequest(0, 20)</code> but can be customized using the
                                    <code>@PageableDefaults</code> annotation on the <code>Pageable</code> parameter.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="core.web.pageables"><a class="anchor" href="#core.web.pageables"></a>Hypermedia support
                            for Pageables</h5>
                        <div class="paragraph">
                            <p>Spring HATEOAS ships with a representation model class <code>PagedResources</code> that
                                allows enriching the content of a <code>Page</code> instance with the necessary <code>Page</code>
                                metadata as well as links to let the clients easily navigate the pages. The conversion
                                of a Page to a <code>PagedResources</code> is done by an implementation of the Spring
                                HATEOAS <code>ResourceAssembler</code> interface, the
                                <code>PagedResourcesAssembler</code>.</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 37. Using a PagedResourcesAssembler as controller method
                                argument
                            </div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Controller</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonController</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Autowired</span><span class="pln"> </span><span class="typ">PersonRepository</span><span
        class="pln"> repository</span><span class="pun">;</span><span class="pln">

  </span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="pln">value </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"/persons"</span><span class="pun">,</span><span
        class="pln"> method </span><span class="pun">=</span><span class="pln"> </span><span
        class="typ">RequestMethod</span><span class="pun">.</span><span class="pln">GET</span><span class="pun">)</span><span
        class="pln">
  </span><span class="typ">HttpEntity</span><span class="pun">&lt;</span><span class="typ">PagedResources</span><span
        class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;&gt;</span><span class="pln"> persons</span><span
        class="pun">(</span><span class="typ">Pageable</span><span class="pln"> pageable</span><span
        class="pun">,</span><span class="pln">
    </span><span class="typ">PagedResourcesAssembler</span><span class="pln"> assembler</span><span class="pun">)</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">Page</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span
        class="pln"> persons </span><span class="pun">=</span><span class="pln"> repository</span><span
        class="pun">.</span><span class="pln">findAll</span><span class="pun">(</span><span
        class="pln">pageable</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span
        class="pln"> </span><span class="typ">ResponseEntity</span><span class="pun">&lt;&gt;(</span><span class="pln">assembler</span><span
        class="pun">.</span><span class="pln">toResources</span><span class="pun">(</span><span
        class="pln">persons</span><span class="pun">),</span><span class="pln"> </span><span
        class="typ">HttpStatus</span><span class="pun">.</span><span class="pln">OK</span><span
        class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>Enabling the configuration as shown above allows the <code>PagedResourcesAssembler</code>
                                to be used as controller method argument. Calling <code>toResources(…)</code> on it will
                                cause the following:</p>
                        </div>
                        <div class="ulist">
                            <ul>
                                <li>
                                    <p>The content of the <code>Page</code> will become the content of the <code>PagedResources</code>
                                        instance.</p>
                                </li>
                                <li>
                                    <p>The <code>PagedResources</code> will get a <code>PageMetadata</code> instance
                                        attached populated with information form the <code>Page</code> and the
                                        underlying <code>PageRequest</code>.</p>
                                </li>
                                <li>
                                    <p>The <code>PagedResources</code> gets <code>prev</code> and <code>next</code>
                                        links attached depending on the page’s state. The links will point to the URI
                                        the method invoked is mapped to. The pagination parameters added to the method
                                        will match the setup of the <code>PageableHandlerMethodArgumentResolver</code>
                                        to make sure the links can be resolved later on.</p>
                                </li>
                            </ul>
                        </div>
                        <div class="paragraph">
                            <p>Assume we have 30 Person instances in the database. You can now trigger a request <code>GET
                                <a href="http://localhost:8080/persons"
                                   class="bare">http://localhost:8080/persons</a></code> and you’ll see something
                                similar to this:</p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-javascript" data-lang="javascript"><span
        class="pun">{</span><span class="pln"> </span><span class="str">"links"</span><span class="pln"> </span><span
        class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln"> </span><span class="str">"rel"</span><span class="pln"> </span><span
        class="pun">:</span><span class="pln"> </span><span class="str">"next"</span><span class="pun">,</span><span
        class="pln">
                </span><span class="str">"href"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="str">"</span><span class="pln">http</span><span class="pun">:</span><span
        class="com">//localhost:8080/persons?page=1&amp;size=20 }</span><span class="pln">
  </span><span class="pun">],</span><span class="pln">
  </span><span class="str">"content"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="pun">[</span><span class="pln">
     </span><span class="pun">…</span><span class="pln"> </span><span
        class="com">// 20 Person instances rendered here</span><span class="pln">
  </span><span class="pun">],</span><span class="pln">
  </span><span class="str">"pageMetadata"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">"size"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span
        class="lit">20</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"totalElements"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="lit">30</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"totalPages"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
    </span><span class="str">"number"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="lit">0</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>You see that the assembler produced the correct URI and also picks up the default
                                configuration present to resolve the parameters into a <code>Pageable</code> for an
                                upcoming request. This means, if you change that configuration, the links will
                                automatically adhere to the change. By default the assembler points to the controller
                                method it was invoked in but that can be customized by handing in a custom
                                <code>Link</code> to be used as base to build the pagination links to overloads of the
                                <code>PagedResourcesAssembler.toResource(…)</code> method.</p>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="core.web.type-safe"><a class="anchor" href="#core.web.type-safe"></a>Querydsl web
                            support</h5>
                        <div class="paragraph">
                            <p>For those stores having <a href="http://www.querydsl.com/">QueryDSL</a> integration it is
                                possible to derive queries from the attributes contained in a <code>Request</code> query
                                string.</p>
                        </div>
                        <div class="paragraph">
                            <p>This means that given the <code>User</code> object from previous samples a query string
                            </p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
                                <pre class="prettyprint highlight prettyprinted" style=""><code class="language-text"
                                                                                                data-lang="text"><span
                                        class="pun">?</span><span class="pln">firstname</span><span class="pun">=</span><span
                                        class="typ">Dave</span><span class="pun">&amp;</span><span
                                        class="pln">lastname</span><span class="pun">=</span><span
                                        class="typ">Matthews</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>can be resolved to</p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
                                <pre class="prettyprint highlight prettyprinted" style=""><code class="language-text"
                                                                                                data-lang="text"><span
                                        class="typ">QUser</span><span class="pun">.</span><span
                                        class="pln">user</span><span class="pun">.</span><span
                                        class="pln">firstname</span><span class="pun">.</span><span
                                        class="pln">eq</span><span class="pun">(</span><span
                                        class="str">"Dave"</span><span class="pun">).</span><span class="kwd">and</span><span
                                        class="pun">(</span><span class="typ">QUser</span><span
                                        class="pun">.</span><span class="pln">user</span><span class="pun">.</span><span
                                        class="pln">lastname</span><span class="pun">.</span><span class="pln">eq</span><span
                                        class="pun">(</span><span class="str">"Matthews"</span><span
                                        class="pun">))</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>using the <code>QuerydslPredicateArgumentResolver</code>.</p>
                        </div>
                        <div class="admonitionblock note">
                            <table>
                                <tbody>
                                <tr>
                                    <td class="icon">
                                        <i class="fa icon-note" title="Note"></i>
                                    </td>
                                    <td class="content">
                                        The feature will be automatically enabled along <code>@EnableSpringDataWebSupport</code>
                                        when Querydsl is found on the classpath.
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="paragraph">
                            <p>Adding a <code>@QuerydslPredicate</code> to the method signature will provide a ready to
                                use <code>Predicate</code> which can be executed via the
                                <code>QueryDslPredicateExecutor</code>.</p>
                        </div>
                        <div class="admonitionblock tip">
                            <table>
                                <tbody>
                                <tr>
                                    <td class="icon">
                                        <i class="fa icon-tip" title="Tip"></i>
                                    </td>
                                    <td class="content">
                                        Type information is typically resolved from the methods return type. Since those
                                        information does not necessarily match the domain type it might be a good idea
                                        to use the <code>root</code> attribute of <code>QuerydslPredicate</code>.
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="exampleblock">
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Controller</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">UserController</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Autowired</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> repository</span><span class="pun">;</span><span class="pln">

  </span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="pln">value </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"/"</span><span class="pun">,</span><span
        class="pln"> method </span><span class="pun">=</span><span class="pln"> </span><span
        class="typ">RequestMethod</span><span class="pun">.</span><span class="pln">GET</span><span class="pun">)</span><span
        class="pln">
  </span><span class="typ">String</span><span class="pln"> index</span><span class="pun">(</span><span
        class="typ">Model</span><span class="pln"> model</span><span class="pun">,</span><span class="pln"> </span><span
        class="lit">@QuerydslPredicate</span><span class="pun">(</span><span class="pln">root </span><span
        class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">.</span><span
        class="kwd">class</span><span class="pun">)</span><span class="pln"> </span><span
        class="typ">Predicate</span><span class="pln"> predicate</span><span class="pun">,</span><span
        class="pln">    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span
        class="lit">1</span><span class="pun">)</span></b><span class="pln">
          </span><span class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">,</span><span
        class="pln"> </span><span class="lit">@RequestParam</span><span class="pln"> </span><span class="typ">MultiValueMap</span><span
        class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">String</span><span class="pun">&gt;</span><span class="pln"> parameters</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    model</span><span class="pun">.</span><span class="pln">addAttribute</span><span class="pun">(</span><span
        class="str">"users"</span><span class="pun">,</span><span class="pln"> repository</span><span
        class="pun">.</span><span class="pln">findAll</span><span class="pun">(</span><span class="pln">predicate</span><span
        class="pun">,</span><span class="pln"> pageable</span><span class="pun">));</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"index"</span><span
        class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                                <div class="colist arabic">
                                    <table>
                                        <tbody>
                                        <tr>
                                            <td><i class="conum" data-value="1"></i><b>1</b></td>
                                            <td>Resolve query string arguments to matching <code>Predicate</code> for
                                                <code>User</code>.
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>The default binding is as follows:</p>
                        </div>
                        <div class="ulist">
                            <ul>
                                <li>
                                    <p><code>Object</code> on simple properties as <code>eq</code>.</p>
                                </li>
                                <li>
                                    <p><code>Object</code> on collection like properties as <code>contains</code>.</p>
                                </li>
                                <li>
                                    <p><code>Collection</code> on simple properties as <code>in</code>.</p>
                                </li>
                            </ul>
                        </div>
                        <div class="paragraph">
                            <p>Those bindings can be customized via the <code>bindings</code> attribute of <code>@QuerydslPredicate</code>
                                or by making use of Java 8 <code>default methods</code> adding the <code>QuerydslBinderCustomizer</code>
                                to the repository interface.</p>
                        </div>
                        <div class="exampleblock">
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">CrudRepository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;,</span><span
        class="pln">
                                 </span><span class="typ">QueryDslPredicateExecutor</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">&gt;,</span><span
        class="pln">                </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span
        class="lit">1</span><span class="pun">)</span></b><span class="pln">
                                 </span><span class="typ">QuerydslBinderCustomizer</span><span
        class="pun">&lt;</span><span class="typ">QUser</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">               </span><i class="conum"
                                                                                                 data-value="2"></i><b><span
        class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

  </span><span class="lit">@Override</span><span class="pln">
  </span><span class="kwd">default</span><span class="pln"> </span><span class="kwd">public</span><span
        class="pln"> </span><span class="kwd">void</span><span class="pln"> customize</span><span
        class="pun">(</span><span class="typ">QuerydslBindings</span><span class="pln"> bindings</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">QUser</span><span class="pln"> user</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    bindings</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="pln">user</span><span
        class="pun">.</span><span class="pln">username</span><span class="pun">).</span><span
        class="pln">first</span><span class="pun">((</span><span class="pln">path</span><span class="pun">,</span><span
        class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-&gt;</span><span
        class="pln"> path</span><span class="pun">.</span><span class="pln">contains</span><span
        class="pun">(</span><span class="pln">value</span><span class="pun">))</span><span class="pln">    </span><i
        class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span
        class="pun">)</span></b><span class="pln">
    bindings</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="typ">String</span><span
        class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
      </span><span class="pun">.</span><span class="pln">first</span><span class="pun">((</span><span class="typ">StringPath</span><span
        class="pln"> path</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span
        class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-&gt;</span><span
        class="pln"> path</span><span class="pun">.</span><span class="pln">containsIgnoreCase</span><span
        class="pun">(</span><span class="pln">value</span><span class="pun">));</span><span class="pln"> </span><i
        class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span
        class="pun">)</span></b><span class="pln">
    bindings</span><span class="pun">.</span><span class="pln">excluding</span><span class="pun">(</span><span
        class="pln">user</span><span class="pun">.</span><span class="pln">password</span><span
        class="pun">);</span><span class="pln">                                           </span><i class="conum"
                                                                                                    data-value="5"></i><b><span
        class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                                <div class="colist arabic">
                                    <table>
                                        <tbody>
                                        <tr>
                                            <td><i class="conum" data-value="1"></i><b>1</b></td>
                                            <td><code>QueryDslPredicateExecutor</code> provides access to specific
                                                finder methods for <code>Predicate</code>.
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><i class="conum" data-value="2"></i><b>2</b></td>
                                            <td><code>QuerydslBinderCustomizer</code> defined on the repository
                                                interface will be automatically picked up and shortcuts <code>@QuerydslPredicate(bindings=…​)</code>.
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><i class="conum" data-value="3"></i><b>3</b></td>
                                            <td>Define the binding for the <code>username</code> property to be a simple
                                                contains binding.
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><i class="conum" data-value="4"></i><b>4</b></td>
                                            <td>Define the default binding for <code>String</code> properties to be a
                                                case insensitive contains match.
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><i class="conum" data-value="5"></i><b>5</b></td>
                                            <td>Exclude the <em>password</em> property from <code>Predicate</code>
                                                resolution.
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="core.repository-populators"><a class="anchor" href="#core.repository-populators"></a>4.7.3.
                        Repository populators</h4>
                    <div class="paragraph">
                        <p>If you work with the Spring JDBC module, you probably are familiar with the support to
                            populate a <code>DataSource</code> using SQL scripts. A similar abstraction is available on
                            the repositories level, although it does not use SQL as the data definition language because
                            it must be store-independent. Thus the populators support XML (through Spring’s OXM
                            abstraction) and JSON (through Jackson) to define data with which to populate the
                            repositories.</p>
                    </div>
                    <div class="paragraph">
                        <p>Assume you have a file <code>data.json</code> with the following content:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 38. Data defined in JSON</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-javascript" data-lang="javascript"><span
        class="pun">[</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span
        class="str">"_class"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span
        class="str">"com.acme.Person"</span><span class="pun">,</span><span class="pln">
 </span><span class="str">"firstname"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="str">"Dave"</span><span class="pun">,</span><span class="pln">
  </span><span class="str">"lastname"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="str">"Matthews"</span><span class="pln"> </span><span
        class="pun">},</span><span class="pln">
  </span><span class="pun">{</span><span class="pln"> </span><span class="str">"_class"</span><span class="pln"> </span><span
        class="pun">:</span><span class="pln"> </span><span class="str">"com.acme.Person"</span><span
        class="pun">,</span><span class="pln">
 </span><span class="str">"firstname"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="str">"Carter"</span><span class="pun">,</span><span class="pln">
  </span><span class="str">"lastname"</span><span class="pln"> </span><span class="pun">:</span><span
        class="pln"> </span><span class="str">"Beauford"</span><span class="pln"> </span><span class="pun">}</span><span
        class="pln"> </span><span class="pun">]</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>You can easily populate your repositories by using the populator elements of the repository
                            namespace provided in Spring Data Commons. To populate the preceding data to your
                            PersonRepository , do the following:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 39. Declaring a Jackson repository populator</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span
        class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span
        class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;beans</span><span class="pln"> </span><span class="atn">xmlns</span><span
        class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans"</span><span class="pln">
  </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span
        class="pln">
  </span><span class="atn">xmlns:repository</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/data/repository"</span><span
        class="pln">
  </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    http://www.springframework.org/schema/data/repository/spring-repository.xsd"</span><span
        class="tag">&gt;</span><span class="pln">

  </span><span class="tag">&lt;repository:jackson2-populator</span><span class="pln"> </span><span
        class="atn">locations</span><span class="pun">=</span><span class="atv">"classpath:data.json"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;/beans&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>This declaration causes the <code>data.json</code> file to
                            be read and deserialized via a Jackson <code>ObjectMapper</code>.</p>
                    </div>
                    <div class="paragraph">
                        <p>The type to which the JSON object will be unmarshalled to will be determined by inspecting
                            the <code>_class</code> attribute of the JSON document. The infrastructure will eventually
                            select the appropriate repository to handle the object just deserialized.</p>
                    </div>
                    <div class="paragraph">
                        <p>To rather use XML to define the data the repositories shall be populated with, you can use
                            the <code>unmarshaller-populator</code> element. You configure it to use one of the XML
                            marshaller options Spring OXM provides you with. See the <a
                                    href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/oxm.html">Spring
                                reference documentation</a> for details.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 40. Declaring an unmarshalling repository populator (using JAXB)
                        </div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span
        class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span
        class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;beans</span><span class="pln"> </span><span class="atn">xmlns</span><span
        class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans"</span><span class="pln">
  </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span
        class="pln">
  </span><span class="atn">xmlns:repository</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/data/repository"</span><span
        class="pln">
  </span><span class="atn">xmlns:oxm</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/oxm"</span><span
        class="pln">
  </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/repository
    http://www.springframework.org/schema/data/repository/spring-repository.xsd
    http://www.springframework.org/schema/oxm
    http://www.springframework.org/schema/oxm/spring-oxm.xsd"</span><span class="tag">&gt;</span><span class="pln">

  </span><span class="tag">&lt;repository:unmarshaller-populator</span><span class="pln"> </span><span class="atn">locations</span><span
        class="pun">=</span><span class="atv">"classpath:data.json"</span><span class="pln">
    </span><span class="atn">unmarshaller-ref</span><span class="pun">=</span><span
        class="atv">"unmarshaller"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

  </span><span class="tag">&lt;oxm:jaxb2-marshaller</span><span class="pln"> </span><span class="atn">contextPath</span><span
        class="pun">=</span><span class="atv">"com.acme"</span><span class="pln"> </span><span
        class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;/beans&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="web.legacy"><a class="anchor" href="#web.legacy"></a>4.7.4. Legacy web support</h4>
                    <div class="sect4">
                        <h5 id="web-domain-class-binding"><a class="anchor" href="#web-domain-class-binding"></a>Domain
                            class web binding for Spring MVC</h5>
                        <div class="paragraph">
                            <p>Given you are developing a Spring MVC web application you typically have to resolve
                                domain class ids from URLs. By default your task is to transform that request parameter
                                or URL part into the domain class to hand it to layers below then or execute business
                                logic on the entities directly. This would look something like this:</p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Controller</span><span class="pln">
</span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="str">"/users"</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">UserController</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> userRepository</span><span
        class="pun">;</span><span class="pln">

  </span><span class="lit">@Autowired</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">UserController</span><span
        class="pun">(</span><span class="typ">UserRepository</span><span class="pln"> userRepository</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Assert</span><span class="pun">.</span><span class="pln">notNull</span><span
        class="pun">(</span><span class="pln">repository</span><span class="pun">,</span><span class="pln"> </span><span
        class="str">"Repository must not be null!"</span><span class="pun">);</span><span class="pln">
    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">userRepository </span><span
        class="pun">=</span><span class="pln"> userRepository</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="str">"/{id}"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> showUserForm</span><span
        class="pun">(</span><span class="lit">@PathVariable</span><span class="pun">(</span><span
        class="str">"id"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Long</span><span
        class="pln"> id</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Model</span><span
        class="pln"> model</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

    </span><span class="com">// Do null check for id</span><span class="pln">
    </span><span class="typ">User</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> userRepository</span><span
        class="pun">.</span><span class="pln">findOne</span><span class="pun">(</span><span class="pln">id</span><span
        class="pun">);</span><span class="pln">
    </span><span class="com">// Do null check for user</span><span class="pln">

    model</span><span class="pun">.</span><span class="pln">addAttribute</span><span class="pun">(</span><span
        class="str">"user"</span><span class="pun">,</span><span class="pln"> user</span><span
        class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"user"</span><span
        class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>First you declare a repository dependency for each controller to look up the entity
                                managed by the controller or repository respectively. Looking up the entity is
                                boilerplate as well, as it’s always a <code>findOne(…)</code> call. Fortunately Spring
                                provides means to register custom components that allow conversion between a <code>String</code>
                                value to an arbitrary type.</p>
                        </div>
                        <div class="sect5">
                            <h6 id="web.legacy.property-editors"><a class="anchor"
                                                                    href="#web.legacy.property-editors"></a>PropertyEditors
                            </h6>
                            <div class="paragraph">
                                <p>For Spring versions before 3.0 simple Java <code>PropertyEditors</code> had to be
                                    used. To integrate with that, Spring Data offers a <code>DomainClassPropertyEditorRegistrar</code>,
                                    which looks up all Spring Data repositories registered in the <code>ApplicationContext</code>
                                    and registers a custom <code>PropertyEditor</code> for the managed domain class.</p>
                            </div>
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;bean</span><span
        class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"….web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"</span><span
        class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span
        class="pun">=</span><span class="atv">"webBindingInitializer"</span><span class="tag">&gt;</span><span
        class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span
        class="pun">=</span><span class="atv">"….web.bind.support.ConfigurableWebBindingInitializer"</span><span
        class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span
        class="pun">=</span><span class="atv">"propertyEditorRegistrars"</span><span class="tag">&gt;</span><span
        class="pln">
        </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span
        class="pun">=</span><span class="atv">"org.springframework.data.repository.support.DomainClassPropertyEditorRegistrar"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="tag">&lt;/property&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">
  </span><span class="tag">&lt;/property&gt;</span><span class="pln">
</span><span class="tag">&lt;/bean&gt;</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>If you have configured Spring MVC as in the preceding example, you can configure your
                                    controller as follows, which reduces a lot of the clutter and boilerplate.</p>
                            </div>
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Controller</span><span class="pln">
</span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="str">"/users"</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">UserController</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@RequestMapping</span><span class="pun">(</span><span class="str">"/{id}"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> showUserForm</span><span
        class="pun">(</span><span class="lit">@PathVariable</span><span class="pun">(</span><span
        class="str">"id"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">User</span><span
        class="pln"> user</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Model</span><span
        class="pln"> model</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

    model</span><span class="pun">.</span><span class="pln">addAttribute</span><span class="pun">(</span><span
        class="str">"user"</span><span class="pun">,</span><span class="pln"> user</span><span
        class="pun">);</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"userForm"</span><span
        class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <h1 id="reference" class="sect0"><a class="anchor" href="#reference"></a>Reference Documentation</h1>
    <div class="sect1">
        <h2 id="jpa.repositories"><a class="anchor" href="#jpa.repositories"></a>5. JPA Repositories</h2>
        <div class="sectionbody">
            <div class="paragraph">
                <p>This chapter will point out the specialties for repository support for JPA. This builds on the core
                    repository support explained in <a href="#repositories">Working with Spring Data Repositories</a>.
                    So make sure you’ve got a sound understanding of the basic concepts explained there.</p>
            </div>
            <div class="sect2">
                <h3 id="jpa.introduction"><a class="anchor" href="#jpa.introduction"></a>5.1. Introduction</h3>
                <div class="sect3">
                    <h4 id="jpa.namespace"><a class="anchor" href="#jpa.namespace"></a>5.1.1. Spring namespace</h4>
                    <div class="paragraph">
                        <p>The JPA module of Spring Data contains a custom namespace that allows defining repository
                            beans. It also contains certain features and element attributes that are special to JPA.
                            Generally the JPA repositories can be set up using the <code>repositories</code> element:
                        </p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 41. Setting up JPA repositories using the namespace</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span
        class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span
        class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;beans</span><span class="pln"> </span><span class="atn">xmlns</span><span
        class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans"</span><span class="pln">
  </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span
        class="pln">
  </span><span class="atn">xmlns:jpa</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/data/jpa"</span><span
        class="pln">
  </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/data/jpa
    http://www.springframework.org/schema/data/jpa/spring-jpa.xsd"</span><span class="tag">&gt;</span><span class="pln">

  </span><span class="tag">&lt;jpa:repositories</span><span class="pln"> </span><span
        class="atn">base-package</span><span class="pun">=</span><span class="atv">"com.acme.repositories"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;/beans&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Using this element looks up Spring Data repositories as described in <a
                                href="#repositories.create-instances">Creating repository instances</a>. Beyond that it
                            activates persistence exception translation for all beans annotated with
                            <code>@Repository</code> to let exceptions being thrown by the JPA persistence providers be
                            converted into Spring’s <code>DataAccessException</code> hierarchy.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="_custom_namespace_attributes"><a class="anchor"
                                                                 href="#_custom_namespace_attributes"></a>Custom
                            namespace attributes</h5>
                        <div class="paragraph">
                            <p>Beyond the default attributes of the <code>repositories</code> element the JPA namespace
                                offers additional attributes to gain more detailed control over the setup of the
                                repositories:</p>
                        </div>
                        <table class="tableblock frame-all grid-all">
                            <caption class="title">Table 2. Custom JPA-specific attributes of the repositories element
                            </caption>
                            <colgroup>
                                <col>
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-manager-factory-ref</code>
                                </p></td>
                                <td class="tableblock halign-left valign-top"><p class="tableblock">Explicitly wire the
                                    <code>EntityManagerFactory</code> to be used with the repositories being detected by
                                    the <code>repositories</code> element. Usually used if multiple <code>EntityManagerFactory</code>
                                    beans are used within the application. If not configured we will automatically
                                    lookup the <code>EntityManagerFactory</code> bean with the name <code>entityManagerFactory</code>
                                    in the <code>ApplicationContext</code>.</p></td>
                            </tr>
                            <tr>
                                <td class="tableblock halign-left valign-top"><p class="tableblock"><code>transaction-manager-ref</code>
                                </p></td>
                                <td class="tableblock halign-left valign-top"><p class="tableblock">Explicitly wire the
                                    <code>PlatformTransactionManager</code> to be used with the repositories being
                                    detected by the <code>repositories</code> element. Usually only necessary if
                                    multiple transaction managers and/or <code>EntityManagerFactory</code> beans have
                                    been configured. Default to a single defined <code>PlatformTransactionManager</code>
                                    inside the current <code>ApplicationContext</code>.</p></td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="paragraph">
                            <p>Note that we require a <code>PlatformTransactionManager</code> bean named <code>transactionManager</code>
                                to be present if no explicit <code>transaction-manager-ref</code> is defined.</p>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.java-config"><a class="anchor" href="#jpa.java-config"></a>5.1.2. Annotation based
                        configuration</h4>
                    <div class="paragraph">
                        <p>The Spring Data JPA repositories support cannot only be activated through an XML namespace
                            but also using an annotation through JavaConfig.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 42. Spring Data JPA repositories using JavaConfig</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Configuration</span><span class="pln">
</span><span class="lit">@EnableJpaRepositories</span><span class="pln">
</span><span class="lit">@EnableTransactionManagement</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ApplicationConfig</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Bean</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">DataSource</span><span class="pln"> dataSource</span><span
        class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">EmbeddedDatabaseBuilder</span><span class="pln"> builder </span><span
        class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">EmbeddedDatabaseBuilder</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">setType</span><span
        class="pun">(</span><span class="typ">EmbeddedDatabaseType</span><span class="pun">.</span><span class="pln">HSQL</span><span
        class="pun">).</span><span class="pln">build</span><span class="pun">();</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="lit">@Bean</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">LocalContainerEntityManagerFactoryBean</span><span
        class="pln"> entityManagerFactory</span><span class="pun">()</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">

    </span><span class="typ">HibernateJpaVendorAdapter</span><span class="pln"> vendorAdapter </span><span
        class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">HibernateJpaVendorAdapter</span><span class="pun">();</span><span class="pln">
    vendorAdapter</span><span class="pun">.</span><span class="pln">setGenerateDdl</span><span class="pun">(</span><span
        class="kwd">true</span><span class="pun">);</span><span class="pln">

    </span><span class="typ">LocalContainerEntityManagerFactoryBean</span><span class="pln"> factory </span><span
        class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">LocalContainerEntityManagerFactoryBean</span><span class="pun">();</span><span class="pln">
    factory</span><span class="pun">.</span><span class="pln">setJpaVendorAdapter</span><span class="pun">(</span><span
        class="pln">vendorAdapter</span><span class="pun">);</span><span class="pln">
    factory</span><span class="pun">.</span><span class="pln">setPackagesToScan</span><span class="pun">(</span><span
        class="str">"com.acme.domain"</span><span class="pun">);</span><span class="pln">
    factory</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span
        class="pln">dataSource</span><span class="pun">());</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> factory</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="lit">@Bean</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span
        class="typ">PlatformTransactionManager</span><span class="pln"> transactionManager</span><span
        class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">JpaTransactionManager</span><span class="pln"> txManager </span><span
        class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">JpaTransactionManager</span><span class="pun">();</span><span class="pln">
    txManager</span><span class="pun">.</span><span class="pln">setEntityManagerFactory</span><span class="pun">(</span><span
        class="pln">entityManagerFactory</span><span class="pun">());</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> txManager</span><span class="pun">;</span><span
        class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    It’s important to create <code>LocalContainerEntityManagerFactoryBean</code> and not
                                    <code>EntityManagerFactory</code> directly since the former also participates in
                                    exception translation mechanisms besides simply creating
                                    <code>EntityManagerFactory</code>.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="paragraph">
                        <p>The just shown configuration class sets up an embedded HSQL database using the <code>EmbeddedDatabaseBuilder</code>
                            API of spring-jdbc. We then set up a <code>EntityManagerFactory</code> and use Hibernate as
                            sample persistence provider. The last infrastructure component declared here is the <code>JpaTransactionManager</code>.
                            We finally activate Spring Data JPA repositories using the
                            <code>@EnableJpaRepositories</code> annotation which essentially carries the same attributes
                            as the XML namespace does. If no base package is configured it will use the one the
                            configuration class resides in.</p>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="jpa.entity-persistence"><a class="anchor" href="#jpa.entity-persistence"></a>5.2. Persisting
                    entities</h3>
                <div class="sect3">
                    <h4 id="jpa.entity-persistence.saving-entites"><a class="anchor"
                                                                      href="#jpa.entity-persistence.saving-entites"></a>5.2.1.
                        Saving entities</h4>
                    <div class="paragraph">
                        <p>Saving an entity can be performed via the <code>CrudRepository.save(…)</code>-Method. It will
                            persist or merge the given entity using the underlying JPA <code>EntityManager</code>. If
                            the entity has not been persisted yet Spring Data JPA will save the entity via a call to the
                            <code>entityManager.persist(…)</code> method, otherwise the
                            <code>entityManager.merge(…)</code> method will be called.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="_entity_state_detection_strategies"><a class="anchor"
                                                                       href="#_entity_state_detection_strategies"></a>Entity
                            state detection strategies</h5>
                        <div class="paragraph">
                            <p>Spring Data JPA offers the following strategies to detect whether an entity is new or
                                not:</p>
                        </div>
                        <table class="tableblock frame-all grid-all">
                            <caption class="title">Table 3. Options for detection whether an entity is new in Spring
                                Data JPA
                            </caption>
                            <colgroup>
                                <col>
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <td class="tableblock halign-left valign-top"><p class="tableblock">Id-Property
                                    inspection (<strong>default</strong>)</p></td>
                                <td class="tableblock halign-left valign-top"><p class="tableblock">By default Spring
                                    Data JPA inspects the identifier property of the given entity. If the identifier
                                    property is <code>null</code>, then the entity will be assumed as new, otherwise as
                                    not new.</p></td>
                            </tr>
                            <tr>
                                <td class="tableblock halign-left valign-top"><p class="tableblock">Implementing <code>Persistable</code>
                                </p></td>
                                <td class="tableblock halign-left valign-top"><p class="tableblock">If an entity
                                    implements <code>Persistable</code>, Spring Data JPA will delegate the new detection
                                    to the <code>isNew(…)</code> method of the entity. See the <a
                                            href="http://docs.spring.io/spring-data/data-commons/docs/current/api/index.html?org/springframework/data/domain/Persistable.html">JavaDoc</a>
                                    for details.</p></td>
                            </tr>
                            <tr>
                                <td class="tableblock halign-left valign-top"><p class="tableblock">Implementing <code>EntityInformation</code>
                                </p></td>
                                <td class="tableblock halign-left valign-top"><p class="tableblock">You can customize
                                    the <code>EntityInformation</code> abstraction used in the
                                    <code>SimpleJpaRepository</code> implementation by creating a subclass of <code>JpaRepositoryFactory</code>
                                    and overriding the <code>getEntityInformation(…)</code> method accordingly. You then
                                    have to register the custom implementation of <code>JpaRepositoryFactory</code> as a
                                    Spring bean. Note that this should be rarely necessary. See the <a
                                            href="http://docs.spring.io/spring-data/data-jpa/docs/current/api/index.html?org/springframework/data/jpa/repository/support/JpaRepositoryFactory.html">JavaDoc</a>
                                    for details.</p></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="jpa.query-methods"><a class="anchor" href="#jpa.query-methods"></a>5.3. Query methods</h3>
                <div class="sect3">
                    <h4 id="jpa.sample-app.finders.strategies"><a class="anchor"
                                                                  href="#jpa.sample-app.finders.strategies"></a>5.3.1.
                        Query lookup strategies</h4>
                    <div class="paragraph">
                        <p>The JPA module supports defining a query manually as String or have it being derived from the
                            method name.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="_declared_queries"><a class="anchor" href="#_declared_queries"></a>Declared queries</h5>
                        <div class="paragraph">
                            <p>Although getting a query derived from the method name is quite convenient, one might face
                                the situation in which either the method name parser does not support the keyword one
                                wants to use or the method name would get unnecessarily ugly. So you can either use JPA
                                named queries through a naming convention (see <a
                                        href="#jpa.query-methods.named-queries">Using JPA NamedQueries</a> for more
                                information) or rather annotate your query method with <code>@Query</code> (see <a
                                        href="#jpa.query-methods.at-query">Using @Query</a> for details).</p>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.query-methods.query-creation"><a class="anchor"
                                                                 href="#jpa.query-methods.query-creation"></a>5.3.2.
                        Query creation</h4>
                    <div class="paragraph">
                        <p>Generally the query creation mechanism for JPA works as described in <a
                                href="#repositories.query-methods">Query methods</a>. Here’s a short example of what a
                            JPA query method translates into:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 43. Query creation from method names</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre>public interface UserRepository extends Repository&lt;User, Long&gt; {

  List&lt;User&gt; findByEmailAddressAndLastname(String emailAddress, String lastname);
}</pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>We will create a query using the JPA criteria API from this but essentially this
                                    translates into the following query: <code>select u from User u where u.emailAddress
                                        = ?1 and u.lastname = ?2</code>. Spring Data JPA will do a property check and
                                    traverse nested properties as described in <a
                                            href="#repositories.query-methods.query-property-expressions">Property
                                        expressions</a>. Here’s an overview of the keywords supported for JPA and what a
                                    method containing that keyword essentially translates to.</p>
                            </div>
                        </div>
                    </div>
                    <table class="tableblock frame-all grid-all">
                        <caption class="title">Table 4. Supported keywords inside method names</caption>
                        <colgroup>
                            <col>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                        <tr>
                            <th class="tableblock halign-left valign-top">Keyword</th>
                            <th class="tableblock halign-left valign-top">Sample</th>
                            <th class="tableblock halign-left valign-top">JPQL snippet</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameAndFirstname</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname
                                = ?1 and x.firstname = ?2</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByLastnameOrFirstname</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname
                                = ?1 or x.firstname = ?2</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is,Equals</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>findByFirstname</code>,<code>findByFirstnameIs</code>,<code>findByFirstnameEquals</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.firstname = ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateBetween</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.startDate between ?1 and ?2</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>findByAgeLessThan</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &lt;
                                ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>LessThanEqual</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeLessThanEqual</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &lt;=
                                ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThan</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &gt;
                                ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>GreaterThanEqual</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeGreaterThanEqual</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age &gt;=
                                ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateAfter</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.startDate &gt; ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByStartDateBefore</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.startDate &lt; ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNull</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>findByAgeIsNull</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age is
                                null</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>IsNotNull,NotNull</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAge(Is)NotNull</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age not
                                null</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameLike</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.firstname like ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameNotLike</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.firstname not like ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>StartingWith</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameStartingWith</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.firstname like ?1</code> (parameter bound with appended <code>%</code>)</p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameEndingWith</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.firstname like ?1</code> (parameter bound with prepended <code>%</code>)</p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameContaining</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                x.firstname like ?1</code> (parameter bound wrapped in <code>%</code>)</p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrderBy</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeOrderByLastnameDesc</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age = ?1
                                order by x.lastname desc</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>findByLastnameNot</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.lastname
                                &lt;&gt; ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeIn(Collection&lt;Age&gt;
                                ages)</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age in
                                ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByAgeNotIn(Collection&lt;Age&gt;
                                age)</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.age not
                                in ?1</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>findByActiveTrue()</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.active =
                                true</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code></p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByActiveFalse()</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where x.active =
                                false</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IgnoreCase</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>findByFirstnameIgnoreCase</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>… where
                                UPPER(x.firstame) = UPPER(?1)</code></p></td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    <div class="paragraph">
                                        <p><code>In</code> and <code>NotIn</code> also take any subclass of <code>Collection</code>
                                            as parameter as well as arrays or varargs. For other syntactical versions of
                                            the very same logical operator check <a href="#repository-query-keywords">Repository
                                                query keywords</a>.</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.query-methods.named-queries"><a class="anchor"
                                                                href="#jpa.query-methods.named-queries"></a>5.3.3. Using
                        JPA NamedQueries</h4>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    <div class="paragraph">
                                        <p>The examples use simple <code>&lt;named-query /&gt;</code> element and <code>@NamedQuery</code>
                                            annotation. The queries for these configuration elements have to be defined
                                            in JPA query language. Of course you can use <code>&lt;named-native-query /&gt;</code>
                                            or <code>@NamedNativeQuery</code> too. These elements allow you to define
                                            the query in native SQL by losing the database platform independence.</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="sect4">
                        <h5 id="_xml_named_query_definition"><a class="anchor" href="#_xml_named_query_definition"></a>XML
                            named query definition</h5>
                        <div class="paragraph">
                            <p>To use XML configuration simply add the necessary <code>&lt;named-query /&gt;</code>
                                element to the <code>orm.xml</code> JPA configuration file located in
                                <code>META-INF</code> folder of your classpath. Automatic invocation of named queries is
                                enabled by using some defined naming convention. For more details see below.</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 44. XML named query configuration</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;named-query</span><span
        class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"User.findByLastname"</span><span
        class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;query&gt;</span><span class="pln">select u from User u where u.lastname = ?1</span><span
        class="tag">&lt;/query&gt;</span><span class="pln">
</span><span class="tag">&lt;/named-query&gt;</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>As you can see the query has a special name which will be used to resolve it at
                                runtime.</p>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="_annotation_configuration"><a class="anchor" href="#_annotation_configuration"></a>Annotation
                            configuration</h5>
                        <div class="paragraph">
                            <p>Annotation configuration has the advantage of not needing another configuration file to
                                be edited, probably lowering maintenance costs. You pay for that benefit by the need to
                                recompile your domain class for every new query declaration.</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 45. Annotation based named query configuration</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Entity</span><span class="pln">
</span><span class="lit">@NamedQuery</span><span class="pun">(</span><span class="pln">name </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"User.findByEmailAddress"</span><span
        class="pun">,</span><span class="pln">
  query </span><span class="pun">=</span><span class="pln"> </span><span class="str">"select u from User u where u.emailAddress = ?1"</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="_declaring_interfaces"><a class="anchor" href="#_declaring_interfaces"></a>Declaring
                            interfaces</h5>
                        <div class="paragraph">
                            <p>To allow execution of these named queries all you need to do is to specify the <code>UserRepository</code>
                                as follows:</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 46. Query method declaration in UserRepository</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">);</span><span class="pln">

  </span><span class="typ">User</span><span class="pln"> findByEmailAddress</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> emailAddress</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>Spring Data will try to resolve a call to these methods to a named query, starting with
                                the simple name of the configured domain class, followed by the method name separated by
                                a dot. So the example here would use the named queries defined above instead of trying
                                to create a query from the method name.</p>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.query-methods.at-query"><a class="anchor" href="#jpa.query-methods.at-query"></a>5.3.4.
                        Using @Query</h4>
                    <div class="paragraph">
                        <p>Using named queries to declare queries for entities is a valid approach and works fine for a
                            small number of queries. As the queries themselves are tied to the Java method that executes
                            them you actually can bind them directly using the Spring Data JPA <code>@Query</code>
                            annotation rather than annotating them to the domain class. This will free the domain class
                            from persistence specific information and co-locate the query to the repository interface.
                        </p>
                    </div>
                    <div class="paragraph">
                        <p>Queries annotated to the query method will take precedence over queries defined using <code>@NamedQuery</code>
                            or named queries declared in <code>orm.xml</code>.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 47. Declare query at the query method using @Query</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"select u from User u where u.emailAddress = ?1"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">User</span><span class="pln"> findByEmailAddress</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> emailAddress</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="_using_advanced_code_like_code_expressions"><a class="anchor"
                                                                               href="#_using_advanced_code_like_code_expressions"></a>Using
                            advanced <code>LIKE</code> expressions</h5>
                        <div class="paragraph">
                            <p>The query execution mechanism for manually defined queries using @Query allows the
                                definition of advanced <code>LIKE</code> expressions inside the query definition.</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 48. Advanced like-expressions in @Query</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"select u from User u where u.firstname like %?1"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByFirstnameEndsWith</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> firstname</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>In the just shown sample <code>LIKE</code> delimiter character <code>%</code> is
                                recognized and the query transformed into a valid JPQL query (removing the
                                <code>%</code>). Upon query execution the parameter handed into the method call gets
                                augmented with the previously recognized <code>LIKE</code> pattern.</p>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="_native_queries"><a class="anchor" href="#_native_queries"></a>Native queries</h5>
                        <div class="paragraph">
                            <p>The <code>@Query</code> annotation allows to execute native queries by setting the <code>nativeQuery</code>
                                flag to true.</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 49. Declare a native query at the query method using @Query</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="pln">value </span><span
        class="pun">=</span><span class="pln"> </span><span
        class="str">"SELECT * FROM USERS WHERE EMAIL_ADDRESS = ?1"</span><span class="pun">,</span><span class="pln"> nativeQuery </span><span
        class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span
        class="pln">
  </span><span class="typ">User</span><span class="pln"> findByEmailAddress</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> emailAddress</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>Note, that we currently don’t support execution of dynamic sorting for native queries as
                                we’d have to manipulate the actual query declared and we cannot do this reliably for
                                native SQL. You can however use native queries for pagination by specifying the count
                                query yourself:</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 50. Declare native count queries for pagination at the query
                                method using @Query
                            </div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="pln">value </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"SELECT * FROM USERS WHERE LASTNAME = ?1"</span><span
        class="pun">,</span><span class="pln">
    countQuery </span><span class="pun">=</span><span class="pln"> </span><span class="str">"SELECT count(*) FROM USERS WHERE LASTNAME = ?1"</span><span
        class="pun">,</span><span class="pln">
    nativeQuery </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">Page</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>This also works with named native queries by adding the suffix <code>.count</code> to a
                                copy of your query. Be aware that you probably must register a result set mapping for
                                your count query, though.</p>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.query-methods.sorting"><a class="anchor" href="#jpa.query-methods.sorting"></a>5.3.5.
                        Using Sort</h4>
                    <div class="paragraph">
                        <p>Sorting can be done be either providing a <code>PageRequest</code> or using <code>Sort</code>
                            directly. The properties actually used within the <code>Order</code> instances of
                            <code>Sort</code> need to match to your domain model, which means they need to resolve to
                            either a property or an alias used within the query. The JPQL defines this as a <em>state_field_path_expression</em>.
                        </p>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    <div class="paragraph">
                                        <p>Using any non referenceable path expression leads to an Exception.</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="paragraph">
                        <p>Using <code>Sort</code> together with <a href="#jpa.query-methods.at-query">@Query</a>
                            however allows you to sneak in non path checked <code>Order</code> instances containing <em>functions</em>
                            within the <code>ORDER BY</code> clause. This is possible because the <code>Order</code> is
                            just appended to the given query string. By default we will reject any <code>Order</code>
                            instance containing function calls, but you can use <code>JpaSort.unsafe</code> to add
                            potentially unsafe ordering.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 51. Using Sort and JpaSort</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"select u from User u where u.lastname like ?1%"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByAndSort</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> lastname</span><span class="pun">,</span><span
        class="pln"> </span><span class="typ">Sort</span><span class="pln"> sort</span><span class="pun">);</span><span
        class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"select u.id, LENGTH(u.firstname) as fn_len from User u where u.lastname like ?1%"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Object</span><span class="pun">[]&gt;</span><span
        class="pln"> findByAsArrayAndSort</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Sort</span><span class="pln"> sort</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

repo</span><span class="pun">.</span><span class="pln">findByAndSort</span><span class="pun">(</span><span class="str">"lannister"</span><span
        class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">Sort</span><span class="pun">(</span><span class="str">"firstname"</span><span
        class="pun">));</span><span class="pln">               </span><i class="conum" data-value="1"></i><b><span
        class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
repo</span><span class="pun">.</span><span class="pln">findByAndSort</span><span class="pun">(</span><span class="str">"stark"</span><span
        class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">Sort</span><span class="pun">(</span><span class="str">"LENGTH(firstname)"</span><span class="pun">));</span><span
        class="pln">           </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span
        class="lit">2</span><span class="pun">)</span></b><span class="pln">
repo</span><span class="pun">.</span><span class="pln">findByAndSort</span><span class="pun">(</span><span class="str">"targaryen"</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">JpaSort</span><span class="pun">.</span><span
        class="pln">unsafe</span><span class="pun">(</span><span class="str">"LENGTH(firstname)"</span><span
        class="pun">));</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span
        class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
repo</span><span class="pun">.</span><span class="pln">findByAsArrayAndSort</span><span class="pun">(</span><span
        class="str">"bolton"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span
        class="pln"> </span><span class="typ">Sort</span><span class="pun">(</span><span
        class="str">"fn_len"</span><span class="pun">));</span><span class="pln">              </span><i class="conum"
                                                                                                         data-value="4"></i><b><span
        class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
                                </div>
                            </div>
                            <div class="colist arabic">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td><i class="conum" data-value="1"></i><b>1</b></td>
                                        <td>Valid <code>Sort</code> expression pointing to property in domain model.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="2"></i><b>2</b></td>
                                        <td>Invalid <code>Sort</code> containing function call. Thows Exception.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="3"></i><b>3</b></td>
                                        <td>Valid <code>Sort</code> containing explicitly <em>unsafe</em>
                                            <code>Order</code>.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="4"></i><b>4</b></td>
                                        <td>Valid <code>Sort</code> expression pointing to aliased function.</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.named-parameters"><a class="anchor" href="#jpa.named-parameters"></a>5.3.6. Using named
                        parameters</h4>
                    <div class="paragraph">
                        <p>By default Spring Data JPA will use position based parameter binding as described in all the
                            samples above. This makes query methods a little error prone to refactoring regarding the
                            parameter position. To solve this issue you can use <code>@Param</code> annotation to give a
                            method parameter a concrete name and bind the name in the query.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 52. Using named parameters</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"select u from User u where u.firstname = :firstname or u.lastname = :lastname"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">User</span><span class="pln"> findByLastnameOrFirstname</span><span class="pun">(</span><span
        class="lit">@Param</span><span class="pun">(</span><span class="str">"lastname"</span><span class="pun">)</span><span
        class="pln"> </span><span class="typ">String</span><span class="pln"> lastname</span><span
        class="pun">,</span><span class="pln">
                                 </span><span class="lit">@Param</span><span class="pun">(</span><span class="str">"firstname"</span><span
        class="pun">)</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstname</span><span
        class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Note that the method parameters are switched according to the occurrence in the query
                            defined.</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.query.spel-expressions"><a class="anchor" href="#jpa.query.spel-expressions"></a>5.3.7.
                        Using SpEL expressions</h4>
                    <div class="paragraph">
                        <p>As of Spring Data JPA release 1.4 we support the usage of restricted SpEL template
                            expressions in manually defined queries via <code>@Query</code>. Upon query execution these
                            expressions are evaluated against a predefined set of variables. We support the following
                            list of variables to be used in a manual query.</p>
                    </div>
                    <table class="tableblock frame-all grid-all">
                        <caption class="title">Table 5. Supported variables inside SpEL based query templates</caption>
                        <colgroup>
                            <col>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                        <tr>
                            <th class="tableblock halign-left valign-top">Variable</th>
                            <th class="tableblock halign-left valign-top">Usage</th>
                            <th class="tableblock halign-left valign-top">Description</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>entityName</code>
                            </p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>select x from
                                #{#entityName} x</code></p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">Inserts the <code>entityName</code>
                                of the domain type associated with the given Repository. The <code>entityName</code> is
                                resolved as follows: If the domain type has set the name property on the
                                <code>@Entity</code> annotation then it will be used. Otherwise the simple class-name of
                                the domain type will be used.</p></td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="paragraph">
                        <p>The following example demonstrates one use case for the <code>#{#entityName}</code>
                            expression in a query string where you want to define a repository interface with a query
                            method with a manually defined query. In order not to have to state the actual entity name
                            in the query string of a <code>@Query</code> annotation one can use the
                            <code>#{#entityName}</code> Variable.</p>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    <div class="paragraph">
                                        <p>The <code>entityName</code> can be customized via the <code>@Entity</code>
                                            annotation. Customizations via <code>orm.xml</code> are not supported for
                                            the SpEL expressions.</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 53. Using SpEL expressions in repository query methods - entityName
                        </div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Id</span><span class="pln">
  </span><span class="lit">@GeneratedValue</span><span class="pln">
  </span><span class="typ">Long</span><span class="pln"> id</span><span class="pun">;</span><span class="pln">

  </span><span class="typ">String</span><span class="pln"> lastname</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="typ">Long</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"select u from #{#entityName} u where u.lastname = ?1"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Of course you could have just used User in the query declaration directly but that would
                            require you to change the query as well. The reference to <code>#entityName</code> will pick
                            up potential future remappings of the User class to a different entity name (e.g. by using
                            <code>@Entity(name = "MyUser")</code>.</p>
                    </div>
                    <div class="paragraph">
                        <p>Another use case for the <code>#{#entityName}</code> expression in a query string is if you
                            want to define a generic repository interface with specialized repository interfaces for a
                            concrete domain type. In order not to have to repeat the definition of custom query methods
                            on the concrete interfaces you can use the entity name expression in the query string of the
                            <code>@Query</code> annotation in the generic repository interface.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 54. Using SpEL expressions in repository query methods - entityName
                            with inheritance
                        </div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@MappedSuperclass</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span
        class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">AbstractMappedType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> attribute
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">ConcreteType</span><span class="pln"> </span><span class="kwd">extends</span><span
        class="pln"> </span><span class="typ">AbstractMappedType</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln"> </span><span class="pun">…</span><span class="pln"> </span><span
        class="pun">}</span><span class="pln">

</span><span class="lit">@NoRepositoryBean</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">MappedTypeRepository</span><span class="pun">&lt;</span><span class="pln">T </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractMappedType</span><span
        class="pun">&gt;</span><span class="pln">
  </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Repository</span><span class="pun">&lt;</span><span
        class="pln">T</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"select t from #{#entityName} t where t.attribute = ?1"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="pln">T</span><span
        class="pun">&gt;</span><span class="pln"> findAllByAttribute</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> attribute</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">ConcreteRepository</span><span class="pln">
  </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">MappedTypeRepository</span><span
        class="pun">&lt;</span><span class="typ">ConcreteType</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">…</span><span
        class="pln"> </span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>In the example the interface <code>MappedTypeRepository</code> is the common parent interface
                            for a few domain types extending <code>AbstractMappedType</code>. It also defines the
                            generic method <code>findAllByAttribute(…)</code> which can be used on instances of the
                            specialized repository interfaces. If you now invoke <code>findByAllAttribute(…)</code> on
                            <code>ConcreteRepository</code> the query being executed will be <code>select t from
                                ConcreteType t where t.attribute = ?1</code>.</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.modifying-queries"><a class="anchor" href="#jpa.modifying-queries"></a>5.3.8. Modifying
                        queries</h4>
                    <div class="paragraph">
                        <p>All the sections above describe how to declare queries to access a given entity or collection
                            of entities. Of course you can add custom modifying behaviour by using facilities described
                            in <a href="#repositories.custom-implementations">Custom implementations for Spring Data
                                repositories</a>. As this approach is feasible for comprehensive custom functionality,
                            you can achieve the execution of modifying queries that actually only need parameter binding
                            by annotating the query method with <code>@Modifying</code>:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 55. Declaring manipulating queries</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Modifying</span><span class="pln">
</span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"update User u set u.firstname = ?1 where u.lastname = ?2"</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> setFixedFirstnameFor</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> firstname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">String</span><span class="pln"> lastname</span><span class="pun">);</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>This will trigger the query annotated to the method as updating query instead of a selecting
                            one. As the <code>EntityManager</code> might contain outdated entities after the execution
                            of the modifying query, we do not automatically clear it (see JavaDoc of <code>EntityManager.clear()</code>
                            for details) since this will effectively drop all non-flushed changes still pending in the
                            <code>EntityManager</code>. If you wish the <code>EntityManager</code> to be cleared
                            automatically you can set <code>@Modifying</code> annotation’s
                            <code>clearAutomatically</code> attribute to <code>true</code>.</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.query-hints"><a class="anchor" href="#jpa.query-hints"></a>5.3.9. Applying query hints
                    </h4>
                    <div class="paragraph">
                        <p>To apply JPA query hints to the queries declared in your repository interface you can use the
                            <code>@QueryHints</code> annotation. It takes an array of JPA <code>@QueryHint</code>
                            annotations plus a boolean flag to potentially disable the hints applied to the addtional
                            count query triggered when applying pagination.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 56. Using QueryHints with a repository method</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">Repository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@QueryHints</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">@QueryHint</span><span
        class="pun">(</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span
        class="str">"name"</span><span class="pun">,</span><span class="pln"> value </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">)},</span><span
        class="pln">
              forCounting </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">Page</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Pageable</span><span class="pln"> pageable</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>The just shown declaration would apply the configured <code>@QueryHint</code> for that
                            actually query but omit applying it to the count query triggered to calculate the total
                            number of pages.</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.entity-graph"><a class="anchor" href="#jpa.entity-graph"></a>5.3.10. Configuring Fetch-
                        and LoadGraphs</h4>
                    <div class="paragraph">
                        <p>The JPA 2.1 specification introduced support for specifiying Fetch- and LoadGraphs that we
                            also support via the <code>@EntityGraph</code> annotation which allows to reference a <code>@NamedEntityGraph</code>
                            definition, that can be annotated on an entity, to be used to configure the fetch plan of
                            the resulting query. The type (Fetch / Load) of the fetching can be configured via the
                            <code>type</code> attribute on the <code>@EntityGraph</code> annotation. Please have a look
                            at the JPA 2.1 Spec 3.7.4 for further reference.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 57. Defining a named entity graph on an entity.</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Entity</span><span class="pln">
</span><span class="lit">@NamedEntityGraph</span><span class="pun">(</span><span class="pln">name </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"GroupInfo.detail"</span><span
        class="pun">,</span><span class="pln">
  attributeNodes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">@NamedAttributeNode</span><span
        class="pun">(</span><span class="str">"members"</span><span class="pun">))</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">GroupInfo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="com">// default fetch mode is lazy.</span><span class="pln">
  </span><span class="lit">@ManyToMany</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">GroupMember</span><span
        class="pun">&gt;</span><span class="pln"> members </span><span class="pun">=</span><span
        class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">GroupMember</span><span class="pun">&gt;();</span><span
        class="pln">

  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 58. Referencing a named entity graph definition on an repository
                            query method.
                        </div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Repository</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">GroupRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">CrudRepository</span><span class="pun">&lt;</span><span
        class="typ">GroupInfo</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@EntityGraph</span><span class="pun">(</span><span class="pln">value </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"GroupInfo.detail"</span><span
        class="pun">,</span><span class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span
        class="typ">EntityGraphType</span><span class="pun">.</span><span class="pln">LOAD</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">GroupInfo</span><span class="pln"> getByGroupName</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> name</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>It is also possible to define <em>ad-hoc</em> entity graphs via <code>@EntityGraph</code>.
                            The provided <code>attributePaths</code> will be translated into the according <code>EntityGraph</code>
                            without the need of having to explicitly add <code>@NamedEntityGraph</code> to your domain
                            types.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 59. Using AD-HOC entity graph definition on an repository query
                            method.
                        </div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Repository</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">GroupRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">CrudRepository</span><span class="pun">&lt;</span><span
        class="typ">GroupInfo</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="lit">@EntityGraph</span><span class="pun">(</span><span class="pln">attributePaths </span><span
        class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span
        class="str">"members"</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
  </span><span class="typ">GroupInfo</span><span class="pln"> getByGroupName</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> name</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="projections"><a class="anchor" href="#projections"></a>5.3.11. Projections</h4>
                    <div class="paragraph">
                        <p>Spring Data Repositories usually return the domain model when using query methods. However,
                            sometimes, you may need to alter the view of that model for various reasons. In this
                            section, you will learn how to define projections to serve up simplified and reduced views
                            of resources.</p>
                    </div>
                    <div class="paragraph">
                        <p>Look at the following domain model:</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Id</span><span class="pln"> </span><span class="lit">@GeneratedValue</span><span
        class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span
        class="pln"> id</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName</span><span
        class="pun">,</span><span class="pln"> lastName</span><span class="pun">;</span><span class="pln">

  </span><span class="lit">@OneToOne</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> address</span><span
        class="pun">;</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">Address</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Id</span><span class="pln"> </span><span class="lit">@GeneratedValue</span><span
        class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span
        class="pln"> id</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> street</span><span
        class="pun">,</span><span class="pln"> state</span><span class="pun">,</span><span
        class="pln"> country</span><span class="pun">;</span><span class="pln">

  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>This <code>Person</code> has several attributes:</p>
                    </div>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p><code>id</code> is the primary key</p>
                            </li>
                            <li>
                                <p><code>firstName</code> and <code>lastName</code> are data attributes</p>
                            </li>
                            <li>
                                <p><code>address</code> is a link to another domain object</p>
                            </li>
                        </ul>
                    </div>
                    <div class="paragraph">
                        <p>Now assume we create a corresponding repository as follows:</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">PersonRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">CrudRepository</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="typ">Person</span><span class="pln"> findPersonByFirstName</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> firstName</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Spring Data will return the domain object including all of its attributes. There are two
                            options just to retrieve the <code>address</code> attribute. One option is to define a
                            repository for <code>Address</code> objects like this:</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
                            <pre class="prettyprint highlight prettyprinted" style=""><code class="language-java"
                                                                                            data-lang="java"><span
                                    class="kwd">interface</span><span class="pln"> </span><span class="typ">AddressRepository</span><span
                                    class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
                                    class="typ">CrudRepository</span><span class="pun">&lt;</span><span class="typ">Address</span><span
                                    class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span
                                    class="pun">&gt;</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>In this situation, using <code>PersonRepository</code> will still return the whole <code>Person</code>
                            object. Using <code>AddressRepository</code> will return just the <code>Address</code>.</p>
                    </div>
                    <div class="paragraph">
                        <p>However, what if you do not want to expose <code>address</code> details at all? You can offer
                            the consumer of your repository service an alternative by defining one or more projections.
                        </p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 60. Simple Projection</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">NoAddresses</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">  </span><i class="conum" data-value="1"></i><b><span
        class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

  </span><span class="typ">String</span><span class="pln"> getFirstName</span><span class="pun">();</span><span
        class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span
        class="lit">2</span><span class="pun">)</span></b><span class="pln">

  </span><span class="typ">String</span><span class="pln"> getLastName</span><span class="pun">();</span><span
        class="pln">  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span
        class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>This projection has the following details:</p>
                            </div>
                            <div class="colist arabic">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td><i class="conum" data-value="1"></i><b>1</b></td>
                                        <td>A plain Java interface making it declarative.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="2"></i><b>2</b></td>
                                        <td>Export the <code>firstName</code>.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="3"></i><b>3</b></td>
                                        <td>Export the <code>lastName</code>.</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>The <code>NoAddresses</code> projection only has getters for <code>firstName</code> and
                            <code>lastName</code> meaning that it will not serve up any address information. The query
                            method definition returns in this case <code>NoAdresses</code> instead of
                            <code>Person</code>.</p>
                    </div>
                    <div class="listingblock">
                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">PersonRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">CrudRepository</span><span class="pun">&lt;</span><span class="typ">Person</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="typ">NoAddresses</span><span class="pln"> findByFirstName</span><span class="pun">(</span><span
        class="typ">String</span><span class="pln"> firstName</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Projections declare a contract between the underlying type and the method signatures related
                            to the exposed properties. Hence it is required to name getter methods according to the
                            property name of the underlying type. If the underlying property is named
                            <code>firstName</code>, then the getter method must be named <code>getFirstName</code>
                            otherwise Spring Data is not able to look up the source property. This type of projection is
                            also called <em>closed projection</em>. Closed projections expose a subset of properties
                            hence they can be used to optimize the query in a way to reduce the selected fields from the
                            data store. The other type is, as you might imagine, an <em>open projection</em>.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="projections.remodelling-data"><a class="anchor"
                                                                 href="#projections.remodelling-data"></a>Remodelling
                            data</h5>
                        <div class="paragraph">
                            <p>So far, you have seen how projections can be used to reduce the information that is
                                presented to the user. Projections can be used to adjust the exposed data model. You can
                                add virtual properties to your projection. Look at the following projection
                                interface:</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 61. Renaming a property</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">RenamedProperty</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">    </span><i class="conum"
                                                                                      data-value="1"></i><b><span
        class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

  </span><span class="typ">String</span><span class="pln"> getFirstName</span><span class="pun">();</span><span
        class="pln">       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span
        class="lit">2</span><span class="pun">)</span></b><span class="pln">

  </span><span class="lit">@Value</span><span class="pun">(</span><span class="str">"#{target.lastName}"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">();</span><span
        class="pln">            </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span
        class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                                <div class="paragraph">
                                    <p>This projection has the following details:</p>
                                </div>
                                <div class="colist arabic">
                                    <table>
                                        <tbody>
                                        <tr>
                                            <td><i class="conum" data-value="1"></i><b>1</b></td>
                                            <td>A plain Java interface making it declarative.</td>
                                        </tr>
                                        <tr>
                                            <td><i class="conum" data-value="2"></i><b>2</b></td>
                                            <td>Export the <code>firstName</code>.</td>
                                        </tr>
                                        <tr>
                                            <td><i class="conum" data-value="3"></i><b>3</b></td>
                                            <td>Export the <code>name</code> property. Since this property is virtual it
                                                requires <code>@Value("#{target.lastName}")</code> to specify the
                                                property source.
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>The backing domain model does not have this property so we need to tell Spring Data from
                                where this property is obtained.
                                Virtual properties are the place where <code>@Value</code> comes into play. The <code>name</code>
                                getter is annotated with <code>@Value</code> to use <a
                                        href="http://docs.spring.io/spring/docs/4.2.9.RELEASE/spring-framework-reference/html/expressions.html">SpEL
                                    expressions</a> pointing to the backing property <code>lastName</code>. You may have
                                noticed <code>lastName</code> is prefixed with <code>target</code> which is the variable
                                name pointing to the backing object. Using <code>@Value</code> on methods allows
                                defining where and how the value is obtained.</p>
                        </div>
                        <div class="paragraph">
                            <p>Some applications require the full name of a person. Concatenating strings with <code>String.format("%s
                                %s", person.getFirstName(), person.getLastName())</code> would be one possibility but
                                this piece of code needs to be called in every place the full name is required. Virtual
                                properties on projections leverage the need for repeating that code all over.</p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">FullNameAndCountry</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Value</span><span class="pun">(</span><span class="str">"#{target.firstName} #{target.lastName}"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> getFullName</span><span class="pun">();</span><span
        class="pln">

  </span><span class="lit">@Value</span><span class="pun">(</span><span
        class="str">"#{target.address.country}"</span><span class="pun">)</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> getCountry</span><span class="pun">();</span><span
        class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>In fact, <code>@Value</code> gives full access to the target object and its nested
                                properties. SpEL expressions are extremly powerful as the definition is always applied
                                to the projection method. Let’s take SpEL expressions in projections to the next level.
                            </p>
                        </div>
                        <div class="paragraph">
                            <p>Imagine you had the following domain model definition:</p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Entity</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Id</span><span class="pln"> </span><span class="lit">@GeneratedValue</span><span
        class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Long</span><span
        class="pln"> id</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span
        class="pun">;</span><span class="pln">

  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> password</span><span
        class="pun">;</span><span class="pln">
  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                        <div class="admonitionblock important">
                            <table>
                                <tbody>
                                <tr>
                                    <td class="icon">
                                        <i class="fa icon-important" title="Important"></i>
                                    </td>
                                    <td class="content">
                                        This example may seem a bit contrived, but it is possible with a richer domain
                                        model and many projections, to accidentally leak such details. Since Spring Data
                                        cannot discern the sensitivity of such data, it is up to the developers to avoid
                                        such situations. Storing a password as plain-text is discouraged. You really
                                        should not do this. For this example, you could also replace
                                        <code>password</code> with anything else that is secret.
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="paragraph">
                            <p>In some cases, you might keep the <code>password</code> as secret as possible and not
                                expose it more than it should be. The solution is to create a projection using <code>@Value</code>
                                together with a SpEL expression.</p>
                        </div>
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">PasswordProjection</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="lit">@Value</span><span class="pun">(</span><span class="str">"#{(target.password == null || target.password.empty) ? null : '******'}"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> getPassword</span><span class="pun">();</span><span
        class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>The expression checks whether the password is <code>null</code> or empty and returns
                                <code>null</code> in this case, otherwise six asterisks to indicate a password was set.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="jpa.stored-procedures"><a class="anchor" href="#jpa.stored-procedures"></a>5.4. Stored
                    procedures</h3>
                <div class="paragraph">
                    <p>The JPA 2.1 specification introduced support for calling stored procedures via the JPA criteria
                        query API. We Introduced the <code>@Procedure</code> annotation for declaring stored procedure
                        metadata on a repository method.</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 62. The definition of the pus1inout procedure in HSQL DB.</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-sql" data-lang="sql"><span class="pun">/;</span><span
        class="pln">
DROP procedure IF EXISTS plus1inout
</span><span class="pun">/;</span><span class="pln">
CREATE procedure plus1inout </span><span class="pun">(</span><span class="pln">IN arg </span><span
        class="kwd">int</span><span class="pun">,</span><span class="pln"> OUT res </span><span
        class="kwd">int</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">BEGIN</span><span class="pln"> ATOMIC
 </span><span class="kwd">set</span><span class="pln"> res </span><span class="pun">=</span><span
        class="pln"> arg </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span
        class="pun">;</span><span class="pln">
</span><span class="kwd">END</span><span class="pln">
</span><span class="pun">/;</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Metadata for stored procedures can be configured via the <code>NamedStoredProcedureQuery</code>
                        annotation on an entity type.</p>
                </div>
                <div id="jpa.stored-procedure-entity-metadata" class="exampleblock">
                    <div class="title">Example 63. StoredProcedure metadata definitions on an entity.</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Entity</span><span class="pln">
</span><span class="lit">@NamedStoredProcedureQuery</span><span class="pun">(</span><span class="pln">name </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"User.plus1"</span><span
        class="pun">,</span><span class="pln"> procedureName </span><span class="pun">=</span><span class="pln"> </span><span
        class="str">"plus1inout"</span><span class="pun">,</span><span class="pln"> parameters </span><span class="pun">=</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="lit">@StoredProcedureParameter</span><span class="pun">(</span><span class="pln">mode </span><span
        class="pun">=</span><span class="pln"> </span><span class="typ">ParameterMode</span><span
        class="pun">.</span><span class="pln">IN</span><span class="pun">,</span><span class="pln"> name </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"arg"</span><span class="pun">,</span><span
        class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span
        class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span
        class="pun">),</span><span class="pln">
  </span><span class="lit">@StoredProcedureParameter</span><span class="pun">(</span><span class="pln">mode </span><span
        class="pun">=</span><span class="pln"> </span><span class="typ">ParameterMode</span><span
        class="pun">.</span><span class="pln">OUT</span><span class="pun">,</span><span class="pln"> name </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"res"</span><span class="pun">,</span><span
        class="pln"> type </span><span class="pun">=</span><span class="pln"> </span><span
        class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">User</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Stored procedures can be referenced from a repository method in multiple ways. The stored
                        procedure to be called can either be defined directly via the <code>value</code> or <code>procedureName</code>
                        attribute of the <code>@Procedure</code> annotation or indirectly via the <code>name</code>
                        attribute. If no name is configured the name of the repository method is used as a fallback.</p>
                </div>
                <div id="jpa.stored-procedure-reference" class="exampleblock">
                    <div class="title">Example 64. Referencing explicitly mapped procedure with name "plus1inout" in
                        database.
                    </div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Procedure</span><span class="pun">(</span><span class="str">"plus1inout"</span><span
        class="pun">)</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> explicitlyNamedPlus1inout</span><span
        class="pun">(</span><span class="typ">Integer</span><span class="pln"> arg</span><span
        class="pun">);</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 65. Referencing implicitly mapped procedure with name "plus1inout" in
                        database via <code>procedureName</code> alias.
                    </div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Procedure</span><span class="pun">(</span><span class="pln">procedureName </span><span class="pun">=</span><span
        class="pln"> </span><span class="str">"plus1inout"</span><span class="pun">)</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> plus1inout</span><span class="pun">(</span><span class="typ">Integer</span><span
        class="pln"> arg</span><span class="pun">);</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 66. Referencing explicitly mapped named stored procedure "User.plus1IO"
                        in EntityManager.
                    </div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Procedure</span><span class="pun">(</span><span class="pln">name </span><span
        class="pun">=</span><span class="pln"> </span><span class="str">"User.plus1IO"</span><span
        class="pun">)</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> entityAnnotatedCustomNamedProcedurePlus1IO</span><span
        class="pun">(</span><span class="lit">@Param</span><span class="pun">(</span><span class="str">"arg"</span><span
        class="pun">)</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> arg</span><span
        class="pun">);</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 67. Referencing implicitly mapped named stored procedure "User.plus1" in
                        EntityManager via method-name.
                    </div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Procedure</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> plus1</span><span class="pun">(</span><span
        class="lit">@Param</span><span class="pun">(</span><span class="str">"arg"</span><span class="pun">)</span><span
        class="pln"> </span><span class="typ">Integer</span><span class="pln"> arg</span><span
        class="pun">);</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="specifications"><a class="anchor" href="#specifications"></a>5.5. Specifications</h3>
                <div class="paragraph">
                    <p>JPA 2 introduces a criteria API that can be used to build queries programmatically. Writing a
                        <code>criteria</code> you actually define the where-clause of a query for a domain class. Taking
                        another step back these criteria can be regarded as predicate over the entity that is described
                        by the JPA criteria API constraints.</p>
                </div>
                <div class="paragraph">
                    <p>Spring Data JPA takes the concept of a specification from Eric Evans' book "Domain Driven
                        Design", following the same semantics and providing an API to define such specifications using
                        the JPA criteria API. To support specifications you can extend your repository interface with
                        the <code>JpaSpecificationExecutor</code> interface:</p>
                </div>
                <div class="listingblock">
                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">CustomerRepository</span><span class="pln"> </span><span class="kwd">extends</span><span
        class="pln"> </span><span class="typ">CrudRepository</span><span class="pun">&lt;</span><span class="typ">Customer</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;,</span><span
        class="pln"> </span><span class="typ">JpaSpecificationExecutor</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">
 </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>The additional interface carries methods that allow you to execute specifications in a variety of
                        ways. For example, the <code>findAll</code> method will return all entities that match the
                        specification:</p>
                </div>
                <div class="listingblock">
                    <div class="content">
                        <pre class="prettyprint highlight prettyprinted" style=""><code class="language-java"
                                                                                        data-lang="java"><span
                                class="typ">List</span><span class="pun">&lt;</span><span class="pln">T</span><span
                                class="pun">&gt;</span><span class="pln"> findAll</span><span class="pun">(</span><span
                                class="typ">Specification</span><span class="pun">&lt;</span><span
                                class="pln">T</span><span class="pun">&gt;</span><span class="pln"> spec</span><span
                                class="pun">);</span></code></pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>The <code>Specification</code> interface is defined as follows:</p>
                </div>
                <div class="listingblock">
                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">Specification</span><span class="pun">&lt;</span><span
        class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">
  </span><span class="typ">Predicate</span><span class="pln"> toPredicate</span><span class="pun">(</span><span
        class="typ">Root</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span
        class="pln"> root</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">CriteriaQuery</span><span class="pun">&lt;?&gt;</span><span class="pln"> query</span><span
        class="pun">,</span><span class="pln">
            </span><span class="typ">CriteriaBuilder</span><span class="pln"> builder</span><span
        class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Okay, so what is the typical use case? Specifications can easily be used to build an extensible
                        set of predicates on top of an entity that then can be combined and used with <code>JpaRepository</code>
                        without the need to declare a query (method) for every needed combination. Here’s an example:
                    </p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 68. Specifications for a Customer</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">CustomerSpecs</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span
        class="pln"> </span><span class="typ">Specification</span><span class="pun">&lt;</span><span class="typ">Customer</span><span
        class="pun">&gt;</span><span class="pln"> isLongTermCustomer</span><span class="pun">()</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span
        class="pln"> </span><span class="typ">Specification</span><span class="pun">&lt;</span><span class="typ">Customer</span><span
        class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Predicate</span><span
        class="pln"> toPredicate</span><span class="pun">(</span><span class="typ">Root</span><span
        class="pun">&lt;</span><span class="typ">Customer</span><span class="pun">&gt;</span><span
        class="pln"> root</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">CriteriaQuery</span><span class="pun">&lt;?&gt;</span><span class="pln"> query</span><span
        class="pun">,</span><span class="pln">
            </span><span class="typ">CriteriaBuilder</span><span class="pln"> builder</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

         </span><span class="typ">LocalDate</span><span class="pln"> date </span><span class="pun">=</span><span
        class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">LocalDate</span><span class="pun">().</span><span class="pln">minusYears</span><span
        class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln">
         </span><span class="kwd">return</span><span class="pln"> builder</span><span class="pun">.</span><span
        class="pln">lessThan</span><span class="pun">(</span><span class="pln">root</span><span
        class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span
        class="typ">_Customer</span><span class="pun">.</span><span class="pln">createdAt</span><span
        class="pun">),</span><span class="pln"> date</span><span class="pun">);</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span
        class="pln"> </span><span class="typ">Specification</span><span class="pun">&lt;</span><span class="typ">Customer</span><span
        class="pun">&gt;</span><span class="pln"> hasSalesOfMoreThan</span><span class="pun">(</span><span class="typ">MontaryAmount</span><span
        class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span
        class="pln"> </span><span class="typ">Specification</span><span class="pun">&lt;</span><span class="typ">Customer</span><span
        class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Predicate</span><span
        class="pln"> toPredicate</span><span class="pun">(</span><span class="typ">Root</span><span
        class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span
        class="pln"> root</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">CriteriaQuery</span><span class="pun">&lt;?&gt;</span><span class="pln"> query</span><span
        class="pun">,</span><span class="pln">
            </span><span class="typ">CriteriaBuilder</span><span class="pln"> builder</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

         </span><span class="com">// build query here</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">};</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Admittedly the amount of boilerplate leaves room for improvement (that will hopefully be reduced
                        by Java 8 closures) but the client side becomes much nicer as you will see below. The <code>_Customer</code>
                        type is a metamodel type generated using the JPA Metamodel generator (see the <a
                                href="https://docs.jboss.org/hibernate/jpamodelgen/1.0/reference/en-US/html_single/#whatisit">Hibernate
                            implementation’s documentation for example</a>). So the expression
                        <code>_Customer.createdAt</code> is asuming the <code>Customer</code> having a
                        <code>createdAt</code> attribute of type <code>Date</code>. Besides that we have expressed some
                        criteria on a business requirement abstraction level and created executable
                        <code>Specifications</code>. So a client might use a <code>Specification</code> as follows:</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 69. Using a simple Specification</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
                                <pre class="prettyprint highlight prettyprinted" style=""><code class="language-java"
                                                                                                data-lang="java"><span
                                        class="typ">List</span><span class="pun">&lt;</span><span
                                        class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> customers </span><span
                                        class="pun">=</span><span class="pln"> customerRepository</span><span
                                        class="pun">.</span><span class="pln">findAll</span><span
                                        class="pun">(</span><span class="pln">isLongTermCustomer</span><span
                                        class="pun">());</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Okay, why not simply create a query for this kind of data access? You’re right. Using a single
                        <code>Specification</code> does not gain a lot of benefit over a plain query declaration. The
                        power of specifications really shines when you combine them to create new
                        <code>Specification</code> objects. You can achieve this through the <code>Specifications</code>
                        helper class we provide to build expressions like this:</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 70. Combined Specifications</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">MonetaryAmount</span><span class="pln"> amount </span><span class="pun">=</span><span
        class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span
        class="typ">MonetaryAmount</span><span class="pun">(</span><span class="lit">200.0</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Currencies</span><span class="pun">.</span><span
        class="pln">DOLLAR</span><span class="pun">);</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Customer</span><span
        class="pun">&gt;</span><span class="pln"> customers </span><span class="pun">=</span><span class="pln"> customerRepository</span><span
        class="pun">.</span><span class="pln">findAll</span><span class="pun">(</span><span class="pln">
  where</span><span class="pun">(</span><span class="pln">isLongTermCustomer</span><span class="pun">()).</span><span
        class="pln">or</span><span class="pun">(</span><span class="pln">hasSalesOfMoreThan</span><span
        class="pun">(</span><span class="pln">amount</span><span class="pun">)));</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>As you can see, <code>Specifications</code> offers some glue-code methods to chain and
                                combine <code>Specification</code> instances. Thus extending your data access layer is
                                just a matter of creating new <code>Specification</code> implementations and combining
                                them with ones already existing.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="query-by-example"><a class="anchor" href="#query-by-example"></a>5.6. Query by Example</h3>
                <div class="sect3">
                    <h4 id="query-by-example.introduction"><a class="anchor" href="#query-by-example.introduction"></a>5.6.1.
                        Introduction</h4>
                    <div class="paragraph">
                        <p>This chapter will give you an introduction to Query by Example and explain how to use
                            Examples.</p>
                    </div>
                    <div class="paragraph">
                        <p>Query by Example (QBE) is a user-friendly querying technique with a simple interface. It
                            allows dynamic query creation and does not require to write queries containing field names.
                            In fact, Query by Example does not require to write queries using store-specific query
                            languages at all.</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="query-by-example.usage"><a class="anchor" href="#query-by-example.usage"></a>5.6.2. Usage
                    </h4>
                    <div class="paragraph">
                        <p>The Query by Example API consists of three parts:</p>
                    </div>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p>Probe: That is the actual example of a domain object with populated fields.</p>
                            </li>
                            <li>
                                <p><code>ExampleMatcher</code>: The <code>ExampleMatcher</code> carries details on how
                                    to match particular fields. It can be reused across multiple Examples.</p>
                            </li>
                            <li>
                                <p><code>Example</code>: An <code>Example</code> consists of the probe and the <code>ExampleMatcher</code>.
                                    It is used to create the query.</p>
                            </li>
                        </ul>
                    </div>
                    <div class="paragraph">
                        <p>Query by Example is suited for several use-cases but also comes with limitations:</p>
                    </div>
                    <div class="paragraph">
                        <p><strong>When to use</strong></p>
                    </div>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p>Querying your data store with a set of static or dynamic constraints</p>
                            </li>
                            <li>
                                <p>Frequent refactoring of the domain objects without worrying about breaking existing
                                    queries</p>
                            </li>
                            <li>
                                <p>Works independently from the underlying data store API</p>
                            </li>
                        </ul>
                    </div>
                    <div class="paragraph">
                        <p><strong>Limitations</strong></p>
                    </div>
                    <div class="ulist">
                        <ul>
                            <li>
                                <p>Query predicates are combined using the <code>AND</code> keyword</p>
                            </li>
                            <li>
                                <p>No support for nested/grouped property constraints like <code>firstname = ?0 or
                                    (firstname = ?1 and lastname = ?2)</code></p>
                            </li>
                            <li>
                                <p>Only supports starts/contains/ends/regex matching for strings and exact matching for
                                    other property types</p>
                            </li>
                        </ul>
                    </div>
                    <div class="paragraph">
                        <p>Before getting started with Query by Example, you need to have a domain object. To get
                            started, simply create an interface for your repository:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 71. Sample Person object</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Id</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span
        class="pln"> id</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstname</span><span
        class="pun">;</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> lastname</span><span
        class="pun">;</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> address</span><span
        class="pun">;</span><span class="pln">

  </span><span class="com">// … getters and setters omitted</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>This is a simple domain object. You can use it to create an <code>Example</code>. By default,
                            fields having <code>null</code> values are ignored, and strings are matched using the store
                            specific defaults. Examples can be built by either using the <code>of</code> factory method
                            or by using <a href="#query-by-example.matcher"><code>ExampleMatcher</code></a>. <code>Example</code>
                            is immutable.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 72. Simple Example</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span
        class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span
        class="pun">();</span><span class="pln">                         </span><i class="conum"
                                                                                   data-value="1"></i><b><span
        class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
person</span><span class="pun">.</span><span class="pln">setFirstname</span><span class="pun">(</span><span class="str">"Dave"</span><span
        class="pun">);</span><span class="pln">                          </span><i class="conum"
                                                                                   data-value="2"></i><b><span
        class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="typ">Example</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span
        class="pln"> example </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Example</span><span
        class="pun">.</span><span class="pln">of</span><span class="pun">(</span><span class="pln">person</span><span
        class="pun">);</span><span class="pln">         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span
        class="lit">3</span><span class="pun">)</span></b></code></pre>
                                </div>
                            </div>
                            <div class="colist arabic">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td><i class="conum" data-value="1"></i><b>1</b></td>
                                        <td>Create a new instance of the domain object</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="2"></i><b>2</b></td>
                                        <td>Set the properties to query</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="3"></i><b>3</b></td>
                                        <td>Create the <code>Example</code></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Examples are ideally be executed with repositories. To do so, let your repository interface
                            extend <code>QueryByExampleExecutor&lt;T&gt;</code>. Here’s an excerpt from the <code>QueryByExampleExecutor</code>
                            interface:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 73. The <code>QueryByExampleExecutor</code></div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">QueryByExampleExecutor</span><span class="pun">&lt;</span><span
        class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="pun">&lt;</span><span class="pln">S </span><span class="kwd">extends</span><span
        class="pln"> T</span><span class="pun">&gt;</span><span class="pln"> S findOne</span><span
        class="pun">(</span><span class="typ">Example</span><span class="pun">&lt;</span><span class="pln">S</span><span
        class="pun">&gt;</span><span class="pln"> example</span><span class="pun">);</span><span class="pln">

  </span><span class="pun">&lt;</span><span class="pln">S </span><span class="kwd">extends</span><span
        class="pln"> T</span><span class="pun">&gt;</span><span class="pln"> </span><span
        class="typ">Iterable</span><span class="pun">&lt;</span><span class="pln">S</span><span
        class="pun">&gt;</span><span class="pln"> findAll</span><span class="pun">(</span><span
        class="typ">Example</span><span class="pun">&lt;</span><span class="pln">S</span><span
        class="pun">&gt;</span><span class="pln"> example</span><span class="pun">);</span><span class="pln">

  </span><span class="com">// … more functionality omitted.</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>You can read more about <a href="#query-by-example.execution">Query by Example Execution</a>
                            below.</p>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="query-by-example.matchers"><a class="anchor" href="#query-by-example.matchers"></a>5.6.3.
                        Example matchers</h4>
                    <div class="paragraph">
                        <p>Examples are not limited to default settings. You can specify own defaults for string
                            matching, null handling and property-specific settings using the <code>ExampleMatcher</code>.
                        </p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 74. Example matcher with customized matching</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">Person</span><span class="pln"> person </span><span class="pun">=</span><span
        class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span
        class="pun">();</span><span class="pln">                          </span><i class="conum" data-value="1"></i><b><span
        class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
person</span><span class="pun">.</span><span class="pln">setFirstname</span><span class="pun">(</span><span class="str">"Dave"</span><span
        class="pun">);</span><span class="pln">                           </span><i class="conum" data-value="2"></i><b><span
        class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="typ">ExampleMatcher</span><span class="pln"> matcher </span><span class="pun">=</span><span
        class="pln"> </span><span class="typ">ExampleMatcher</span><span class="pun">.</span><span
        class="pln">matching</span><span class="pun">()</span><span class="pln">     </span><i class="conum"
                                                                                               data-value="3"></i><b><span
        class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
  </span><span class="pun">.</span><span class="pln">withIgnorePaths</span><span class="pun">(</span><span class="str">"lastname"</span><span
        class="pun">)</span><span class="pln">                         </span><i class="conum"
                                                                                 data-value="4"></i><b><span
        class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
  </span><span class="pun">.</span><span class="pln">withIncludeNullValues</span><span class="pun">()</span><span
        class="pln">                             </span><i class="conum" data-value="5"></i><b><span
        class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
  </span><span class="pun">.</span><span class="pln">withStringMatcherEnding</span><span class="pun">();</span><span
        class="pln">                          </span><i class="conum" data-value="6"></i><b><span
        class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">

</span><span class="typ">Example</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span
        class="pln"> example </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Example</span><span
        class="pun">.</span><span class="pln">of</span><span class="pun">(</span><span class="pln">person</span><span
        class="pun">,</span><span class="pln"> matcher</span><span class="pun">);</span><span class="pln"> </span><i
        class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span
        class="pun">)</span></b></code></pre>
                                </div>
                            </div>
                            <div class="colist arabic">
                                <table>
                                    <tbody>
                                    <tr>
                                        <td><i class="conum" data-value="1"></i><b>1</b></td>
                                        <td>Create a new instance of the domain object.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="2"></i><b>2</b></td>
                                        <td>Set properties.</td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="3"></i><b>3</b></td>
                                        <td>Create an <code>ExampleMatcher</code> which is usable at this stage even
                                            without further configuration.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="4"></i><b>4</b></td>
                                        <td>Construct a new <code>ExampleMatcher</code> to ignore the property path
                                            <code>lastname</code>.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="5"></i><b>5</b></td>
                                        <td>Construct a new <code>ExampleMatcher</code> to ignore the property path
                                            <code>lastname</code> and to include null values.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="6"></i><b>6</b></td>
                                        <td>Construct a new <code>ExampleMatcher</code> to ignore the property path
                                            <code>lastname</code>, to include null values, and use perform suffix string
                                            matching.
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><i class="conum" data-value="7"></i><b>7</b></td>
                                        <td>Create a new <code>Example</code> based on the domain object and the
                                            configured <code>ExampleMatcher</code>.
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>You can specify behavior for individual properties (e.g. "firstname" and "lastname",
                            "address.city" for nested properties). You can tune it with matching options and case
                            sensitivity.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 75. Configuring matcher options</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">ExampleMatcher</span><span class="pln"> matcher </span><span class="pun">=</span><span
        class="pln"> </span><span class="typ">ExampleMatcher</span><span class="pun">.</span><span
        class="pln">matching</span><span class="pun">()</span><span class="pln">
  </span><span class="pun">.</span><span class="pln">withMatcher</span><span class="pun">(</span><span class="str">"firstname"</span><span
        class="pun">,</span><span class="pln"> endsWith</span><span class="pun">())</span><span class="pln">
  </span><span class="pun">.</span><span class="pln">withMatcher</span><span class="pun">(</span><span class="str">"lastname"</span><span
        class="pun">,</span><span class="pln"> startsWith</span><span class="pun">().</span><span
        class="pln">ignoreCase</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Another style to configure matcher options is by using Java 8 lambdas. This approach is a
                            callback that asks the implementor to modify the matcher. It’s not required to return the
                            matcher because configuration options are held within the matcher instance.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 76. Configuring matcher options with lambdas</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="typ">ExampleMatcher</span><span class="pln"> matcher </span><span class="pun">=</span><span
        class="pln"> </span><span class="typ">ExampleMatcher</span><span class="pun">.</span><span
        class="pln">matching</span><span class="pun">()</span><span class="pln">
  </span><span class="pun">.</span><span class="pln">withMatcher</span><span class="pun">(</span><span class="str">"firstname"</span><span
        class="pun">,</span><span class="pln"> match </span><span class="pun">-&gt;</span><span
        class="pln"> match</span><span class="pun">.</span><span class="pln">endsWith</span><span class="pun">())</span><span
        class="pln">
  </span><span class="pun">.</span><span class="pln">withMatcher</span><span class="pun">(</span><span class="str">"firstname"</span><span
        class="pun">,</span><span class="pln"> match </span><span class="pun">-&gt;</span><span
        class="pln"> match</span><span class="pun">.</span><span class="pln">startsWith</span><span
        class="pun">());</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Queries created by <code>Example</code> use a merged view of the configuration. Default
                            matching settings can be set at <code>ExampleMatcher</code> level while individual settings
                            can be applied to particular property paths. Settings that are set on
                            <code>ExampleMatcher</code> are inherited by property path settings unless they are defined
                            explicitly. Settings on a property patch have higher precedence than default settings.</p>
                    </div>
                    <table class="tableblock frame-all grid-all spread">
                        <caption class="title">Table 6. Scope of <code>ExampleMatcher</code> settings</caption>
                        <colgroup>
                            <col style="width: 33%;">
                            <col style="width: 66%;">
                        </colgroup>
                        <thead>
                        <tr>
                            <th class="tableblock halign-left valign-top">Setting</th>
                            <th class="tableblock halign-left valign-top">Scope</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">Null-handling</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>ExampleMatcher</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">String matching</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>ExampleMatcher</code> and property path</p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">Ignoring properties</p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">Property path</p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">Case sensitivity</p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">
                                <code>ExampleMatcher</code> and property path</p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">Value transformation</p>
                            </td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock">Property path</p></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="sect3">
                    <h4 id="query-by-example.execution"><a class="anchor" href="#query-by-example.execution"></a>5.6.4.
                        Executing an example</h4>
                    <div class="paragraph">
                        <p>In Spring Data JPA you can use Query by Example with Repositories.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 77. Query by Example using a Repository</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">PersonRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">Person</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln"> </span><span class="pun">…</span><span class="pln"> </span><span class="pun">}</span><span
        class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">PersonService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Autowired</span><span class="pln"> </span><span class="typ">PersonRepository</span><span
        class="pln"> personRepository</span><span class="pun">;</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span
        class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span
        class="pln"> findPeople</span><span class="pun">(</span><span class="typ">Person</span><span
        class="pln"> probe</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">
    </span><span class="kwd">return</span><span class="pln"> personRepository</span><span class="pun">.</span><span
        class="pln">findAll</span><span class="pun">(</span><span class="typ">Example</span><span
        class="pun">.</span><span class="pln">of</span><span class="pun">(</span><span class="pln">probe</span><span
        class="pun">));</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    Only <code>SingularAttribute</code> properties can currently be used for property
                                    matching.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="paragraph">
                        <p>Property specifier accepts property names (e.g. "firstname" and "lastname"). You can navigate
                            by chaining properties together with dots ("address.city"). You can tune it with matching
                            options and case sensitivity.</p>
                    </div>
                    <table class="tableblock frame-all grid-all spread">
                        <caption class="title">Table 7. <code>StringMatcher</code> options</caption>
                        <colgroup>
                            <col style="width: 33%;">
                            <col style="width: 66%;">
                        </colgroup>
                        <thead>
                        <tr>
                            <th class="tableblock halign-left valign-top">Matching</th>
                            <th class="tableblock halign-left valign-top">Logical result</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code>
                                (case-sensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname =
                                ?0</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code>
                                (case-insensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) =
                                LOWER(?0)</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXACT</code>
                                (case-sensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname =
                                ?0</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXACT</code>
                                (case-insensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname) =
                                LOWER(?0)</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING</code>
                                (case-sensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like ?0
                                + '%'</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING</code>
                                (case-insensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname)
                                like LOWER(?0) + '%'</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING</code>
                                (case-sensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like '%'
                                + ?0</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING</code>
                                (case-insensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname)
                                like '%' + LOWER(?0)</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code>
                                (case-sensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>firstname like '%'
                                + ?0 + '%'</code></p></td>
                        </tr>
                        <tr>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code>
                                (case-insensitive)</p></td>
                            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(firstname)
                                like '%' + LOWER(?0) + '%'</code></p></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="sect2">
                <h3 id="transactions"><a class="anchor" href="#transactions"></a>5.7. Transactionality</h3>
                <div class="paragraph">
                    <p>CRUD methods on repository instances are transactional by default. For reading operations the
                        transaction configuration <code>readOnly</code> flag is set to true, all others are configured
                        with a plain <code>@Transactional</code> so that default transaction configuration applies. For
                        details see JavaDoc of <code>CrudRepository</code>. If you need to tweak transaction
                        configuration for one of the methods declared in a repository simply redeclare the method in
                        your repository interface as follows:</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 78. Custom transaction configuration for CRUD</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">CrudRepository</span><span class="pun">&lt;</span><span
        class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Override</span><span class="pln">
  </span><span class="lit">@Transactional</span><span class="pun">(</span><span class="pln">timeout </span><span
        class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">)</span><span
        class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">&gt;</span><span
        class="pln"> findAll</span><span class="pun">();</span><span class="pln">

  </span><span class="com">// Further query method declarations</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>This will cause the <code>findAll()</code> method to be executed with a timeout of 10
                                seconds and without the <code>readOnly</code> flag.</p>
                        </div>
                    </div>
                </div>
                <div class="paragraph">
                    <p>Another possibility to alter transactional behaviour is using a facade or service implementation
                        that typically covers more than one repository. Its purpose is to define transactional
                        boundaries for non-CRUD operations:</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 79. Using a facade to define transactions for multiple repository calls
                    </div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Service</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">UserManagementImpl</span><span
        class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">UserManagement</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> userRepository</span><span
        class="pun">;</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span
        class="pln"> </span><span class="typ">RoleRepository</span><span class="pln"> roleRepository</span><span
        class="pun">;</span><span class="pln">

  </span><span class="lit">@Autowired</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">UserManagementImpl</span><span
        class="pun">(</span><span class="typ">UserRepository</span><span class="pln"> userRepository</span><span
        class="pun">,</span><span class="pln">
    </span><span class="typ">RoleRepository</span><span class="pln"> roleRepository</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">userRepository </span><span
        class="pun">=</span><span class="pln"> userRepository</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">roleRepository </span><span
        class="pun">=</span><span class="pln"> roleRepository</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="lit">@Transactional</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addRoleToAllUsers</span><span
        class="pun">(</span><span class="typ">String</span><span class="pln"> roleName</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">Role</span><span class="pln"> role </span><span class="pun">=</span><span class="pln"> roleRepository</span><span
        class="pun">.</span><span class="pln">findByName</span><span class="pun">(</span><span
        class="pln">roleName</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">User</span><span
        class="pln"> user </span><span class="pun">:</span><span class="pln"> userRepository</span><span
        class="pun">.</span><span class="pln">findAll</span><span class="pun">())</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">
      user</span><span class="pun">.</span><span class="pln">addRole</span><span class="pun">(</span><span class="pln">role</span><span
        class="pun">);</span><span class="pln">
      userRepository</span><span class="pun">.</span><span class="pln">save</span><span class="pun">(</span><span
        class="pln">user</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>This will cause call to <code>addRoleToAllUsers(…)</code> to run inside a transaction
                                (participating in an existing one or create a new one if none already running). The
                                transaction configuration at the repositories will be neglected then as the outer
                                transaction configuration determines the actual one used. Note that you will have to
                                activate <code>&lt;tx:annotation-driven /&gt;</code> or use <code>@EnableTransactionManagement</code>
                                explicitly to get annotation based configuration at facades working. The example above
                                assumes you are using component scanning.</p>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="transactional-query-methods"><a class="anchor" href="#transactional-query-methods"></a>5.7.1.
                        Transactional query methods</h4>
                    <div class="paragraph">
                        <p>To allow your query methods to be transactional simply use <code>@Transactional</code> at the
                            repository interface you define.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 80. Using @Transactional at query methods</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Transactional</span><span class="pun">(</span><span class="pln">readOnly </span><span
        class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span
        class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
        class="pln"> </span><span class="typ">UserRepository</span><span class="pln"> </span><span
        class="kwd">extends</span><span class="pln"> </span><span class="typ">JpaRepository</span><span
        class="pun">&lt;</span><span class="typ">User</span><span class="pun">,</span><span class="pln"> </span><span
        class="typ">Long</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span
        class="pln">

  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">);</span><span class="pln">

  </span><span class="lit">@Modifying</span><span class="pln">
  </span><span class="lit">@Transactional</span><span class="pln">
  </span><span class="lit">@Query</span><span class="pun">(</span><span class="str">"delete from User u where u.active = false"</span><span
        class="pun">)</span><span class="pln">
  </span><span class="kwd">void</span><span class="pln"> deleteInactiveUsers</span><span class="pun">();</span><span
        class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                            <div class="paragraph">
                                <p>Typically you will want the readOnly flag set to true as most of the query methods
                                    will only read data. In contrast to that <code>deleteInactiveUsers()</code> makes
                                    use of the <code>@Modifying</code> annotation and overrides the transaction
                                    configuration. Thus the method will be executed with <code>readOnly</code> flag set
                                    to <code>false</code>.</p>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    <div class="paragraph">
                                        <p>It’s definitely reasonable to use transactions for read only queries and we
                                            can mark them as such by setting the <code>readOnly</code> flag. This will
                                            not, however, act as check that you do not trigger a manipulating query
                                            (although some databases reject <code>INSERT</code> and <code>UPDATE</code>
                                            statements inside a read only transaction). The <code>readOnly</code> flag
                                            instead is propagated as hint to the underlying JDBC driver for performance
                                            optimizations. Furthermore, Spring will perform some optimizations on the
                                            underlying JPA provider. E.g. when used with Hibernate the flush mode is set
                                            to <code>NEVER</code> when you configure a transaction as
                                            <code>readOnly</code> which causes Hibernate to skip dirty checks (a
                                            noticeable improvement on large object trees).</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="locking"><a class="anchor" href="#locking"></a>5.8. Locking</h3>
                <div class="paragraph">
                    <p>To specify the lock mode to be used the <code>@Lock</code> annotation can be used on query
                        methods:</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 81. Defining lock metadata on query methods</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="com">// Plain query method</span><span class="pln">
  </span><span class="lit">@Lock</span><span class="pun">(</span><span class="typ">LockModeType</span><span class="pun">.</span><span
        class="pln">READ</span><span class="pun">)</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findByLastname</span><span class="pun">(</span><span class="typ">String</span><span
        class="pln"> lastname</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="paragraph">
                    <p>This method declaration will cause the query being triggered to be equipped with the <code>LockModeType</code>
                        <code>READ</code>. You can also define locking for CRUD methods by redeclaring them in your
                        repository interface and adding the <code>@Lock</code> annotation:</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 82. Defining lock metadata on CRUD methods</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">interface</span><span class="pln"> </span><span class="typ">UserRepository</span><span
        class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
        class="typ">Repository</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">,</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">&gt;</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="com">// Redeclaration of a CRUD method</span><span class="pln">
  </span><span class="lit">@Lock</span><span class="pun">(</span><span class="typ">LockModeType</span><span class="pun">.</span><span
        class="pln">READ</span><span class="pun">);</span><span class="pln">
  </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> findAll</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="auditing"><a class="anchor" href="#auditing"></a>5.9. Auditing</h3>
                <div class="sect3">
                    <h4 id="auditing.basics"><a class="anchor" href="#auditing.basics"></a>5.9.1. Basics</h4>
                    <div class="paragraph">
                        <p>Spring Data provides sophisticated support to transparently keep track of who created or
                            changed an entity and the point in time this happened. To benefit from that functionality
                            you have to equip your entity classes with auditing metadata that can be defined either
                            using annotations or by implementing an interface.</p>
                    </div>
                    <div class="sect4">
                        <h5 id="auditing.annotations"><a class="anchor" href="#auditing.annotations"></a>Annotation
                            based auditing metadata</h5>
                        <div class="paragraph">
                            <p>We provide <code>@CreatedBy</code>, <code>@LastModifiedBy</code> to capture the user who
                                created or modified the entity as well as <code>@CreatedDate</code> and <code>@LastModifiedDate</code>
                                to capture the point in time this happened.</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 83. An audited entity</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">class</span><span class="pln"> </span><span class="typ">Customer</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@CreatedBy</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">User</span><span
        class="pln"> user</span><span class="pun">;</span><span class="pln">

  </span><span class="lit">@CreatedDate</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">DateTime</span><span class="pln"> createdDate</span><span
        class="pun">;</span><span class="pln">

  </span><span class="com">// … further properties omitted</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>As you can see, the annotations can be applied selectively, depending on which
                                information you’d like to capture. For the annotations capturing the points in time can
                                be used on properties of type JodaTimes <code>DateTime</code>, legacy Java
                                <code>Date</code> and <code>Calendar</code>, JDK8 date/time types as well as
                                <code>long</code>/<code>Long</code>.</p>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="auditing.interfaces"><a class="anchor" href="#auditing.interfaces"></a>Interface-based
                            auditing metadata</h5>
                        <div class="paragraph">
                            <p>In case you don’t want to use annotations to define auditing metadata you can let your
                                domain class implement the <code>Auditable</code> interface. It exposes setter methods
                                for all of the auditing properties.</p>
                        </div>
                        <div class="paragraph">
                            <p>There’s also a convenience base class <code>AbstractAuditable</code> which you can extend
                                to avoid the need to manually implement the interface methods. Be aware that this
                                increases the coupling of your domain classes to Spring Data which might be something
                                you want to avoid. Usually the annotation based way of defining auditing metadata is
                                preferred as it is less invasive and more flexible.</p>
                        </div>
                    </div>
                    <div class="sect4">
                        <h5 id="auditing.auditor-aware"><a class="anchor" href="#auditing.auditor-aware"></a>AuditorAware
                        </h5>
                        <div class="paragraph">
                            <p>In case you use either <code>@CreatedBy</code> or <code>@LastModifiedBy</code>, the
                                auditing infrastructure somehow needs to become aware of the current principal. To do
                                so, we provide an <code>AuditorAware&lt;T&gt;</code> SPI interface that you have to
                                implement to tell the infrastructure who the current user or system interacting with the
                                application is. The generic type <code>T</code> defines of what type the properties
                                annotated with <code>@CreatedBy</code> or <code>@LastModifiedBy</code> have to be.</p>
                        </div>
                        <div class="paragraph">
                            <p>Here’s an example implementation of the interface using Spring Security’s <code>Authentication</code>
                                object:</p>
                        </div>
                        <div class="exampleblock">
                            <div class="title">Example 84. Implementation of AuditorAware based on Spring Security</div>
                            <div class="content">
                                <div class="listingblock">
                                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">class</span><span class="pln"> </span><span class="typ">SpringSecurityAuditorAware</span><span
        class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span
        class="typ">AuditorAware</span><span class="pun">&lt;</span><span class="typ">User</span><span
        class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> getCurrentAuditor</span><span
        class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">Authentication</span><span class="pln"> authentication </span><span
        class="pun">=</span><span class="pln"> </span><span class="typ">SecurityContextHolder</span><span
        class="pun">.</span><span class="pln">getContext</span><span class="pun">().</span><span class="pln">getAuthentication</span><span
        class="pun">();</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">authentication </span><span
        class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span
        class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">authentication</span><span
        class="pun">.</span><span class="pln">isAuthenticated</span><span class="pun">())</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span
        class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">((</span><span class="typ">MyUserDetails</span><span
        class="pun">)</span><span class="pln"> authentication</span><span class="pun">.</span><span class="pln">getPrincipal</span><span
        class="pun">()).</span><span class="pln">getUser</span><span class="pun">();</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="paragraph">
                            <p>The implementation is accessing the <code>Authentication</code> object provided by Spring
                                Security and looks up the custom <code>UserDetails</code> instance from it that you have
                                created in your <code>UserDetailsService</code> implementation. We’re assuming here that
                                you are exposing the domain user through that <code>UserDetails</code> implementation
                                but you could also look it up from anywhere based on the <code>Authentication</code>
                                found.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="jpa.auditing"><a class="anchor" href="#jpa.auditing"></a>5.10. JPA Auditing</h3>
                <div class="sect3">
                    <h4 id="jpa.auditing.configuration"><a class="anchor" href="#jpa.auditing.configuration"></a>5.10.1.
                        General auditing configuration</h4>
                    <div class="paragraph">
                        <p>Spring Data JPA ships with an entity listener that can be used to trigger capturing auditing
                            information. So first you have to register the <code>AuditingEntityListener</code> inside
                            your <code>orm.xml</code> to be used for all entities in your persistence contexts:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 85. Auditing configuration orm.xml</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;persistence-unit-metadata&gt;</span><span
        class="pln">
  </span><span class="tag">&lt;persistence-unit-defaults&gt;</span><span class="pln">
    </span><span class="tag">&lt;entity-listeners&gt;</span><span class="pln">
      </span><span class="tag">&lt;entity-listener</span><span class="pln"> </span><span class="atn">class</span><span
        class="pun">=</span><span class="atv">"….data.jpa.domain.support.AuditingEntityListener"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/entity-listeners&gt;</span><span class="pln">
  </span><span class="tag">&lt;/persistence-unit-defaults&gt;</span><span class="pln">
</span><span class="tag">&lt;/persistence-unit-metadata&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>You can also enable the <code>AuditingEntityListener</code> per entity using the <code>@EntityListeners</code>
                            annotation:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Entity</span><span class="pln">
</span><span class="lit">@EntityListeners</span><span class="pun">(</span><span
        class="typ">AuditingEntityListener</span><span class="pun">.</span><span class="kwd">class</span><span
        class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span
        class="typ">MyEntity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>Note that the auditing feature requires <code>spring-aspects.jar</code> to be on the
                            classpath.</p>
                    </div>
                    <div class="paragraph">
                        <p>With that in place, activating auditing functionality is just a matter of adding the Spring
                            Data JPA <code>auditing</code> namespace element to your configuration:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 86. Activating auditing using XML configuration</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
                                    <pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml"
                                                                                                    data-lang="xml"><span
                                            class="tag">&lt;jpa:auditing</span><span class="pln"> </span><span
                                            class="atn">auditor-aware-ref</span><span class="pun">=</span><span
                                            class="atv">"yourAuditorAwareBean"</span><span class="pln"> </span><span
                                            class="tag">/&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>As of Spring Data JPA 1.5, auditing can be enabled by annotating a configuration class with
                            the @EnableJpaAuditing annotation.</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 87. Activating auditing via Java configuration</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="lit">@Configuration</span><span class="pln">
</span><span class="lit">@EnableJpaAuditing</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Config</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">

  </span><span class="lit">@Bean</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">AuditorAware</span><span
        class="pun">&lt;</span><span class="typ">AuditableUser</span><span class="pun">&gt;</span><span class="pln"> auditorProvider</span><span
        class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span
        class="pln"> </span><span class="typ">AuditorAwareImpl</span><span class="pun">();</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="paragraph">
                        <p>If you expose a bean of type <code>AuditorAware</code> to the <code>ApplicationContext</code>,
                            the auditing infrastructure will pick it up automatically and use it to determine the
                            current user to be set on domain types. If you have multiple implementations registered in
                            the <code>ApplicationContext</code>, you can select the one to be used by explicitly setting
                            the <code>auditorAwareRef</code> attribute of <code>@EnableJpaAuditing</code>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="jpa.misc"><a class="anchor" href="#jpa.misc"></a>6. Miscellaneous</h2>
        <div class="sectionbody">
            <div class="sect2">
                <h3 id="jpa.misc.jpa-context"><a class="anchor" href="#jpa.misc.jpa-context"></a>6.1. Using JpaContext
                    in custom implementations</h3>
                <div class="paragraph">
                    <p>When working with multiple <code>EntityManager</code> instances and <a
                            href="#repositories.custom-implementations">custom repository implementations</a> you’ll
                        need to make sure you wire the correct <code>EntityManager</code> into the repository
                        implementation class. This could be solved by explicitly naming the <code>EntityManager</code>
                        in the <code>@PersistenceContext</code> annotation or using <code>@Qualifier</code> in case the
                        <code>EntityManager</code> is injected via <code>@Autowired</code>.</p>
                </div>
                <div class="paragraph">
                    <p>As of Spring Data JPA 1.9, we ship a class <code>JpaContext</code> that allows to obtain the
                        <code>EntityManager</code> by managed domain class assuming it’s only managed by one of the
                        <code>EntityManager</code> instances in the application.</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 88. Using JpaContext in a custom repository implementation</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">class</span><span class="pln"> </span><span class="typ">UserRepositoryImpl</span><span
        class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">UserRepositoryCustom</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span
        class="pln"> </span><span class="typ">EntityManager</span><span class="pln"> em</span><span class="pun">;</span><span
        class="pln">

  </span><span class="lit">@Autowired</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">UserRepositoryImpl</span><span
        class="pun">(</span><span class="typ">JpaContext</span><span class="pln"> context</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">em </span><span class="pun">=</span><span
        class="pln"> context</span><span class="pun">.</span><span class="pln">getEntityManagerByManagedType</span><span
        class="pun">(</span><span class="typ">User</span><span class="pun">.</span><span class="kwd">class</span><span
        class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="pun">…</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="paragraph">
                    <p>This approach has the advantage that the repository does not have to be touched to alter the
                        reference to the persistence unit in case the domain type gets assigned to a different
                        persistence unit.</p>
                </div>
            </div>
            <div class="sect2">
                <h3 id="jpa.misc.merging-persistence-units"><a class="anchor"
                                                               href="#jpa.misc.merging-persistence-units"></a>6.2.
                    Merging persistence units</h3>
                <div class="paragraph">
                    <p>Spring supports having multiple persistence units out of the box. Sometimes, however, you might
                        want to modularize your application but still make sure that all these modules run inside a
                        single persistence unit at runtime. To do so Spring Data JPA offers a <code>PersistenceUnitManager</code>
                        implementation that automatically merges persistence units based on their name.</p>
                </div>
                <div class="exampleblock">
                    <div class="title">Example 89. Using MergingPersistenceUnitmanager</div>
                    <div class="content">
                        <div class="listingblock">
                            <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;bean</span><span
        class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"….LocalContainerEntityManagerFactoryBean"</span><span
        class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span
        class="pun">=</span><span class="atv">"persistenceUnitManager"</span><span class="tag">&gt;</span><span
        class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span
        class="pun">=</span><span class="atv">"….MergingPersistenceUnitManager"</span><span class="pln"> </span><span
        class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/property&gt;</span><span class="pln">
</span><span class="tag">&lt;/bean&gt;</span></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sect3">
                    <h4 id="jpa.misc.entity-scanning"><a class="anchor" href="#jpa.misc.entity-scanning"></a>6.2.1.
                        Classpath scanning for @Entity classes and JPA mapping files</h4>
                    <div class="paragraph">
                        <p>A plain JPA setup requires all annotation mapped entity classes listed in
                            <code>orm.xml</code>. Same applies to XML mapping files. Spring Data JPA provides a
                            ClasspathScanningPersistenceUnitPostProcessor that gets a base package configured and
                            optionally takes a mapping filename pattern. It will then scan the given package for classes
                            annotated with @Entity or @MappedSuperclass and also loads the configuration files matching
                            the filename pattern and hands them to the JPA configuration. The PostProcessor has to be
                            configured like this:</p>
                    </div>
                    <div class="exampleblock">
                        <div class="title">Example 90. Using ClasspathScanningPersistenceUnitPostProcessor</div>
                        <div class="content">
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;bean</span><span
        class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"….LocalContainerEntityManagerFactoryBean"</span><span
        class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span
        class="pun">=</span><span class="atv">"persistenceUnitPostProcessors"</span><span class="tag">&gt;</span><span
        class="pln">
    </span><span class="tag">&lt;list&gt;</span><span class="pln">
      </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span
        class="atv">"org.springframework.data.jpa.support.ClasspathScanningPersistenceUnitPostProcessor"</span><span
        class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;constructor-arg</span><span class="pln"> </span><span class="atn">value</span><span
        class="pun">=</span><span class="atv">"com.acme.domain"</span><span class="pln"> </span><span
        class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span
        class="pun">=</span><span class="atv">"mappingFileNamePattern"</span><span class="pln"> </span><span
        class="atn">value</span><span class="pun">=</span><span class="atv">"**/*Mapping.xml"</span><span
        class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="tag">&lt;/bean&gt;</span><span class="pln">
    </span><span class="tag">&lt;/list&gt;</span><span class="pln">
  </span><span class="tag">&lt;/property&gt;</span><span class="pln">
</span><span class="tag">&lt;/bean&gt;</span></code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="admonitionblock note">
                        <table>
                            <tbody>
                            <tr>
                                <td class="icon">
                                    <i class="fa icon-note" title="Note"></i>
                                </td>
                                <td class="content">
                                    <div class="paragraph">
                                        <p>As of Spring 3.1 a package to scan can be configured on the
                                            LocalContainerEntityManagerFactoryBean directly to enable classpath scanning
                                            for entity classes. See the <a
                                                    href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/orm/jpa/LocalContainerEntityManagerFactoryBean.html#setPackagesToScan(java.lang.String...)">JavaDoc</a>
                                            for details.</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="sect2">
                <h3 id="jpd.misc.cdi-integration"><a class="anchor" href="#jpd.misc.cdi-integration"></a>6.3. CDI
                    integration</h3>
                <div class="paragraph">
                    <p>Instances of the repository interfaces are usually created by a container, which Spring is the
                        most natural choice when working with Spring Data. There’s sophisticated support to easily set
                        up Spring to create bean instances documented in <a href="#repositories.create-instances">Creating
                            repository instances</a>. As of version 1.1.0 Spring Data JPA ships with a custom CDI
                        extension that allows using the repository abstraction in CDI environments. The extension is
                        part of the JAR so all you need to do to activate it is dropping the Spring Data JPA JAR into
                        your classpath.</p>
                </div>
                <div class="paragraph">
                    <p>You can now set up the infrastructure by implementing a CDI Producer for the <code>EntityManagerFactory</code>
                        and <code>EntityManager</code>:</p>
                </div>
                <div class="listingblock">
                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">class</span><span class="pln"> </span><span class="typ">EntityManagerFactoryProducer</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Produces</span><span class="pln">
  </span><span class="lit">@ApplicationScoped</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">EntityManagerFactory</span><span
        class="pln"> createEntityManagerFactory</span><span class="pun">()</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Persistence</span><span
        class="pun">.</span><span class="pln">createEntityManagerFactory</span><span class="pun">(</span><span
        class="str">"my-presistence-unit"</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span
        class="pln"> close</span><span class="pun">(</span><span class="lit">@Disposes</span><span
        class="pln"> </span><span class="typ">EntityManagerFactory</span><span
        class="pln"> entityManagerFactory</span><span class="pun">)</span><span class="pln"> </span><span
        class="pun">{</span><span class="pln">
    entityManagerFactory</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span
        class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="lit">@Produces</span><span class="pln">
  </span><span class="lit">@RequestScoped</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">EntityManager</span><span
        class="pln"> createEntityManager</span><span class="pun">(</span><span
        class="typ">EntityManagerFactory</span><span class="pln"> entityManagerFactory</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> entityManagerFactory</span><span class="pun">.</span><span
        class="pln">createEntityManager</span><span class="pun">();</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span
        class="pln"> close</span><span class="pun">(</span><span class="lit">@Disposes</span><span
        class="pln"> </span><span class="typ">EntityManager</span><span class="pln"> entityManager</span><span
        class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    entityManager</span><span class="pun">.</span><span class="pln">close</span><span class="pun">();</span><span
        class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>The necessary setup can vary depending on the JavaEE environment you run in. It might also just
                        be enough to redeclare a <code>EntityManager</code> as CDI bean as follows:</p>
                </div>
                <div class="listingblock">
                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">class</span><span class="pln"> </span><span class="typ">CdiConfig</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Produces</span><span class="pln">
  </span><span class="lit">@RequestScoped</span><span class="pln">
  </span><span class="lit">@PersistenceContext</span><span class="pln">
  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">EntityManager</span><span
        class="pln"> entityManager</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                    </div>
                </div>
                <div class="paragraph">
                    <p>In this example, the container has to be capable of creating JPA <code>EntityManagers</code>
                        itself. All the configuration does is re-exporting the JPA <code>EntityManager</code> as CDI
                        bean.</p>
                </div>
                <div class="paragraph">
                    <p>The Spring Data JPA CDI extension will pick up all EntityManagers availables as CDI beans and
                        create a proxy for a Spring Data repository whenever an bean of a repository type is requested
                        by the container. Thus obtaining an instance of a Spring Data repository is a matter of
                        declaring an <code>@Injected</code> property:</p>
                </div>
                <div class="listingblock">
                    <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span
        class="kwd">class</span><span class="pln"> </span><span class="typ">RepositoryClient</span><span
        class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="lit">@Inject</span><span class="pln">
  </span><span class="typ">PersonRepository</span><span class="pln"> repository</span><span class="pun">;</span><span
        class="pln">

  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> businessMethod</span><span
        class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span
        class="pln"> people </span><span class="pun">=</span><span class="pln"> repository</span><span
        class="pun">.</span><span class="pln">findAll</span><span class="pun">();</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <h1 id="appendix" class="sect0"><a class="anchor" href="#appendix"></a>Appendix</h1>
    <div class="sect1">
        <h2 id="repositories.namespace-reference"><a class="anchor" href="#repositories.namespace-reference"></a>Appendix
            A: Namespace reference</h2>
        <div class="sectionbody">
            <div class="sect2">
                <h3 id="populator.namespace-dao-config"><a class="anchor" href="#populator.namespace-dao-config"></a>The
                    &lt;repositories /&gt; element</h3>
                <div class="paragraph">
                    <p>The <code>&lt;repositories /&gt;</code> element triggers the setup of the Spring Data repository
                        infrastructure. The most important attribute is <code>base-package</code> which defines the
                        package to scan for Spring Data repository interfaces.<sup class="footnote">[<a
                                id="_footnoteref_3" class="footnote" href="#_footnote_3"
                                title="View footnote.">3</a>]</sup></p>
                </div>
                <table class="tableblock frame-all grid-all spread">
                    <caption class="title">Table 8. Attributes</caption>
                    <colgroup>
                        <col style="width: 25%;">
                        <col style="width: 75%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="tableblock halign-left valign-top">Name</th>
                        <th class="tableblock halign-left valign-top">Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>base-package</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Defines the package to be
                            used to be scanned for repository interfaces extending *Repository (actual interface is
                            determined by specific Spring Data module) in auto detection mode. All packages below the
                            configured package will be scanned, too. Wildcards are allowed.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>repository-impl-postfix</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Defines the postfix to
                            autodetect custom repository implementations. Classes whose names end with the configured
                            postfix will be considered as candidates. Defaults to <code>Impl</code>.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>query-lookup-strategy</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Determines the strategy to
                            be used to create finder queries. See <a
                                    href="#repositories.query-methods.query-lookup-strategies">Query lookup
                                strategies</a> for details. Defaults to <code>create-if-not-found</code>.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>named-queries-location</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Defines the location to look
                            for a Properties file containing externally defined queries.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>consider-nested-repositories</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether nested
                            repository interface definitions should be considered. Defaults to <code>false</code>.</p>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="populator.namespace-reference"><a class="anchor" href="#populator.namespace-reference"></a>Appendix B:
            Populators namespace reference</h2>
        <div class="sectionbody">
            <div class="sect2">
                <h3 id="namespace-dao-config"><a class="anchor" href="#namespace-dao-config"></a>The &lt;populator /&gt;
                    element</h3>
                <div class="paragraph">
                    <p>The <code>&lt;populator /&gt;</code> element allows to populate the a data store via the Spring
                        Data repository infrastructure.<sup class="footnote">[<a id="_footnoteref_4" class="footnote"
                                                                                 href="#_footnote_4"
                                                                                 title="View footnote.">4</a>]</sup></p>
                </div>
                <table class="tableblock frame-all grid-all spread">
                    <caption class="title">Table 9. Attributes</caption>
                    <colgroup>
                        <col style="width: 25%;">
                        <col style="width: 75%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="tableblock halign-left valign-top">Name</th>
                        <th class="tableblock halign-left valign-top">Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>locations</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Where to find the files to
                            read the objects from the repository shall be populated with.</p></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="repository-query-keywords"><a class="anchor" href="#repository-query-keywords"></a>Appendix C:
            Repository query keywords</h2>
        <div class="sectionbody">
            <div class="sect2">
                <h3 id="_supported_query_keywords"><a class="anchor" href="#_supported_query_keywords"></a>Supported
                    query keywords</h3>
                <div class="paragraph">
                    <p>The following table lists the keywords generally supported by the Spring Data repository query
                        derivation mechanism. However, consult the store-specific documentation for the exact list of
                        supported keywords, because some listed here might not be supported in a particular store.</p>
                </div>
                <table class="tableblock frame-all grid-all spread">
                    <caption class="title">Table 10. Query keywords</caption>
                    <colgroup>
                        <col style="width: 25%;">
                        <col style="width: 75%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="tableblock halign-left valign-top">Logical keyword</th>
                        <th class="tableblock halign-left valign-top">Keyword expressions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>And</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Or</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>AFTER</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>After</code>, <code>IsAfter</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>BEFORE</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Before</code>, <code>IsBefore</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONTAINING</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Containing</code>,
                            <code>IsContaining</code>, <code>Contains</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code>, <code>IsBetween</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENDING_WITH</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>EndingWith</code>,
                            <code>IsEndingWith</code>, <code>EndsWith</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXISTS</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exists</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>FALSE</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code>, <code>IsFalse</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATER_THAN</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>GreaterThan</code>,
                            <code>IsGreaterThan</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>GREATER_THAN_EQUALS</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>GreaterThanEqual</code>, <code>IsGreaterThanEqual</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code>,
                            <code>IsIn</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Is</code>, <code>Equals</code>,
                            (or no keyword)</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NOT_NULL</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotNull</code>, <code>IsNotNull</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS_NULL</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Null</code>, <code>IsNull</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThan</code>,
                            <code>IsLessThan</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LESS_THAN_EQUAL</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LessThanEqual</code>,
                            <code>IsLessThanEqual</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code>, <code>IsLike</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEAR</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Near</code>, <code>IsNear</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code>, <code>IsNot</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_IN</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotIn</code>, <code>IsNotIn</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_LIKE</code></p>
                        </td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotLike</code>, <code>IsNotLike</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGEX</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Regex</code>, <code>MatchesRegex</code>,
                            <code>Matches</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING_WITH</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>StartingWith</code>,
                            <code>IsStartingWith</code>, <code>StartsWith</code></p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUE</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code>, <code>IsTrue</code>
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>WITHIN</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Within</code>, <code>IsWithin</code>
                        </p></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="repository-query-return-types"><a class="anchor" href="#repository-query-return-types"></a>Appendix D:
            Repository query return types</h2>
        <div class="sectionbody">
            <div class="sect2">
                <h3 id="_supported_query_return_types"><a class="anchor" href="#_supported_query_return_types"></a>Supported
                    query return types</h3>
                <div class="paragraph">
                    <p>The following table lists the return types generally supported by Spring Data repositories.
                        However, consult the store-specific documentation for the exact list of supported return types,
                        because some listed here might not be supported in a particular store.</p>
                </div>
                <div class="admonitionblock note">
                    <table>
                        <tbody>
                        <tr>
                            <td class="icon">
                                <i class="fa icon-note" title="Note"></i>
                            </td>
                            <td class="content">
                                Geospatial types like (<code>GeoResult</code>, <code>GeoResults</code>,
                                <code>GeoPage</code>) are only available for data stores that support geospatial
                                queries.
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <table class="tableblock frame-all grid-all spread">
                    <caption class="title">Table 11. Query return types</caption>
                    <colgroup>
                        <col style="width: 25%;">
                        <col style="width: 75%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="tableblock halign-left valign-top">Return type</th>
                        <th class="tableblock halign-left valign-top">Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>void</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Denotes no return value.</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Primitives</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Java primitives.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Wrapper types</p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">Java wrapper types.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">An unique entity. Expects
                            the query method to return one result at most. In case no result is found <code>null</code>
                            is returned. More than one result will trigger an <code>IncorrectResultSizeDataAccessException</code>.
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>Iterator&lt;T&gt;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">An <code>Iterator</code>.
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>Collection&lt;T&gt;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Collection</code>.
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;T&gt;</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A <code>List</code>.</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>Optional&lt;T&gt;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 or Guava <code>Optional</code>.
                            Expects the query method to return one result at most. In case no result is found <code>Optional.empty()</code>/<code>Optional.absent()</code>
                            is returned. More than one result will trigger an <code>IncorrectResultSizeDataAccessException</code>.
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stream&lt;T&gt;</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 <code>Stream</code>.
                        </p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Future&lt;T&gt;</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Future</code>.
                            Expects method to be annotated with <code>@Async</code> and requires Spring’s asynchronous
                            method execution capability enabled.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletableFuture&lt;T&gt;</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A Java 8 <code>CompletableFuture</code>.
                            Expects method to be annotated with <code>@Async</code> and requires Spring’s asynchronous
                            method execution capability enabled.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>ListenableFuture</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A <code>org.springframework.util.concurrent.ListenableFuture</code>.
                            Expects method to be annotated with <code>@Async</code> and requires Spring’s asynchronous
                            method execution capability enabled.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Slice</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A sized chunk of data with
                            information whether there is more data available. Requires a <code>Pageable</code> method
                            parameter.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock"><code>Page&lt;T&gt;</code>
                        </p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Slice</code> with
                            additional information, e.g. the total number of results. Requires a <code>Pageable</code>
                            method parameter.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>GeoResult&lt;T&gt;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A result entry with
                            additional information, e.g. distance to a reference location.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>GeoResults&lt;T&gt;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A list of <code>GeoResult&lt;T&gt;</code>
                            with additional information, e.g. average distance to a reference location.</p></td>
                    </tr>
                    <tr>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">
                            <code>GeoPage&lt;T&gt;</code></p></td>
                        <td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Page</code> with
                            <code>GeoResult&lt;T&gt;</code>, e.g. average distance to a reference location.</p></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="faq"><a class="anchor" href="#faq"></a>Appendix E: Frequently asked questions</h2>
        <div class="sectionbody">
            <div class="sect2">
                <h3 id="_common"><a class="anchor" href="#_common"></a>Common</h3>
                <div class="qlist qanda">
                    <ol>
                        <li>
                            <p><em>I’d like to get more detailed logging information on what methods are called inside
                                <code>JpaRepository</code>, e.g. How can I gain them?</em></p>
                            <p>You can make use of <code>CustomizableTraceInterceptor</code> provided by Spring:</p>
                            <div class="listingblock">
                                <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;bean</span><span
        class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"customizableTraceInterceptor"</span><span
        class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"
  org.springframework.aop.interceptor.CustomizableTraceInterceptor"</span><span class="tag">&gt;</span><span
        class="pln">
  </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span
        class="pun">=</span><span class="atv">"enterMessage"</span><span class="pln"> </span><span
        class="atn">value</span><span class="pun">=</span><span
        class="atv">"Entering $[methodName]($[arguments])"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span
        class="pun">=</span><span class="atv">"exitMessage"</span><span class="pln"> </span><span
        class="atn">value</span><span class="pun">=</span><span
        class="atv">"Leaving $[methodName](): $[returnValue]"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/bean&gt;</span><span class="pln">

</span><span class="tag">&lt;aop:config&gt;</span><span class="pln">
  </span><span class="tag">&lt;aop:advisor</span><span class="pln"> </span><span class="atn">advice-ref</span><span
        class="pun">=</span><span class="atv">"customizableTraceInterceptor"</span><span class="pln">
    </span><span class="atn">pointcut</span><span class="pun">=</span><span class="atv">"execution(public * org.springframework.data.jpa.repository.JpaRepository+.*(..))"</span><span
        class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/aop:config&gt;</span></code></pre>
                                </div>
                            </div>
                        </li>
                    </ol>
                </div>
            </div>
            <div class="sect2">
                <h3 id="_infrastructure"><a class="anchor" href="#_infrastructure"></a>Infrastructure</h3>
                <div class="qlist qanda">
                    <ol>
                        <li>
                            <p><em>Currently I have implemented a repository layer based on
                                <code>HibernateDaoSupport</code>. I create a <code>SessionFactory</code> by using
                                Spring’s <code>AnnotationSessionFactoryBean</code>. How do I get Spring Data
                                repositories working in this environment?</em></p>
                            <p>You have to replace <code>AnnotationSessionFactoryBean</code> with the <code>HibernateJpaSessionFactoryBean</code>
                                as follows:</p>
                            <div class="exampleblock">
                                <div class="title">Example 91. Looking up a SessionFactory from a
                                    HibernateEntityManagerFactory
                                </div>
                                <div class="content">
                                    <div class="listingblock">
                                        <div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;bean</span><span
        class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span
        class="atv">"sessionFactory"</span><span class="pln"> </span><span class="atn">class</span><span
        class="pun">=</span><span class="atv">"org.springframework.orm.jpa.vendor.HibernateJpaSessionFactoryBean"</span><span
        class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span
        class="pun">=</span><span class="atv">"entityManagerFactory"</span><span class="pln"> </span><span class="atn">ref</span><span
        class="pun">=</span><span class="atv">"entityManagerFactory"</span><span class="tag">/&gt;</span><span
        class="pln">
</span><span class="tag">&lt;/bean&gt;</span></code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ol>
                </div>
            </div>
            <div class="sect2">
                <h3 id="_auditing"><a class="anchor" href="#_auditing"></a>Auditing</h3>
                <div class="qlist qanda">
                    <ol>
                        <li>
                            <p><em>I want to use Spring Data JPA auditing capabilities but have my database already set
                                up to set modification and creation date on entities. How to prevent Spring Data from
                                setting the date programmatically.</em></p>
                            <p>Just use the <code>set-dates</code> attribute of the <code>auditing</code> namespace
                                element to false.</p>
                        </li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    <div class="sect1">
        <h2 id="glossary"><a class="anchor" href="#glossary"></a>Appendix F: Glossary</h2>
        <div class="sectionbody">
            <div class="dlist">
                <dl>
                    <dt class="hdlist1">AOP</dt>
                    <dd>
                        <p>Aspect oriented programming</p>
                    </dd>
                    <dt class="hdlist1">Commons DBCP</dt>
                    <dd>
                        <p>Commons DataBase Connection Pools - Library of the Apache foundation offering pooling
                            implementations of the DataSource interface.</p>
                    </dd>
                    <dt class="hdlist1">CRUD</dt>
                    <dd>
                        <p>Create, Read, Update, Delete - Basic persistence operations</p>
                    </dd>
                    <dt class="hdlist1">DAO</dt>
                    <dd>
                        <p>Data Access Object - Pattern to separate persisting logic from the object to be persisted</p>
                    </dd>
                    <dt class="hdlist1">Dependency Injection</dt>
                    <dd>
                        <p>Pattern to hand a component’s dependency to the component from outside, freeing the component
                            to lookup the dependant itself. For more information see <a
                                    href="https://en.wikipedia.org/wiki/Dependency_Injection"></a><a
                                    href="https://en.wikipedia.org/wiki/Dependency_Injection" class="bare">http://en.wikipedia.org/wiki/Dependency_Injection</a>.
                        </p>
                    </dd>
                    <dt class="hdlist1">EclipseLink</dt>
                    <dd>
                        <p>Object relational mapper implementing JPA - <a href="http://www.eclipselink.org"></a><a
                                href="http://www.eclipselink.org" class="bare">http://www.eclipselink.org</a></p>
                    </dd>
                    <dt class="hdlist1">Hibernate</dt>
                    <dd>
                        <p>Object relational mapper implementing JPA - <a href="http://www.hibernate.org"></a><a
                                href="http://www.hibernate.org" class="bare">http://www.hibernate.org</a></p>
                    </dd>
                    <dt class="hdlist1">JPA</dt>
                    <dd>
                        <p>Java Persistence API</p>
                    </dd>
                    <dt class="hdlist1">Spring</dt>
                    <dd>
                        <p>Java application framework - <a href="http://projects.spring.io/spring-framework"></a><a
                                href="http://projects.spring.io/spring-framework" class="bare">http://projects.spring.io/spring-framework</a>
                        </p>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>